    public function testPurgeDataDeleteReportsKeepSegmentsReports()
    {
        Piwik_PrivacyManager::savePurgeDataSettings(array(
                                                         'delete_reports_keep_day_reports'     => 1,
                                                         'delete_reports_keep_segment_reports' => 1
                                                    ));

        // get purge data prediction
        $prediction = Piwik_PrivacyManager::getPurgeEstimate();

        // perform checks on prediction
        $unexplained = -2;
        $expectedPrediction = array(
            Piwik_Common::prefixTable('log_conversion')          => 6,
            Piwik_Common::prefixTable('log_link_visit_action')   => 6,
            Piwik_Common::prefixTable('log_visit')               => 3,
            Piwik_Common::prefixTable('log_conversion_item')     => 3,
            Piwik_Common::prefixTable('archive_numeric_2012_01') => -1,
            Piwik_Common::prefixTable('archive_blob_2012_01')    => 9 + $unexplained // 4 weeks, 1 month & 1 year + 1 garbage report + 2 range reports
        );
        $this->assertEquals($expectedPrediction, $prediction);

        // purge data
        $this->_setTimeToRun();
        $this->instance->deleteLogData();
        $this->instance->deleteReportData();

        // perform checks
        $this->checkLogDataPurged();
        $this->_checkReportsAndMetricsPurged($janBlobsRemaining = 6); // 1 segmented blob + 5 day blobs
    }

    // --- utility functions follow ---

||||||||    public function testPurgeDataDeleteReportsKeepSegmentsReports()
    {
        Piwik_PrivacyManager::savePurgeDataSettings(array(
                                                         'delete_reports_keep_day_reports'     => 1,
                                                         'delete_reports_keep_segment_reports' => 1
                                                    ));

        // get purge data prediction
        $prediction = Piwik_PrivacyManager::getPurgeEstimate();

        // perform checks on prediction
        $unexplained = 0;//-2;
        $expectedPrediction = array(
            Piwik_Common::prefixTable('log_conversion')          => 6,
            Piwik_Common::prefixTable('log_link_visit_action')   => 6,
            Piwik_Common::prefixTable('log_visit')               => 3,
            Piwik_Common::prefixTable('log_conversion_item')     => 3,
            Piwik_Common::prefixTable('archive_numeric_2012_01') => -1,
            Piwik_Common::prefixTable('archive_blob_2012_01')    => 9 + $unexplained // 4 weeks, 1 month & 1 year + 1 garbage report + 2 range reports
        );
        $this->assertEquals($expectedPrediction, $prediction);

        // purge data
        $this->_setTimeToRun();
        $this->instance->deleteLogData();
        $this->instance->deleteReportData();

        // perform checks
        $this->checkLogDataPurged();
        $this->_checkReportsAndMetricsPurged($janBlobsRemaining = 6); // 1 segmented blob + 5 day blobs
    }

    // --- utility functions follow ---

||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_STATIC_CALL
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (SCALAR))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL))
    (AST_ASSIGN
        (AST_VAR)
        (AST_UNARY_OP
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_ARRAY
            (AST_ARRAY_ELEM
                (SCALAR)
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (SCALAR)
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (SCALAR)
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (SCALAR)
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (AST_UNARY_OP
                    (SCALAR))
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (AST_BINARY_OP
                    (SCALAR)
                    (AST_VAR))
                (AST_STATIC_CALL
                    (
                        (SCALAR))))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_PROP
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_PROP
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ASSIGN
                (AST_VAR)
                (SCALAR)))))||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_STATIC_CALL
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (SCALAR))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL))
    (AST_ASSIGN
        (AST_VAR)
        (SCALAR))
    (AST_ASSIGN
        (AST_VAR)
        (AST_ARRAY
            (AST_ARRAY_ELEM
                (SCALAR)
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (SCALAR)
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (SCALAR)
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (SCALAR)
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (AST_UNARY_OP
                    (SCALAR))
                (AST_STATIC_CALL
                    (
                        (SCALAR))))
            (AST_ARRAY_ELEM
                (AST_BINARY_OP
                    (SCALAR)
                    (AST_VAR))
                (AST_STATIC_CALL
                    (
                        (SCALAR))))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_PROP
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_PROP
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ASSIGN
                (AST_VAR)
                (SCALAR)))))