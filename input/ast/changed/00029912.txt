	public function main($args = null)
	{
		$displayedGIF = false;
		$this->initRequests($args);
		if (!empty($this->requests))
		{
			// handle all visits
			foreach ($this->requests as $request)
			{
				$this->init($request);

				if(!$displayedGIF && !$this->authenticated)
				{
					$this->outputTransparentGif();
					$displayedGIF = true;
				}

				try
				{
					if ($this->isVisitValid())
					{
						self::connectDatabaseIfNotConnected();

						$visit = $this->getNewVisitObject();
						$visit->setRequest($request);
						$visit->handle();
						unset($visit);
					}
					else
					{
						printDebug("The request is invalid: empty request, or maybe tracking is disabled in the config.ini.php via record_statistics=0");
					}
				} catch (Piwik_Tracker_Db_Exception $e) {
					printDebug("<b>".$e->getMessage()."</b>");
					$this->exitWithException($e, $this->authenticated);
				} catch(Piwik_Tracker_Visit_Excluded $e) {
				} catch(Exception $e) {
					$this->exitWithException($e, $this->authenticated);
				}
				$this->clear();

				// increment successfully logged request count. make sure to do this after try-catch,
				// since an excluded visit is considered 'successfully logged'
				++$this->countOfLoggedRequests;
			}

			if(!$displayedGIF)
			{
				$this->outputTransparentGif();
				$displayedGIF = true;
			}
		}
		else
		{
			$this->handleEmptyRequest($_GET + $_POST);
		}

		// run scheduled task
		try
		{
			// don't run scheduled tasks in CLI mode from Tracker, this is the case
			// where we bulk load logs & don't want to lose time with tasks
			if(!Piwik_Common::isPhpCliMode()
				&& !$this->authenticated && $this->getState() != self::STATE_LOGGING_DISABLE)
			{
				self::runScheduledTasks($now = $this->getCurrentTimestamp());
			}
		}
		catch (Exception $e)
		{
			$this->exitWithException($e, $this->authenticated);
		}

		$this->end();
	}

	/**
	 * Tracker requests will automatically trigger the Scheduled tasks.
	 * This is useful for users who don't setup the cron,
	 * but still want daily/weekly/monthly PDF reports emailed automatically.
	 *
	 * This is similar to calling the API CoreAdminHome.runScheduledTasks (see misc/cron/archive.php)
	 *
	 * @param int  $now  Current timestamp
	 */
||||||||	public function main($args = null)
	{
		$displayedGIF = false;
		$this->initRequests($args);
		if (!empty($this->requests))
		{
			// handle all visits
			foreach ($this->requests as $request)
			{
				$this->init($request);

				if(!$displayedGIF && !$this->authenticated)
				{
					$this->outputTransparentGif();
					$displayedGIF = true;
				}

				try
				{
					if ($this->isVisitValid())
					{
						self::connectDatabaseIfNotConnected();

						$visit = $this->getNewVisitObject();
						$visit->setRequest($request);
						$visit->handle();
						unset($visit);
					}
					else
					{
						printDebug("The request is invalid: empty request, or maybe tracking is disabled in the config.ini.php via record_statistics=0");
					}
				} catch (Piwik_Tracker_Db_Exception $e) {
					printDebug("<b>".$e->getMessage()."</b>");
					$this->exitWithException($e, $this->authenticated);
				} catch(Piwik_Tracker_Visit_Excluded $e) {
				} catch(Exception $e) {
					$this->exitWithException($e, $this->authenticated);
				}
				$this->clear();

				// increment successfully logged request count. make sure to do this after try-catch,
				// since an excluded visit is considered 'successfully logged'
				++$this->countOfLoggedRequests;
			}

			if(!$displayedGIF)
			{
				$this->outputTransparentGif();
				$displayedGIF = true;
			}
		}
		else
		{
			$this->handleEmptyRequest($_GET + $_POST);
		}

		// run scheduled task
		try
		{
			if($this->shouldRunScheduledTasks())
			{
				self::runScheduledTasks($now = $this->getCurrentTimestamp());
			}
		}
		catch (Exception $e)
		{
			$this->exitWithException($e, $this->authenticated);
		}

		$this->end();
	}

||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(NO_PARAM_TYPEPARAM_DEFAULT)
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_CONST))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)))
    (AST_IF
        (AST_IF_ELEM
            (AST_UNARY_OP
                (AST_EMPTY
                    (AST_PROP
                        (AST_VAR))))
            (
                (AST_FOREACH
                    (AST_PROP
                        (AST_VAR))
                    (AST_VAR)
                    (NULL)
                    (
                        (AST_METHOD_CALL
                            (AST_VAR)
                            (
                                (AST_VAR)))
                        (AST_IF
                            (AST_IF_ELEM
                                (AST_BINARY_OP
                                    (AST_UNARY_OP
                                        (AST_VAR))
                                    (AST_UNARY_OP
                                        (AST_PROP
                                            (AST_VAR))))
                                (
                                    (AST_METHOD_CALL
                                        (AST_VAR))
                                    (AST_ASSIGN
                                        (AST_VAR)
                                        (AST_CONST)))))
                        (AST_TRY
                            (
                                (AST_IF
                                    (AST_IF_ELEM
                                        (AST_METHOD_CALL
                                            (AST_VAR))
                                        (
                                            (AST_STATIC_CALL)
                                            (AST_ASSIGN
                                                (AST_VAR)
                                                (AST_METHOD_CALL
                                                    (AST_VAR)))
                                            (AST_METHOD_CALL
                                                (AST_VAR)
                                                (
                                                    (AST_VAR)))
                                            (AST_METHOD_CALL
                                                (AST_VAR))
                                            (AST_UNSET
                                                (AST_VAR))))
                                    (AST_IF_ELEM
                                        (NULL)
                                        (
                                            (AST_CALL
                                                (
                                                    (SCALAR)))))))
                            (AST_CATCH_LIST
                                (AST_CATCH
                                    (AST_NAME_LIST)
                                    (AST_VAR)
                                    (
                                        (AST_CALL
                                            (
                                                (AST_BINARY_OP
                                                    (AST_BINARY_OP
                                                        (SCALAR)
                                                        (AST_METHOD_CALL
                                                            (AST_VAR)))
                                                    (SCALAR))))
                                        (AST_METHOD_CALL
                                            (AST_VAR)
                                            (
                                                (AST_VAR)
                                                (AST_PROP
                                                    (AST_VAR))))))
                                (AST_CATCH
                                    (AST_NAME_LIST)
                                    (AST_VAR))
                                (AST_CATCH
                                    (AST_NAME_LIST)
                                    (AST_VAR)
                                    (
                                        (AST_METHOD_CALL
                                            (AST_VAR)
                                            (
                                                (AST_VAR)
                                                (AST_PROP
                                                    (AST_VAR)))))))
                            (NULL))
                        (AST_METHOD_CALL
                            (AST_VAR))
                        (AST_PRE_INC
                            (AST_PROP
                                (AST_VAR)))))
                (AST_IF
                    (AST_IF_ELEM
                        (AST_UNARY_OP
                            (AST_VAR))
                        (
                            (AST_METHOD_CALL
                                (AST_VAR))
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_CONST)))))))
        (AST_IF_ELEM
            (NULL)
            (
                (AST_METHOD_CALL
                    (AST_VAR)
                    (
                        (AST_BINARY_OP
                            (AST_VAR)
                            (AST_VAR)))))))
    (AST_TRY
        (
            (AST_IF
                (AST_IF_ELEM
                    (AST_BINARY_OP
                        (AST_BINARY_OP
                            (AST_UNARY_OP
                                (AST_STATIC_CALL))
                            (AST_UNARY_OP
                                (AST_PROP
                                    (AST_VAR))))
                        (AST_BINARY_OP
                            (AST_METHOD_CALL
                                (AST_VAR))
                            (AST_CLASS_CONST
                                (SCALAR))))
                    (
                        (AST_STATIC_CALL
                            (
                                (AST_ASSIGN
                                    (AST_VAR)
                                    (AST_METHOD_CALL
                                        (AST_VAR)))))))))
        (AST_CATCH_LIST
            (AST_CATCH
                (AST_NAME_LIST)
                (AST_VAR)
                (
                    (AST_METHOD_CALL
                        (AST_VAR)
                        (
                            (AST_VAR)
                            (AST_PROP
                                (AST_VAR)))))))
        (NULL))
    (AST_METHOD_CALL
        (AST_VAR)))||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(NO_PARAM_TYPEPARAM_DEFAULT)
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_CONST))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)))
    (AST_IF
        (AST_IF_ELEM
            (AST_UNARY_OP
                (AST_EMPTY
                    (AST_PROP
                        (AST_VAR))))
            (
                (AST_FOREACH
                    (AST_PROP
                        (AST_VAR))
                    (AST_VAR)
                    (NULL)
                    (
                        (AST_METHOD_CALL
                            (AST_VAR)
                            (
                                (AST_VAR)))
                        (AST_IF
                            (AST_IF_ELEM
                                (AST_BINARY_OP
                                    (AST_UNARY_OP
                                        (AST_VAR))
                                    (AST_UNARY_OP
                                        (AST_PROP
                                            (AST_VAR))))
                                (
                                    (AST_METHOD_CALL
                                        (AST_VAR))
                                    (AST_ASSIGN
                                        (AST_VAR)
                                        (AST_CONST)))))
                        (AST_TRY
                            (
                                (AST_IF
                                    (AST_IF_ELEM
                                        (AST_METHOD_CALL
                                            (AST_VAR))
                                        (
                                            (AST_STATIC_CALL)
                                            (AST_ASSIGN
                                                (AST_VAR)
                                                (AST_METHOD_CALL
                                                    (AST_VAR)))
                                            (AST_METHOD_CALL
                                                (AST_VAR)
                                                (
                                                    (AST_VAR)))
                                            (AST_METHOD_CALL
                                                (AST_VAR))
                                            (AST_UNSET
                                                (AST_VAR))))
                                    (AST_IF_ELEM
                                        (NULL)
                                        (
                                            (AST_CALL
                                                (
                                                    (SCALAR)))))))
                            (AST_CATCH_LIST
                                (AST_CATCH
                                    (AST_NAME_LIST)
                                    (AST_VAR)
                                    (
                                        (AST_CALL
                                            (
                                                (AST_BINARY_OP
                                                    (AST_BINARY_OP
                                                        (SCALAR)
                                                        (AST_METHOD_CALL
                                                            (AST_VAR)))
                                                    (SCALAR))))
                                        (AST_METHOD_CALL
                                            (AST_VAR)
                                            (
                                                (AST_VAR)
                                                (AST_PROP
                                                    (AST_VAR))))))
                                (AST_CATCH
                                    (AST_NAME_LIST)
                                    (AST_VAR))
                                (AST_CATCH
                                    (AST_NAME_LIST)
                                    (AST_VAR)
                                    (
                                        (AST_METHOD_CALL
                                            (AST_VAR)
                                            (
                                                (AST_VAR)
                                                (AST_PROP
                                                    (AST_VAR)))))))
                            (NULL))
                        (AST_METHOD_CALL
                            (AST_VAR))
                        (AST_PRE_INC
                            (AST_PROP
                                (AST_VAR)))))
                (AST_IF
                    (AST_IF_ELEM
                        (AST_UNARY_OP
                            (AST_VAR))
                        (
                            (AST_METHOD_CALL
                                (AST_VAR))
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_CONST)))))))
        (AST_IF_ELEM
            (NULL)
            (
                (AST_METHOD_CALL
                    (AST_VAR)
                    (
                        (AST_BINARY_OP
                            (AST_VAR)
                            (AST_VAR)))))))
    (AST_TRY
        (
            (AST_IF
                (AST_IF_ELEM
                    (AST_METHOD_CALL
                        (AST_VAR))
                    (
                        (AST_STATIC_CALL
                            (
                                (AST_ASSIGN
                                    (AST_VAR)
                                    (AST_METHOD_CALL
                                        (AST_VAR)))))))))
        (AST_CATCH_LIST
            (AST_CATCH
                (AST_NAME_LIST)
                (AST_VAR)
                (
                    (AST_METHOD_CALL
                        (AST_VAR)
                        (
                            (AST_VAR)
                            (AST_PROP
                                (AST_VAR)))))))
        (NULL))
    (AST_METHOD_CALL
        (AST_VAR)))