public void afterInvoke(Throwable error, long nanos) {
    runningCountUpdater.decrementAndGet(this);
    requestTimeNanoUpdater.addAndGet(this, nanos);
    histogramRecord(nanos);
    if (error != null) {
        errorCountUpdater.incrementAndGet(this);
    }
    {
        WebRequestStat localStat = WebRequestStat.current();
        if (localStat != null) {
            {
                long fetchRowCount = localStat.getJdbcFetchRowCount();
                this.addJdbcFetchRowCount(fetchRowCount);
                for (; ; ) {
                    long peak = jdbcFetchRowPeakUpdater.get(this);
                    if (fetchRowCount <= peak) {
                        break;
                    }
                    if (jdbcFetchRowPeakUpdater.compareAndSet(this, peak, fetchRowCount)) {
                        break;
                    }
                }
            }
            {
                long executeCount = localStat.getJdbcExecuteCount();
                this.addJdbcExecuteCount(executeCount);
                for (; ; ) {
                    long peak = jdbcExecutePeakUpdater.get(this);
                    if (executeCount <= peak) {
                        break;
                    }
                    if (jdbcExecutePeakUpdater.compareAndSet(this, peak, executeCount)) {
                        break;
                    }
                }
            }
            {
                long updateCount = localStat.getJdbcUpdateCount();
                this.addJdbcUpdateCount(updateCount);
                for (; ; ) {
                    long peak = jdbcUpdatePeakUpdater.get(this);
                    if (updateCount <= peak) {
                        break;
                    }
                    if (jdbcUpdatePeakUpdater.compareAndSet(this, peak, updateCount)) {
                        break;
                    }
                }
            }
            jdbcExecuteErrorCountUpdater.addAndGet(this, localStat.getJdbcExecuteErrorCount());
            jdbcExecuteTimeNanoUpdater.addAndGet(this, localStat.getJdbcExecuteTimeNano());
            this.addJdbcPoolConnectionOpenCount(localStat.getJdbcPoolConnectionOpenCount());
            this.addJdbcPoolConnectionCloseCount(localStat.getJdbcPoolConnectionCloseCount());
            this.addJdbcResultSetOpenCount(localStat.getJdbcResultSetOpenCount());
            this.addJdbcResultSetCloseCount(localStat.getJdbcResultSetCloseCount());
        }
    }
    currentLocal.set(null);
}||||||||public void afterInvoke(Throwable error, long nanos) {
    runningCountUpdater.decrementAndGet(this);
    requestTimeNanoUpdater.addAndGet(this, nanos);
    for (; ; ) {
        long current = requestTimeNanoUpdater.get(this);
        if (current < nanos) {
            if (requestTimeNanoUpdater.compareAndSet(this, current, nanos)) {
                // 可能不准确，但是绝大多数情况下都会正确，性能换取一致性
                requestTimeNanoMaxOccurTime = System.currentTimeMillis();
                break;
            } else {
                continue;
            }
        } else {
            break;
        }
    }
    histogramRecord(nanos);
    if (error != null) {
        errorCountUpdater.incrementAndGet(this);
    }
    {
        WebRequestStat localStat = WebRequestStat.current();
        if (localStat != null) {
            {
                long fetchRowCount = localStat.getJdbcFetchRowCount();
                this.addJdbcFetchRowCount(fetchRowCount);
                for (; ; ) {
                    long peak = jdbcFetchRowPeakUpdater.get(this);
                    if (fetchRowCount <= peak) {
                        break;
                    }
                    if (jdbcFetchRowPeakUpdater.compareAndSet(this, peak, fetchRowCount)) {
                        break;
                    }
                }
            }
            {
                long executeCount = localStat.getJdbcExecuteCount();
                this.addJdbcExecuteCount(executeCount);
                for (; ; ) {
                    long peak = jdbcExecutePeakUpdater.get(this);
                    if (executeCount <= peak) {
                        break;
                    }
                    if (jdbcExecutePeakUpdater.compareAndSet(this, peak, executeCount)) {
                        break;
                    }
                }
            }
            {
                long updateCount = localStat.getJdbcUpdateCount();
                this.addJdbcUpdateCount(updateCount);
                for (; ; ) {
                    long peak = jdbcUpdatePeakUpdater.get(this);
                    if (updateCount <= peak) {
                        break;
                    }
                    if (jdbcUpdatePeakUpdater.compareAndSet(this, peak, updateCount)) {
                        break;
                    }
                }
            }
            jdbcExecuteErrorCountUpdater.addAndGet(this, localStat.getJdbcExecuteErrorCount());
            jdbcExecuteTimeNanoUpdater.addAndGet(this, localStat.getJdbcExecuteTimeNano());
            this.addJdbcPoolConnectionOpenCount(localStat.getJdbcPoolConnectionOpenCount());
            this.addJdbcPoolConnectionCloseCount(localStat.getJdbcPoolConnectionCloseCount());
            this.addJdbcResultSetOpenCount(localStat.getJdbcResultSetOpenCount());
            this.addJdbcResultSetCloseCount(localStat.getJdbcResultSetCloseCount());
        }
    }
    currentLocal.set(null);
}||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(MethodCallExpr
				(ThisExpr
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				(ThisExpr
				)
				NameExpr
					SimpleName
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				SimpleName
			)
		)
		(IfStmt
			(BinaryExpr
				NameExpr
					SimpleName
				NullLiteralExpr
			)
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						(ThisExpr
						)
						SimpleName
						NameExpr
							SimpleName
					)
				)
			)
		)
		(BlockStmt
			(ExpressionStmt
				(VariableDeclarationExpr
					(VariableDeclarator
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
						SimpleName
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
			(IfStmt
				(BinaryExpr
					NameExpr
						SimpleName
					NullLiteralExpr
				)
				(BlockStmt
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(PrimitiveType
									)
								)
							)
						)
						(ExpressionStmt
							(MethodCallExpr
								NameExpr
									SimpleName
								SimpleName
								(ThisExpr
								)
							)
						)
						(ForStmt
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(MethodCallExpr
												(ThisExpr
												)
												SimpleName
												NameExpr
													SimpleName
											)
											SimpleName
											(PrimitiveType
											)
										)
									)
								)
								(IfStmt
									(BinaryExpr
										NameExpr
											SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
								(IfStmt
									(MethodCallExpr
										(ThisExpr
										)
										NameExpr
											SimpleName
										NameExpr
											SimpleName
										SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
							)
						)
					)
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(PrimitiveType
									)
								)
							)
						)
						(ExpressionStmt
							(MethodCallExpr
								NameExpr
									SimpleName
								SimpleName
								(ThisExpr
								)
							)
						)
						(ForStmt
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(MethodCallExpr
												(ThisExpr
												)
												SimpleName
												NameExpr
													SimpleName
											)
											SimpleName
											(PrimitiveType
											)
										)
									)
								)
								(IfStmt
									(BinaryExpr
										NameExpr
											SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
								(IfStmt
									(MethodCallExpr
										(ThisExpr
										)
										NameExpr
											SimpleName
										NameExpr
											SimpleName
										SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
							)
						)
					)
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(PrimitiveType
									)
								)
							)
						)
						(ExpressionStmt
							(MethodCallExpr
								NameExpr
									SimpleName
								SimpleName
								(ThisExpr
								)
							)
						)
						(ForStmt
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(MethodCallExpr
												(ThisExpr
												)
												SimpleName
												NameExpr
													SimpleName
											)
											SimpleName
											(PrimitiveType
											)
										)
									)
								)
								(IfStmt
									(BinaryExpr
										NameExpr
											SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
								(IfStmt
									(MethodCallExpr
										(ThisExpr
										)
										NameExpr
											SimpleName
										NameExpr
											SimpleName
										SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
							)
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(ThisExpr
							)
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							NameExpr
								SimpleName
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(ThisExpr
							)
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							NameExpr
								SimpleName
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							(ThisExpr
							)
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							(ThisExpr
							)
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							(ThisExpr
							)
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							(ThisExpr
							)
						)
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NullLiteralExpr
				SimpleName
				NameExpr
					SimpleName
			)
		)
	)
	(VoidType
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(Parameter
		SimpleName
		(PrimitiveType
		)
	)
)
||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(MethodCallExpr
				(ThisExpr
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				(ThisExpr
				)
				NameExpr
					SimpleName
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ForStmt
			(BlockStmt
				(ExpressionStmt
					(VariableDeclarationExpr
						(VariableDeclarator
							(MethodCallExpr
								(ThisExpr
								)
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							(PrimitiveType
							)
						)
					)
				)
				(IfStmt
					(BinaryExpr
						NameExpr
							SimpleName
						NameExpr
							SimpleName
					)
					(BlockStmt
						(BreakStmt
						)
					)
					(BlockStmt
						(IfStmt
							(MethodCallExpr
								(ThisExpr
								)
								NameExpr
									SimpleName
								NameExpr
									SimpleName
								SimpleName
								NameExpr
									SimpleName
							)
							(BlockStmt
								(ContinueStmt
								)
							)
							(BlockStmt
								(ExpressionStmt
									(AssignExpr
										NameExpr
											SimpleName
										(MethodCallExpr
											SimpleName
											NameExpr
												SimpleName
										)
									)
									LineComment
								)
								(BreakStmt
								)
							)
						)
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				SimpleName
			)
		)
		(IfStmt
			(BinaryExpr
				NameExpr
					SimpleName
				NullLiteralExpr
			)
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						(ThisExpr
						)
						SimpleName
						NameExpr
							SimpleName
					)
				)
			)
		)
		(BlockStmt
			(ExpressionStmt
				(VariableDeclarationExpr
					(VariableDeclarator
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
						SimpleName
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
			(IfStmt
				(BinaryExpr
					NameExpr
						SimpleName
					NullLiteralExpr
				)
				(BlockStmt
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(PrimitiveType
									)
								)
							)
						)
						(ExpressionStmt
							(MethodCallExpr
								NameExpr
									SimpleName
								SimpleName
								(ThisExpr
								)
							)
						)
						(ForStmt
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(MethodCallExpr
												(ThisExpr
												)
												SimpleName
												NameExpr
													SimpleName
											)
											SimpleName
											(PrimitiveType
											)
										)
									)
								)
								(IfStmt
									(BinaryExpr
										NameExpr
											SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
								(IfStmt
									(MethodCallExpr
										(ThisExpr
										)
										NameExpr
											SimpleName
										NameExpr
											SimpleName
										SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
							)
						)
					)
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(PrimitiveType
									)
								)
							)
						)
						(ExpressionStmt
							(MethodCallExpr
								NameExpr
									SimpleName
								SimpleName
								(ThisExpr
								)
							)
						)
						(ForStmt
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(MethodCallExpr
												(ThisExpr
												)
												SimpleName
												NameExpr
													SimpleName
											)
											SimpleName
											(PrimitiveType
											)
										)
									)
								)
								(IfStmt
									(BinaryExpr
										NameExpr
											SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
								(IfStmt
									(MethodCallExpr
										(ThisExpr
										)
										NameExpr
											SimpleName
										NameExpr
											SimpleName
										SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
							)
						)
					)
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(PrimitiveType
									)
								)
							)
						)
						(ExpressionStmt
							(MethodCallExpr
								NameExpr
									SimpleName
								SimpleName
								(ThisExpr
								)
							)
						)
						(ForStmt
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(MethodCallExpr
												(ThisExpr
												)
												SimpleName
												NameExpr
													SimpleName
											)
											SimpleName
											(PrimitiveType
											)
										)
									)
								)
								(IfStmt
									(BinaryExpr
										NameExpr
											SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
								(IfStmt
									(MethodCallExpr
										(ThisExpr
										)
										NameExpr
											SimpleName
										NameExpr
											SimpleName
										SimpleName
										NameExpr
											SimpleName
									)
									(BlockStmt
										(BreakStmt
										)
									)
								)
							)
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(ThisExpr
							)
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							NameExpr
								SimpleName
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(ThisExpr
							)
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							NameExpr
								SimpleName
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							(ThisExpr
							)
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							(ThisExpr
							)
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							(ThisExpr
							)
						)
					)
					(ExpressionStmt
						(MethodCallExpr
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							SimpleName
							(ThisExpr
							)
						)
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NullLiteralExpr
				SimpleName
				NameExpr
					SimpleName
			)
		)
	)
	(VoidType
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(Parameter
		SimpleName
		(PrimitiveType
		)
	)
)

