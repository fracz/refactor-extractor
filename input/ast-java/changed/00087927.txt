/**
 * Called by the appender that just appended a transaction to the log.
 *
 * @param logForceEvents A trace event for the given log append operation.
 */
protected void forceAfterAppend(LogForceEvents logForceEvents) throws IOException {
    // There's a benign race here, where we add our link before we update our next pointer.
    // This is okay, however, because unparkAll() spins when it sees a null next pointer.
    ThreadLink threadLink = new ThreadLink(Thread.currentThread());
    threadLink.next = threadLinkHead.getAndSet(threadLink);
    boolean attemptedForce = false;
    try (LogForceWaitEvent logForceWaitEvent = logForceEvents.beginLogForceWait()) {
        do {
            if (forceLock.tryLock()) {
                attemptedForce = true;
                try {
                    forceLog(logForceEvents);
                // In the event of any failure a database panic will be raised and thrown here
                } finally {
                    forceLock.unlock();
                    // We've released the lock, so unpark anyone who might have decided park while we were working.
                    // The most recently parked thread is the one most likely to still have warm caches, so that's
                    // the one we would prefer to unpark. Luckily, the stack nature of the ThreadLinks makes it easy
                    // to get to.
                    ThreadLink nextWaiter = threadLinkHead.get();
                    nextWaiter.unpark();
                }
            } else {
                waitForLogForce();
            }
        } while (!threadLink.done);
        // explicitly check if everything is OK before considering this transaction committed.
        if (!attemptedForce) {
            databaseHealth.assertHealthy(IOException.class);
        }
    }
}||||||||/**
 * Called by the appender that just appended a transaction to the log.
 *
 * @param logForceEvents A trace event for the given log append operation.
 * @return {@code true} if we got lucky and were the ones forcing the log.
 */
protected boolean forceAfterAppend(LogForceEvents logForceEvents) throws IOException {
    // There's a benign race here, where we add our link before we update our next pointer.
    // This is okay, however, because unparkAll() spins when it sees a null next pointer.
    ThreadLink threadLink = new ThreadLink(Thread.currentThread());
    threadLink.next = threadLinkHead.getAndSet(threadLink);
    boolean attemptedForce = false;
    try (LogForceWaitEvent logForceWaitEvent = logForceEvents.beginLogForceWait()) {
        do {
            if (forceLock.tryLock()) {
                attemptedForce = true;
                try {
                    forceLog(logForceEvents);
                // In the event of any failure a database panic will be raised and thrown here
                } finally {
                    forceLock.unlock();
                    // We've released the lock, so unpark anyone who might have decided park while we were working.
                    // The most recently parked thread is the one most likely to still have warm caches, so that's
                    // the one we would prefer to unpark. Luckily, the stack nature of the ThreadLinks makes it easy
                    // to get to.
                    ThreadLink nextWaiter = threadLinkHead.get();
                    nextWaiter.unpark();
                }
            } else {
                waitForLogForce();
            }
        } while (!threadLink.done);
        // explicitly check if everything is OK before considering this transaction committed.
        if (!attemptedForce) {
            databaseHealth.assertHealthy(IOException.class);
        }
    }
    return attemptedForce;
}||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ObjectCreationExpr
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
						(ClassOrInterfaceType
							SimpleName
						)
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
			LineComment
		)
		(ExpressionStmt
			(AssignExpr
				(FieldAccessExpr
					SimpleName
					NameExpr
						SimpleName
				)
				(MethodCallExpr
					NameExpr
						SimpleName
					SimpleName
					NameExpr
						SimpleName
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(BooleanLiteralExpr
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
		)
		(TryStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
			(BlockStmt
				(DoStmt
					(BlockStmt
						(IfStmt
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							(BlockStmt
								(ExpressionStmt
									(MethodCallExpr
										SimpleName
									)
								)
							)
							(BlockStmt
								(ExpressionStmt
									(AssignExpr
										NameExpr
											SimpleName
										(BooleanLiteralExpr
										)
									)
								)
								(TryStmt
									(BlockStmt
										(ExpressionStmt
											(MethodCallExpr
												SimpleName
												NameExpr
													SimpleName
											)
										)
										(ExpressionStmt
											(VariableDeclarationExpr
												(VariableDeclarator
													(MethodCallExpr
														SimpleName
														NameExpr
															SimpleName
													)
													SimpleName
													(ClassOrInterfaceType
														SimpleName
													)
												)
											)
											LineComment
										)
										(ExpressionStmt
											(MethodCallExpr
												SimpleName
												NameExpr
													SimpleName
											)
										)
									)
									(BlockStmt
										(ExpressionStmt
											(MethodCallExpr
												NameExpr
													SimpleName
												SimpleName
											)
										)
									)
								)
							)
						)
					)
					(UnaryExpr
						(FieldAccessExpr
							SimpleName
							NameExpr
								SimpleName
						)
					)
				)
				(IfStmt
					(UnaryExpr
						NameExpr
							SimpleName
					)
					(BlockStmt
						(ExpressionStmt
							(MethodCallExpr
								(ClassExpr
									(ClassOrInterfaceType
										SimpleName
									)
								)
								SimpleName
								NameExpr
									SimpleName
							)
						)
					)
					LineComment
				)
			)
		)
	)
	(VoidType
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(ClassOrInterfaceType
		SimpleName
	)
	(JavadocComment
	)
)
||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ObjectCreationExpr
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
						(ClassOrInterfaceType
							SimpleName
						)
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
			LineComment
		)
		(ExpressionStmt
			(AssignExpr
				(FieldAccessExpr
					SimpleName
					NameExpr
						SimpleName
				)
				(MethodCallExpr
					NameExpr
						SimpleName
					SimpleName
					NameExpr
						SimpleName
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(BooleanLiteralExpr
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
		)
		(TryStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
			(BlockStmt
				(DoStmt
					(BlockStmt
						(IfStmt
							(MethodCallExpr
								SimpleName
								NameExpr
									SimpleName
							)
							(BlockStmt
								(ExpressionStmt
									(MethodCallExpr
										SimpleName
									)
								)
							)
							(BlockStmt
								(ExpressionStmt
									(AssignExpr
										NameExpr
											SimpleName
										(BooleanLiteralExpr
										)
									)
								)
								(TryStmt
									(BlockStmt
										(ExpressionStmt
											(MethodCallExpr
												SimpleName
												NameExpr
													SimpleName
											)
										)
										(ExpressionStmt
											(VariableDeclarationExpr
												(VariableDeclarator
													(MethodCallExpr
														SimpleName
														NameExpr
															SimpleName
													)
													SimpleName
													(ClassOrInterfaceType
														SimpleName
													)
												)
											)
											LineComment
										)
										(ExpressionStmt
											(MethodCallExpr
												SimpleName
												NameExpr
													SimpleName
											)
										)
									)
									(BlockStmt
										(ExpressionStmt
											(MethodCallExpr
												NameExpr
													SimpleName
												SimpleName
											)
										)
									)
								)
							)
						)
					)
					(UnaryExpr
						(FieldAccessExpr
							SimpleName
							NameExpr
								SimpleName
						)
					)
				)
				(IfStmt
					(UnaryExpr
						NameExpr
							SimpleName
					)
					(BlockStmt
						(ExpressionStmt
							(MethodCallExpr
								(ClassExpr
									(ClassOrInterfaceType
										SimpleName
									)
								)
								SimpleName
								NameExpr
									SimpleName
							)
						)
					)
					LineComment
				)
			)
		)
		(ReturnStmt
			NameExpr
				SimpleName
		)
	)
	(PrimitiveType
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(ClassOrInterfaceType
		SimpleName
	)
	(JavadocComment
	)
)

