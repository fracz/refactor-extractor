@Test
public void testInWorker() throws Exception {
    vertx.deployVerticle(new AbstractVerticle() {

        @Override
        public void start() throws Exception {
            assertTrue(Vertx.currentContext().isWorkerContext());
            assertTrue(Context.isOnWorkerThread());
            HttpServer server1 = vertx.createHttpServer(new HttpServerOptions().setHost(HttpTestBase.DEFAULT_HTTP_HOST).setPort(HttpTestBase.DEFAULT_HTTP_PORT));
            server1.requestHandler(req -> {
                assertTrue(Vertx.currentContext().isWorkerContext());
                assertTrue(Context.isOnWorkerThread());
                Buffer buf = Buffer.buffer();
                req.handler(buf::appendBuffer);
                req.endHandler(v -> {
                    assertEquals("hello", buf.toString());
                    req.response().end();
                });
            }).listen(onSuccess(s -> {
                assertTrue(Vertx.currentContext().isWorkerContext());
                assertTrue(Context.isOnWorkerThread());
                HttpClient client = vertx.createHttpClient();
                client.put(HttpTestBase.DEFAULT_HTTP_PORT, HttpTestBase.DEFAULT_HTTP_HOST, "/blah", resp -> {
                    assertEquals(200, resp.statusCode());
                    assertTrue(Vertx.currentContext().isWorkerContext());
                    assertTrue(Context.isOnWorkerThread());
                    testComplete();
                }).setChunked(true).write(Buffer.buffer("hello")).end();
            }));
        }
    }, new DeploymentOptions().setWorker(true));
    await();
}||||||||@Test
public void testInWorker() throws Exception {
    vertx.deployVerticle(new AbstractVerticle() {

        @Override
        public void start() throws Exception {
            assertTrue(Vertx.currentContext().isWorkerContext());
            assertTrue(Context.isOnWorkerThread());
            HttpServer server1 = vertx.createHttpServer(new HttpServerOptions().setHost(HttpTestBase.DEFAULT_HTTP_HOST).setPort(HttpTestBase.DEFAULT_HTTP_PORT));
            server1.requestHandler(req -> {
                assertTrue(Vertx.currentContext().isWorkerContext());
                assertTrue(Context.isOnWorkerThread());
                Buffer buf = Buffer.buffer();
                req.handler(buf::appendBuffer);
                req.endHandler(v -> {
                    assertEquals("hello", buf.toString());
                    req.response().end("bye");
                });
            }).listen(onSuccess(s -> {
                assertTrue(Vertx.currentContext().isWorkerContext());
                assertTrue(Context.isOnWorkerThread());
                HttpClient client = vertx.createHttpClient();
                client.put(HttpTestBase.DEFAULT_HTTP_PORT, HttpTestBase.DEFAULT_HTTP_HOST, "/blah", resp -> {
                    assertEquals(200, resp.statusCode());
                    assertTrue(Vertx.currentContext().isWorkerContext());
                    assertTrue(Context.isOnWorkerThread());
                    resp.handler(buf -> {
                        assertEquals("bye", buf.toString());
                        resp.endHandler(v -> {
                            testComplete();
                        });
                    });
                }).setChunked(true).write(Buffer.buffer("hello")).end();
            }));
        }
    }, new DeploymentOptions().setWorker(true));
    await();
}||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(MethodCallExpr
				(ObjectCreationExpr
					(MethodDeclaration
						(BlockStmt
							(ExpressionStmt
								(MethodCallExpr
									(MethodCallExpr
										SimpleName
										(MethodCallExpr
											SimpleName
											NameExpr
												SimpleName
										)
									)
									SimpleName
								)
							)
							(ExpressionStmt
								(MethodCallExpr
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
								)
							)
							(ExpressionStmt
								(VariableDeclarationExpr
									(VariableDeclarator
										(MethodCallExpr
											(MethodCallExpr
												(FieldAccessExpr
													SimpleName
													NameExpr
														SimpleName
												)
												SimpleName
												(MethodCallExpr
													(FieldAccessExpr
														SimpleName
														NameExpr
															SimpleName
													)
													SimpleName
													(ObjectCreationExpr
														(ClassOrInterfaceType
															SimpleName
														)
													)
												)
											)
											SimpleName
											NameExpr
												SimpleName
										)
										SimpleName
										(ClassOrInterfaceType
											SimpleName
										)
									)
								)
							)
							(ExpressionStmt
								(MethodCallExpr
									(MethodCallExpr
										(LambdaExpr
											(BlockStmt
												(ExpressionStmt
													(MethodCallExpr
														(MethodCallExpr
															SimpleName
															(MethodCallExpr
																SimpleName
																NameExpr
																	SimpleName
															)
														)
														SimpleName
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														(MethodCallExpr
															SimpleName
															NameExpr
																SimpleName
														)
														SimpleName
													)
												)
												(ExpressionStmt
													(VariableDeclarationExpr
														(VariableDeclarator
															(MethodCallExpr
																SimpleName
																NameExpr
																	SimpleName
															)
															SimpleName
															(ClassOrInterfaceType
																SimpleName
															)
														)
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														SimpleName
														(MethodCallExpr
															(MethodCallExpr
																StringLiteralExpr
																SimpleName
																NameExpr
																	SimpleName
															)
															SimpleName
															(MethodCallExpr
																(BooleanLiteralExpr
																)
																SimpleName
																(MethodCallExpr
																	(FieldAccessExpr
																		SimpleName
																		NameExpr
																			SimpleName
																	)
																	(FieldAccessExpr
																		SimpleName
																		NameExpr
																			SimpleName
																	)
																	StringLiteralExpr
																	(LambdaExpr
																		(BlockStmt
																			(ExpressionStmt
																				(MethodCallExpr
																					(IntegerLiteralExpr
																					)
																					(MethodCallExpr
																						SimpleName
																						NameExpr
																							SimpleName
																					)
																					SimpleName
																				)
																			)
																			(ExpressionStmt
																				(MethodCallExpr
																					(MethodCallExpr
																						SimpleName
																						(MethodCallExpr
																							SimpleName
																							NameExpr
																								SimpleName
																						)
																					)
																					SimpleName
																				)
																			)
																			(ExpressionStmt
																				(MethodCallExpr
																					(MethodCallExpr
																						SimpleName
																						NameExpr
																							SimpleName
																					)
																					SimpleName
																				)
																			)
																			(ExpressionStmt
																				(MethodCallExpr
																					SimpleName
																				)
																			)
																		)
																		(Parameter
																			SimpleName
																			(UnknownType
																			)
																		)
																	)
																	SimpleName
																	NameExpr
																		SimpleName
																)
															)
														)
													)
												)
											)
											(Parameter
												SimpleName
												(UnknownType
												)
											)
										)
										SimpleName
									)
									SimpleName
									(MethodCallExpr
										(LambdaExpr
											(BlockStmt
												(ExpressionStmt
													(MethodCallExpr
														(MethodCallExpr
															SimpleName
															(MethodCallExpr
																SimpleName
																NameExpr
																	SimpleName
															)
														)
														SimpleName
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														(MethodCallExpr
															SimpleName
															NameExpr
																SimpleName
														)
														SimpleName
													)
												)
												(ExpressionStmt
													(VariableDeclarationExpr
														(VariableDeclarator
															(MethodCallExpr
																SimpleName
																NameExpr
																	SimpleName
															)
															SimpleName
															(ClassOrInterfaceType
																SimpleName
															)
														)
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														(MethodReferenceExpr
															(TypeExpr
																(ClassOrInterfaceType
																	SimpleName
																)
															)
														)
														SimpleName
														NameExpr
															SimpleName
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														(LambdaExpr
															(BlockStmt
																(ExpressionStmt
																	(MethodCallExpr
																		StringLiteralExpr
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																		SimpleName
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
															)
															(Parameter
																SimpleName
																(UnknownType
																)
															)
														)
														SimpleName
														NameExpr
															SimpleName
													)
												)
											)
											(Parameter
												SimpleName
												(UnknownType
												)
											)
										)
										SimpleName
										NameExpr
											SimpleName
									)
								)
							)
						)
						(VoidType
						)
						SimpleName
						(ClassOrInterfaceType
							SimpleName
						)
						(MarkerAnnotationExpr
							Name
						)
					)
					(ClassOrInterfaceType
						SimpleName
					)
				)
				(MethodCallExpr
					(BooleanLiteralExpr
					)
					SimpleName
					(ObjectCreationExpr
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				SimpleName
			)
		)
	)
	(VoidType
	)
	SimpleName
	(ClassOrInterfaceType
		SimpleName
	)
	(MarkerAnnotationExpr
		Name
	)
)
||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(MethodCallExpr
				(ObjectCreationExpr
					(MethodDeclaration
						(BlockStmt
							(ExpressionStmt
								(MethodCallExpr
									(MethodCallExpr
										SimpleName
										(MethodCallExpr
											SimpleName
											NameExpr
												SimpleName
										)
									)
									SimpleName
								)
							)
							(ExpressionStmt
								(MethodCallExpr
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
								)
							)
							(ExpressionStmt
								(VariableDeclarationExpr
									(VariableDeclarator
										(MethodCallExpr
											(MethodCallExpr
												(FieldAccessExpr
													SimpleName
													NameExpr
														SimpleName
												)
												SimpleName
												(MethodCallExpr
													(FieldAccessExpr
														SimpleName
														NameExpr
															SimpleName
													)
													SimpleName
													(ObjectCreationExpr
														(ClassOrInterfaceType
															SimpleName
														)
													)
												)
											)
											SimpleName
											NameExpr
												SimpleName
										)
										SimpleName
										(ClassOrInterfaceType
											SimpleName
										)
									)
								)
							)
							(ExpressionStmt
								(MethodCallExpr
									(MethodCallExpr
										(LambdaExpr
											(BlockStmt
												(ExpressionStmt
													(MethodCallExpr
														(MethodCallExpr
															SimpleName
															(MethodCallExpr
																SimpleName
																NameExpr
																	SimpleName
															)
														)
														SimpleName
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														(MethodCallExpr
															SimpleName
															NameExpr
																SimpleName
														)
														SimpleName
													)
												)
												(ExpressionStmt
													(VariableDeclarationExpr
														(VariableDeclarator
															(MethodCallExpr
																SimpleName
																NameExpr
																	SimpleName
															)
															SimpleName
															(ClassOrInterfaceType
																SimpleName
															)
														)
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														SimpleName
														(MethodCallExpr
															(MethodCallExpr
																StringLiteralExpr
																SimpleName
																NameExpr
																	SimpleName
															)
															SimpleName
															(MethodCallExpr
																(BooleanLiteralExpr
																)
																SimpleName
																(MethodCallExpr
																	(FieldAccessExpr
																		SimpleName
																		NameExpr
																			SimpleName
																	)
																	(FieldAccessExpr
																		SimpleName
																		NameExpr
																			SimpleName
																	)
																	StringLiteralExpr
																	(LambdaExpr
																		(BlockStmt
																			(ExpressionStmt
																				(MethodCallExpr
																					(IntegerLiteralExpr
																					)
																					(MethodCallExpr
																						SimpleName
																						NameExpr
																							SimpleName
																					)
																					SimpleName
																				)
																			)
																			(ExpressionStmt
																				(MethodCallExpr
																					(MethodCallExpr
																						SimpleName
																						(MethodCallExpr
																							SimpleName
																							NameExpr
																								SimpleName
																						)
																					)
																					SimpleName
																				)
																			)
																			(ExpressionStmt
																				(MethodCallExpr
																					(MethodCallExpr
																						SimpleName
																						NameExpr
																							SimpleName
																					)
																					SimpleName
																				)
																			)
																			(ExpressionStmt
																				(MethodCallExpr
																					(LambdaExpr
																						(BlockStmt
																							(ExpressionStmt
																								(MethodCallExpr
																									StringLiteralExpr
																									(MethodCallExpr
																										SimpleName
																										NameExpr
																											SimpleName
																									)
																									SimpleName
																								)
																							)
																							(ExpressionStmt
																								(MethodCallExpr
																									(LambdaExpr
																										(BlockStmt
																											(ExpressionStmt
																												(MethodCallExpr
																													SimpleName
																												)
																											)
																										)
																										(Parameter
																											SimpleName
																											(UnknownType
																											)
																										)
																									)
																									SimpleName
																									NameExpr
																										SimpleName
																								)
																							)
																						)
																						(Parameter
																							SimpleName
																							(UnknownType
																							)
																						)
																					)
																					SimpleName
																					NameExpr
																						SimpleName
																				)
																			)
																		)
																		(Parameter
																			SimpleName
																			(UnknownType
																			)
																		)
																	)
																	SimpleName
																	NameExpr
																		SimpleName
																)
															)
														)
													)
												)
											)
											(Parameter
												SimpleName
												(UnknownType
												)
											)
										)
										SimpleName
									)
									SimpleName
									(MethodCallExpr
										(LambdaExpr
											(BlockStmt
												(ExpressionStmt
													(MethodCallExpr
														(MethodCallExpr
															SimpleName
															(MethodCallExpr
																SimpleName
																NameExpr
																	SimpleName
															)
														)
														SimpleName
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														(MethodCallExpr
															SimpleName
															NameExpr
																SimpleName
														)
														SimpleName
													)
												)
												(ExpressionStmt
													(VariableDeclarationExpr
														(VariableDeclarator
															(MethodCallExpr
																SimpleName
																NameExpr
																	SimpleName
															)
															SimpleName
															(ClassOrInterfaceType
																SimpleName
															)
														)
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														(MethodReferenceExpr
															(TypeExpr
																(ClassOrInterfaceType
																	SimpleName
																)
															)
														)
														SimpleName
														NameExpr
															SimpleName
													)
												)
												(ExpressionStmt
													(MethodCallExpr
														(LambdaExpr
															(BlockStmt
																(ExpressionStmt
																	(MethodCallExpr
																		StringLiteralExpr
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																		SimpleName
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		StringLiteralExpr
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
															)
															(Parameter
																SimpleName
																(UnknownType
																)
															)
														)
														SimpleName
														NameExpr
															SimpleName
													)
												)
											)
											(Parameter
												SimpleName
												(UnknownType
												)
											)
										)
										SimpleName
										NameExpr
											SimpleName
									)
								)
							)
						)
						(VoidType
						)
						SimpleName
						(ClassOrInterfaceType
							SimpleName
						)
						(MarkerAnnotationExpr
							Name
						)
					)
					(ClassOrInterfaceType
						SimpleName
					)
				)
				(MethodCallExpr
					(BooleanLiteralExpr
					)
					SimpleName
					(ObjectCreationExpr
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				SimpleName
			)
		)
	)
	(VoidType
	)
	SimpleName
	(ClassOrInterfaceType
		SimpleName
	)
	(MarkerAnnotationExpr
		Name
	)
)

