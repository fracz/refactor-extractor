private Runnable createAdditionRunnable(final Project project, final SvnVcs vcs, final Map<VirtualFile, File> copyFromMap, final Collection<VirtualFile> filesToProcess, final List<VcsException> exceptions) {
    return new Runnable() {

        @Override
        public void run() {
            final SVNWCClient wcClient = vcs.createWCClient();
            final SVNCopyClient copyClient = vcs.createCopyClient();
            for (VirtualFile file : filesToProcess) {
                final File ioFile = new File(file.getPath());
                try {
                    final File copyFrom = copyFromMap.get(file);
                    if (copyFrom != null) {
                        try {
                            new ActionWithTempFile(ioFile) {

                                protected void executeInternal() throws VcsException {
                                    try {
                                        // not recursive
                                        final SVNCopySource[] copySource = { new SVNCopySource(SVNRevision.WORKING, SVNRevision.WORKING, copyFrom) };
                                        new RepeatSvnActionThroughBusy() {

                                            @Override
                                            protected void executeImpl() throws SVNException {
                                                copyClient.doCopy(copySource, ioFile, false, true, true);
                                            }
                                        }.execute();
                                    } catch (SVNException e) {
                                        throw new VcsException(e);
                                    }
                                }
                            }.execute();
                        } catch (VcsException e) {
                            exceptions.add(e);
                        }
                    } else {
                        new RepeatSvnActionThroughBusy() {

                            @Override
                            protected void executeImpl() throws SVNException {
                                WorkingCopyFormat format = vcs.getWorkingCopyFormat(ioFile);
                                if (WorkingCopyFormat.ONE_DOT_EIGHT.equals(format)) {
                                    SvnAddClient client = new SvnAddClient(project);
                                    try {
                                        client.add(ioFile, null, false, false, true);
                                    } catch (VcsException e) {
                                        throw new SVNException(SVNErrorMessage.create(SVNErrorCode.FS_GENERAL), e);
                                    }
                                } else {
                                    wcClient.doAdd(ioFile, true, false, false, true);
                                }
                            }
                        }.execute();
                    }
                    VcsDirtyScopeManager.getInstance(project).fileDirty(file);
                } catch (SVNException e) {
                    exceptions.add(new VcsException(e));
                }
            }
        }
    };
}||||||||private Runnable createAdditionRunnable(final Project project, final SvnVcs vcs, final Map<VirtualFile, File> copyFromMap, final Collection<VirtualFile> filesToProcess, final List<VcsException> exceptions) {
    return new Runnable() {

        @Override
        public void run() {
            final SVNWCClient wcClient = vcs.createWCClient();
            final SVNCopyClient copyClient = vcs.createCopyClient();
            for (VirtualFile file : filesToProcess) {
                final File ioFile = new File(file.getPath());
                try {
                    final File copyFrom = copyFromMap.get(file);
                    if (copyFrom != null) {
                        try {
                            new ActionWithTempFile(ioFile) {

                                protected void executeInternal() throws VcsException {
                                    try {
                                        // not recursive
                                        final SVNCopySource[] copySource = { new SVNCopySource(SVNRevision.WORKING, SVNRevision.WORKING, copyFrom) };
                                        new RepeatSvnActionThroughBusy() {

                                            @Override
                                            protected void executeImpl() throws SVNException {
                                                copyClient.doCopy(copySource, ioFile, false, true, true);
                                            }
                                        }.execute();
                                    } catch (SVNException e) {
                                        throw new VcsException(e);
                                    }
                                }
                            }.execute();
                        } catch (VcsException e) {
                            exceptions.add(e);
                        }
                    } else {
                        new RepeatSvnActionThroughBusy() {

                            @Override
                            protected void executeImpl() throws SVNException {
                                try {
                                    vcs.getFactory(ioFile).createAddClient().add(ioFile, null, false, false, true);
                                } catch (VcsException e) {
                                    throw new SVNException(SVNErrorMessage.create(SVNErrorCode.FS_GENERAL), e);
                                }
                            }
                        }.execute();
                    }
                    VcsDirtyScopeManager.getInstance(project).fileDirty(file);
                } catch (SVNException e) {
                    exceptions.add(new VcsException(e));
                }
            }
        }
    };
}||||||||(MethodDeclaration
	(BlockStmt
		(ReturnStmt
			(ObjectCreationExpr
				(MethodDeclaration
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(ClassOrInterfaceType
										SimpleName
									)
								)
							)
						)
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(ClassOrInterfaceType
										SimpleName
									)
								)
							)
						)
						(ForeachStmt
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(ObjectCreationExpr
												(MethodCallExpr
													SimpleName
													NameExpr
														SimpleName
												)
												(ClassOrInterfaceType
													SimpleName
												)
											)
											SimpleName
											(ClassOrInterfaceType
												SimpleName
											)
										)
									)
								)
								(TryStmt
									(CatchClause
										(BlockStmt
											(ExpressionStmt
												(MethodCallExpr
													(ObjectCreationExpr
														NameExpr
															SimpleName
														(ClassOrInterfaceType
															SimpleName
														)
													)
													SimpleName
													NameExpr
														SimpleName
												)
											)
										)
										(Parameter
											SimpleName
											(ClassOrInterfaceType
												SimpleName
											)
										)
									)
									(BlockStmt
										(ExpressionStmt
											(VariableDeclarationExpr
												(VariableDeclarator
													(MethodCallExpr
														NameExpr
															SimpleName
														SimpleName
														NameExpr
															SimpleName
													)
													SimpleName
													(ClassOrInterfaceType
														SimpleName
													)
												)
											)
										)
										(IfStmt
											(BinaryExpr
												NameExpr
													SimpleName
												NullLiteralExpr
											)
											(BlockStmt
												(ExpressionStmt
													(MethodCallExpr
														SimpleName
														(ObjectCreationExpr
															(MethodDeclaration
																(BlockStmt
																	(ExpressionStmt
																		(VariableDeclarationExpr
																			(VariableDeclarator
																				(MethodCallExpr
																					NameExpr
																						SimpleName
																					SimpleName
																					NameExpr
																						SimpleName
																				)
																				SimpleName
																				(ClassOrInterfaceType
																					SimpleName
																				)
																			)
																		)
																	)
																	(IfStmt
																		(MethodCallExpr
																			NameExpr
																				SimpleName
																			SimpleName
																			(FieldAccessExpr
																				SimpleName
																				NameExpr
																					SimpleName
																			)
																		)
																		(BlockStmt
																			(ExpressionStmt
																				(MethodCallExpr
																					NameExpr
																						SimpleName
																					(BooleanLiteralExpr
																					)
																					(BooleanLiteralExpr
																					)
																					(BooleanLiteralExpr
																					)
																					(BooleanLiteralExpr
																					)
																					SimpleName
																					NameExpr
																						SimpleName
																				)
																			)
																		)
																		(BlockStmt
																			(ExpressionStmt
																				(VariableDeclarationExpr
																					(VariableDeclarator
																						(ObjectCreationExpr
																							NameExpr
																								SimpleName
																							(ClassOrInterfaceType
																								SimpleName
																							)
																						)
																						SimpleName
																						(ClassOrInterfaceType
																							SimpleName
																						)
																					)
																				)
																			)
																			(TryStmt
																				(CatchClause
																					(BlockStmt
																						(ThrowStmt
																							(ObjectCreationExpr
																								(MethodCallExpr
																									(FieldAccessExpr
																										SimpleName
																										NameExpr
																											SimpleName
																									)
																									SimpleName
																									NameExpr
																										SimpleName
																								)
																								NameExpr
																									SimpleName
																								(ClassOrInterfaceType
																									SimpleName
																								)
																							)
																						)
																					)
																					(Parameter
																						SimpleName
																						(ClassOrInterfaceType
																							SimpleName
																						)
																					)
																				)
																				(BlockStmt
																					(ExpressionStmt
																						(MethodCallExpr
																							NameExpr
																								SimpleName
																							NullLiteralExpr
																							(BooleanLiteralExpr
																							)
																							(BooleanLiteralExpr
																							)
																							(BooleanLiteralExpr
																							)
																							SimpleName
																							NameExpr
																								SimpleName
																						)
																					)
																				)
																			)
																		)
																	)
																)
																(VoidType
																)
																SimpleName
																(ClassOrInterfaceType
																	SimpleName
																)
																(MarkerAnnotationExpr
																	Name
																)
															)
															(ClassOrInterfaceType
																SimpleName
															)
														)
													)
												)
											)
											(BlockStmt
												(TryStmt
													(CatchClause
														(BlockStmt
															(ExpressionStmt
																(MethodCallExpr
																	NameExpr
																		SimpleName
																	SimpleName
																	NameExpr
																		SimpleName
																)
															)
														)
														(Parameter
															SimpleName
															(ClassOrInterfaceType
																SimpleName
															)
														)
													)
													(BlockStmt
														(ExpressionStmt
															(MethodCallExpr
																SimpleName
																(ObjectCreationExpr
																	(MethodDeclaration
																		(BlockStmt
																			(TryStmt
																				(CatchClause
																					(BlockStmt
																						(ThrowStmt
																							(ObjectCreationExpr
																								NameExpr
																									SimpleName
																								(ClassOrInterfaceType
																									SimpleName
																								)
																							)
																						)
																					)
																					(Parameter
																						SimpleName
																						(ClassOrInterfaceType
																							SimpleName
																						)
																					)
																				)
																				(BlockStmt
																					(ExpressionStmt
																						(VariableDeclarationExpr
																							(VariableDeclarator
																								(ArrayInitializerExpr
																									(ObjectCreationExpr
																										(FieldAccessExpr
																											SimpleName
																											NameExpr
																												SimpleName
																										)
																										(FieldAccessExpr
																											SimpleName
																											NameExpr
																												SimpleName
																										)
																										NameExpr
																											SimpleName
																										(ClassOrInterfaceType
																											SimpleName
																										)
																									)
																								)
																								SimpleName
																								(ArrayType
																									(ClassOrInterfaceType
																										SimpleName
																									)
																								)
																							)
																						)
																						LineComment
																					)
																					(ExpressionStmt
																						(MethodCallExpr
																							SimpleName
																							(ObjectCreationExpr
																								(MethodDeclaration
																									(BlockStmt
																										(ExpressionStmt
																											(MethodCallExpr
																												NameExpr
																													SimpleName
																												NameExpr
																													SimpleName
																												(BooleanLiteralExpr
																												)
																												(BooleanLiteralExpr
																												)
																												(BooleanLiteralExpr
																												)
																												SimpleName
																												NameExpr
																													SimpleName
																											)
																										)
																									)
																									(VoidType
																									)
																									SimpleName
																									(ClassOrInterfaceType
																										SimpleName
																									)
																									(MarkerAnnotationExpr
																										Name
																									)
																								)
																								(ClassOrInterfaceType
																									SimpleName
																								)
																							)
																						)
																					)
																				)
																			)
																		)
																		(VoidType
																		)
																		SimpleName
																		(ClassOrInterfaceType
																			SimpleName
																		)
																	)
																	NameExpr
																		SimpleName
																	(ClassOrInterfaceType
																		SimpleName
																	)
																)
															)
														)
													)
												)
											)
										)
										(ExpressionStmt
											(MethodCallExpr
												NameExpr
													SimpleName
												SimpleName
												(MethodCallExpr
													NameExpr
														SimpleName
													SimpleName
													NameExpr
														SimpleName
												)
											)
										)
									)
								)
							)
							NameExpr
								SimpleName
							(VariableDeclarationExpr
								(VariableDeclarator
									SimpleName
									(ClassOrInterfaceType
										SimpleName
									)
								)
							)
						)
					)
					(VoidType
					)
					SimpleName
					(MarkerAnnotationExpr
						Name
					)
				)
				(ClassOrInterfaceType
					SimpleName
				)
			)
		)
	)
	(ClassOrInterfaceType
		SimpleName
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
			(ClassOrInterfaceType
				SimpleName
			)
			(ClassOrInterfaceType
				SimpleName
			)
		)
	)
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
			(ClassOrInterfaceType
				SimpleName
			)
		)
	)
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
			(ClassOrInterfaceType
				SimpleName
			)
		)
	)
)
||||||||(MethodDeclaration
	(BlockStmt
		(ReturnStmt
			(ObjectCreationExpr
				(MethodDeclaration
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(ClassOrInterfaceType
										SimpleName
									)
								)
							)
						)
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(ClassOrInterfaceType
										SimpleName
									)
								)
							)
						)
						(ForeachStmt
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(ObjectCreationExpr
												(MethodCallExpr
													SimpleName
													NameExpr
														SimpleName
												)
												(ClassOrInterfaceType
													SimpleName
												)
											)
											SimpleName
											(ClassOrInterfaceType
												SimpleName
											)
										)
									)
								)
								(TryStmt
									(CatchClause
										(BlockStmt
											(ExpressionStmt
												(MethodCallExpr
													(ObjectCreationExpr
														NameExpr
															SimpleName
														(ClassOrInterfaceType
															SimpleName
														)
													)
													SimpleName
													NameExpr
														SimpleName
												)
											)
										)
										(Parameter
											SimpleName
											(ClassOrInterfaceType
												SimpleName
											)
										)
									)
									(BlockStmt
										(ExpressionStmt
											(VariableDeclarationExpr
												(VariableDeclarator
													(MethodCallExpr
														NameExpr
															SimpleName
														SimpleName
														NameExpr
															SimpleName
													)
													SimpleName
													(ClassOrInterfaceType
														SimpleName
													)
												)
											)
										)
										(IfStmt
											(BinaryExpr
												NameExpr
													SimpleName
												NullLiteralExpr
											)
											(BlockStmt
												(ExpressionStmt
													(MethodCallExpr
														SimpleName
														(ObjectCreationExpr
															(MethodDeclaration
																(BlockStmt
																	(TryStmt
																		(CatchClause
																			(BlockStmt
																				(ThrowStmt
																					(ObjectCreationExpr
																						(MethodCallExpr
																							(FieldAccessExpr
																								SimpleName
																								NameExpr
																									SimpleName
																							)
																							SimpleName
																							NameExpr
																								SimpleName
																						)
																						NameExpr
																							SimpleName
																						(ClassOrInterfaceType
																							SimpleName
																						)
																					)
																				)
																			)
																			(Parameter
																				SimpleName
																				(ClassOrInterfaceType
																					SimpleName
																				)
																			)
																		)
																		(BlockStmt
																			(ExpressionStmt
																				(MethodCallExpr
																					NameExpr
																						SimpleName
																					NullLiteralExpr
																					(BooleanLiteralExpr
																					)
																					(BooleanLiteralExpr
																					)
																					(BooleanLiteralExpr
																					)
																					SimpleName
																					(MethodCallExpr
																						SimpleName
																						(MethodCallExpr
																							NameExpr
																								SimpleName
																							SimpleName
																							NameExpr
																								SimpleName
																						)
																					)
																				)
																			)
																		)
																	)
																)
																(VoidType
																)
																SimpleName
																(ClassOrInterfaceType
																	SimpleName
																)
																(MarkerAnnotationExpr
																	Name
																)
															)
															(ClassOrInterfaceType
																SimpleName
															)
														)
													)
												)
											)
											(BlockStmt
												(TryStmt
													(CatchClause
														(BlockStmt
															(ExpressionStmt
																(MethodCallExpr
																	NameExpr
																		SimpleName
																	SimpleName
																	NameExpr
																		SimpleName
																)
															)
														)
														(Parameter
															SimpleName
															(ClassOrInterfaceType
																SimpleName
															)
														)
													)
													(BlockStmt
														(ExpressionStmt
															(MethodCallExpr
																SimpleName
																(ObjectCreationExpr
																	(MethodDeclaration
																		(BlockStmt
																			(TryStmt
																				(CatchClause
																					(BlockStmt
																						(ThrowStmt
																							(ObjectCreationExpr
																								NameExpr
																									SimpleName
																								(ClassOrInterfaceType
																									SimpleName
																								)
																							)
																						)
																					)
																					(Parameter
																						SimpleName
																						(ClassOrInterfaceType
																							SimpleName
																						)
																					)
																				)
																				(BlockStmt
																					(ExpressionStmt
																						(VariableDeclarationExpr
																							(VariableDeclarator
																								(ArrayInitializerExpr
																									(ObjectCreationExpr
																										(FieldAccessExpr
																											SimpleName
																											NameExpr
																												SimpleName
																										)
																										(FieldAccessExpr
																											SimpleName
																											NameExpr
																												SimpleName
																										)
																										NameExpr
																											SimpleName
																										(ClassOrInterfaceType
																											SimpleName
																										)
																									)
																								)
																								SimpleName
																								(ArrayType
																									(ClassOrInterfaceType
																										SimpleName
																									)
																								)
																							)
																						)
																						LineComment
																					)
																					(ExpressionStmt
																						(MethodCallExpr
																							SimpleName
																							(ObjectCreationExpr
																								(MethodDeclaration
																									(BlockStmt
																										(ExpressionStmt
																											(MethodCallExpr
																												NameExpr
																													SimpleName
																												NameExpr
																													SimpleName
																												(BooleanLiteralExpr
																												)
																												(BooleanLiteralExpr
																												)
																												(BooleanLiteralExpr
																												)
																												SimpleName
																												NameExpr
																													SimpleName
																											)
																										)
																									)
																									(VoidType
																									)
																									SimpleName
																									(ClassOrInterfaceType
																										SimpleName
																									)
																									(MarkerAnnotationExpr
																										Name
																									)
																								)
																								(ClassOrInterfaceType
																									SimpleName
																								)
																							)
																						)
																					)
																				)
																			)
																		)
																		(VoidType
																		)
																		SimpleName
																		(ClassOrInterfaceType
																			SimpleName
																		)
																	)
																	NameExpr
																		SimpleName
																	(ClassOrInterfaceType
																		SimpleName
																	)
																)
															)
														)
													)
												)
											)
										)
										(ExpressionStmt
											(MethodCallExpr
												NameExpr
													SimpleName
												SimpleName
												(MethodCallExpr
													NameExpr
														SimpleName
													SimpleName
													NameExpr
														SimpleName
												)
											)
										)
									)
								)
							)
							NameExpr
								SimpleName
							(VariableDeclarationExpr
								(VariableDeclarator
									SimpleName
									(ClassOrInterfaceType
										SimpleName
									)
								)
							)
						)
					)
					(VoidType
					)
					SimpleName
					(MarkerAnnotationExpr
						Name
					)
				)
				(ClassOrInterfaceType
					SimpleName
				)
			)
		)
	)
	(ClassOrInterfaceType
		SimpleName
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
			(ClassOrInterfaceType
				SimpleName
			)
			(ClassOrInterfaceType
				SimpleName
			)
		)
	)
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
			(ClassOrInterfaceType
				SimpleName
			)
		)
	)
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
			(ClassOrInterfaceType
				SimpleName
			)
		)
	)
)

