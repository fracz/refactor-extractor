public boolean execute() {
    final Object[] objects = myNamespaces.keySet().toArray();
    Arrays.sort(objects);
    final JList list = new JList(objects);
    list.setCellRenderer(new FQNameCellRenderer());
    list.setSelectedIndex(0);
    final Runnable runnable = new Runnable() {

        public void run() {
            final String namespace = (String) list.getSelectedValue();
            if (namespace != null) {
                final Project project = myFile.getProject();
                new WriteCommandAction.Simple(project, myFile) {

                    protected void run() throws Throwable {
                        final String prefix = myNamespaces.get(namespace);
                        XmlExtension.getExtension(myFile).insertNamespaceDeclaration(myFile, myEditor, Collections.singleton(namespace), prefix, new XmlExtension.Runner<String, IncorrectOperationException>() {

                            public void run(final String s) throws IncorrectOperationException {
                                if (prefix != null && myTag != null && myTag.isValid() && !myTag.getNamespacePrefix().equals(prefix)) {
                                    myTag.setName(prefix + ":" + myTag.getLocalName());
                                }
                            }
                        });
                    }
                }.executeSilently();
            }
        }
    };
    if (list.getModel().getSize() == 1) {
        runnable.run();
    } else {
        new PopupChooserBuilder(list).setTitle(myTitle).setItemChoosenCallback(runnable).createPopup().showInBestPositionFor(myEditor);
    }
    return true;
}||||||||public boolean execute() {
    final Object[] objects = myNamespaces.toArray();
    Arrays.sort(objects);
    final JList list = new JList(objects);
    list.setCellRenderer(new FQNameCellRenderer());
    list.setSelectedIndex(0);
    final Runnable runnable = new Runnable() {

        public void run() {
            final String namespace = (String) list.getSelectedValue();
            if (namespace != null) {
                final Project project = myFile.getProject();
                new WriteCommandAction.Simple(project, myFile) {

                    protected void run() throws Throwable {
                        final XmlSchemaProvider provider = XmlSchemaProvider.getAvailableProvider(myFile);
                        final String prefix = provider == null ? null : provider.getDefaultPrefix(namespace, myFile);
                        XmlExtension.getExtension(myFile).insertNamespaceDeclaration(myFile, myEditor, Collections.singleton(namespace), prefix, new XmlExtension.Runner<String, IncorrectOperationException>() {

                            public void run(final String s) throws IncorrectOperationException {
                                if (prefix != null && myTag != null && myTag.isValid() && !myTag.getNamespacePrefix().equals(prefix)) {
                                    myTag.setName(prefix + ":" + myTag.getLocalName());
                                }
                            }
                        });
                    }
                }.executeSilently();
            }
        }
    };
    if (list.getModel().getSize() == 1) {
        runnable.run();
    } else {
        new PopupChooserBuilder(list).setTitle(myTitle).setItemChoosenCallback(runnable).createPopup().showInBestPositionFor(myEditor);
    }
    return true;
}||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						SimpleName
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
					)
					SimpleName
					(ArrayType
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ObjectCreationExpr
						NameExpr
							SimpleName
						(ClassOrInterfaceType
							SimpleName
						)
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				(ObjectCreationExpr
					(ClassOrInterfaceType
						SimpleName
					)
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				(IntegerLiteralExpr
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ObjectCreationExpr
						(MethodDeclaration
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(CastExpr
												(MethodCallExpr
													SimpleName
													NameExpr
														SimpleName
												)
												(ClassOrInterfaceType
													SimpleName
												)
											)
											SimpleName
											(ClassOrInterfaceType
												SimpleName
											)
										)
									)
								)
								(IfStmt
									(BinaryExpr
										NameExpr
											SimpleName
										NullLiteralExpr
									)
									(BlockStmt
										(ExpressionStmt
											(VariableDeclarationExpr
												(VariableDeclarator
													(MethodCallExpr
														SimpleName
														NameExpr
															SimpleName
													)
													SimpleName
													(ClassOrInterfaceType
														SimpleName
													)
												)
											)
										)
										(ExpressionStmt
											(MethodCallExpr
												SimpleName
												(ObjectCreationExpr
													(MethodDeclaration
														(BlockStmt
															(ExpressionStmt
																(VariableDeclarationExpr
																	(VariableDeclarator
																		(MethodCallExpr
																			NameExpr
																				SimpleName
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																		SimpleName
																		(ClassOrInterfaceType
																			SimpleName
																		)
																	)
																)
															)
															(ExpressionStmt
																(MethodCallExpr
																	NameExpr
																		SimpleName
																	NameExpr
																		SimpleName
																	(MethodCallExpr
																		NameExpr
																			SimpleName
																		SimpleName
																		NameExpr
																			SimpleName
																	)
																	NameExpr
																		SimpleName
																	(ObjectCreationExpr
																		(MethodDeclaration
																			(BlockStmt
																				(IfStmt
																					(BinaryExpr
																						(BinaryExpr
																							(BinaryExpr
																								(BinaryExpr
																									NameExpr
																										SimpleName
																									NullLiteralExpr
																								)
																								(BinaryExpr
																									NameExpr
																										SimpleName
																									NullLiteralExpr
																								)
																							)
																							(MethodCallExpr
																								SimpleName
																								NameExpr
																									SimpleName
																							)
																						)
																						(UnaryExpr
																							(MethodCallExpr
																								NameExpr
																									SimpleName
																								SimpleName
																								(MethodCallExpr
																									SimpleName
																									NameExpr
																										SimpleName
																								)
																							)
																						)
																					)
																					(BlockStmt
																						(ExpressionStmt
																							(MethodCallExpr
																								(BinaryExpr
																									(BinaryExpr
																										NameExpr
																											SimpleName
																										StringLiteralExpr
																									)
																									(MethodCallExpr
																										SimpleName
																										NameExpr
																											SimpleName
																									)
																								)
																								SimpleName
																								NameExpr
																									SimpleName
																							)
																						)
																					)
																				)
																			)
																			(VoidType
																			)
																			SimpleName
																			(Parameter
																				SimpleName
																				(ClassOrInterfaceType
																					SimpleName
																				)
																			)
																			(ClassOrInterfaceType
																				SimpleName
																			)
																		)
																		(ClassOrInterfaceType
																			SimpleName
																			(ClassOrInterfaceType
																				SimpleName
																			)
																			(ClassOrInterfaceType
																				SimpleName
																			)
																			(ClassOrInterfaceType
																				SimpleName
																			)
																		)
																	)
																	SimpleName
																	(MethodCallExpr
																		NameExpr
																			SimpleName
																		SimpleName
																		NameExpr
																			SimpleName
																	)
																)
															)
														)
														(VoidType
														)
														SimpleName
														(ClassOrInterfaceType
															SimpleName
														)
													)
													NameExpr
														SimpleName
													NameExpr
														SimpleName
													(ClassOrInterfaceType
														SimpleName
														(ClassOrInterfaceType
															SimpleName
														)
													)
												)
											)
										)
									)
								)
							)
							(VoidType
							)
							SimpleName
						)
						(ClassOrInterfaceType
							SimpleName
						)
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(IfStmt
			(BinaryExpr
				(MethodCallExpr
					SimpleName
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
				)
				(IntegerLiteralExpr
				)
			)
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						NameExpr
							SimpleName
						SimpleName
						(MethodCallExpr
							SimpleName
							(MethodCallExpr
								NameExpr
									SimpleName
								SimpleName
								(MethodCallExpr
									NameExpr
										SimpleName
									SimpleName
									(ObjectCreationExpr
										NameExpr
											SimpleName
										(ClassOrInterfaceType
											SimpleName
										)
									)
								)
							)
						)
					)
				)
			)
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
				)
			)
		)
		(ReturnStmt
			(BooleanLiteralExpr
			)
		)
	)
	(PrimitiveType
	)
	SimpleName
)
||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ArrayType
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ObjectCreationExpr
						NameExpr
							SimpleName
						(ClassOrInterfaceType
							SimpleName
						)
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				(ObjectCreationExpr
					(ClassOrInterfaceType
						SimpleName
					)
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				(IntegerLiteralExpr
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ObjectCreationExpr
						(MethodDeclaration
							(BlockStmt
								(ExpressionStmt
									(VariableDeclarationExpr
										(VariableDeclarator
											(CastExpr
												(MethodCallExpr
													SimpleName
													NameExpr
														SimpleName
												)
												(ClassOrInterfaceType
													SimpleName
												)
											)
											SimpleName
											(ClassOrInterfaceType
												SimpleName
											)
										)
									)
								)
								(IfStmt
									(BinaryExpr
										NameExpr
											SimpleName
										NullLiteralExpr
									)
									(BlockStmt
										(ExpressionStmt
											(VariableDeclarationExpr
												(VariableDeclarator
													(MethodCallExpr
														SimpleName
														NameExpr
															SimpleName
													)
													SimpleName
													(ClassOrInterfaceType
														SimpleName
													)
												)
											)
										)
										(ExpressionStmt
											(MethodCallExpr
												SimpleName
												(ObjectCreationExpr
													(MethodDeclaration
														(BlockStmt
															(ExpressionStmt
																(VariableDeclarationExpr
																	(VariableDeclarator
																		(MethodCallExpr
																			NameExpr
																				SimpleName
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																		SimpleName
																		(ClassOrInterfaceType
																			SimpleName
																		)
																	)
																)
															)
															(ExpressionStmt
																(VariableDeclarationExpr
																	(VariableDeclarator
																		(ConditionalExpr
																			(BinaryExpr
																				NameExpr
																					SimpleName
																				NullLiteralExpr
																			)
																			(MethodCallExpr
																				NameExpr
																					SimpleName
																				NameExpr
																					SimpleName
																				SimpleName
																				NameExpr
																					SimpleName
																			)
																			NullLiteralExpr
																		)
																		SimpleName
																		(ClassOrInterfaceType
																			SimpleName
																		)
																	)
																)
															)
															(ExpressionStmt
																(MethodCallExpr
																	NameExpr
																		SimpleName
																	NameExpr
																		SimpleName
																	(MethodCallExpr
																		NameExpr
																			SimpleName
																		SimpleName
																		NameExpr
																			SimpleName
																	)
																	NameExpr
																		SimpleName
																	(ObjectCreationExpr
																		(MethodDeclaration
																			(BlockStmt
																				(IfStmt
																					(BinaryExpr
																						(BinaryExpr
																							(BinaryExpr
																								(BinaryExpr
																									NameExpr
																										SimpleName
																									NullLiteralExpr
																								)
																								(BinaryExpr
																									NameExpr
																										SimpleName
																									NullLiteralExpr
																								)
																							)
																							(MethodCallExpr
																								SimpleName
																								NameExpr
																									SimpleName
																							)
																						)
																						(UnaryExpr
																							(MethodCallExpr
																								NameExpr
																									SimpleName
																								SimpleName
																								(MethodCallExpr
																									SimpleName
																									NameExpr
																										SimpleName
																								)
																							)
																						)
																					)
																					(BlockStmt
																						(ExpressionStmt
																							(MethodCallExpr
																								(BinaryExpr
																									(BinaryExpr
																										NameExpr
																											SimpleName
																										StringLiteralExpr
																									)
																									(MethodCallExpr
																										SimpleName
																										NameExpr
																											SimpleName
																									)
																								)
																								SimpleName
																								NameExpr
																									SimpleName
																							)
																						)
																					)
																				)
																			)
																			(VoidType
																			)
																			SimpleName
																			(Parameter
																				SimpleName
																				(ClassOrInterfaceType
																					SimpleName
																				)
																			)
																			(ClassOrInterfaceType
																				SimpleName
																			)
																		)
																		(ClassOrInterfaceType
																			SimpleName
																			(ClassOrInterfaceType
																				SimpleName
																			)
																			(ClassOrInterfaceType
																				SimpleName
																			)
																			(ClassOrInterfaceType
																				SimpleName
																			)
																		)
																	)
																	SimpleName
																	(MethodCallExpr
																		NameExpr
																			SimpleName
																		SimpleName
																		NameExpr
																			SimpleName
																	)
																)
															)
														)
														(VoidType
														)
														SimpleName
														(ClassOrInterfaceType
															SimpleName
														)
													)
													NameExpr
														SimpleName
													NameExpr
														SimpleName
													(ClassOrInterfaceType
														SimpleName
														(ClassOrInterfaceType
															SimpleName
														)
													)
												)
											)
										)
									)
								)
							)
							(VoidType
							)
							SimpleName
						)
						(ClassOrInterfaceType
							SimpleName
						)
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(IfStmt
			(BinaryExpr
				(MethodCallExpr
					SimpleName
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
				)
				(IntegerLiteralExpr
				)
			)
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						NameExpr
							SimpleName
						SimpleName
						(MethodCallExpr
							SimpleName
							(MethodCallExpr
								NameExpr
									SimpleName
								SimpleName
								(MethodCallExpr
									NameExpr
										SimpleName
									SimpleName
									(ObjectCreationExpr
										NameExpr
											SimpleName
										(ClassOrInterfaceType
											SimpleName
										)
									)
								)
							)
						)
					)
				)
			)
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
				)
			)
		)
		(ReturnStmt
			(BooleanLiteralExpr
			)
		)
	)
	(PrimitiveType
	)
	SimpleName
)

