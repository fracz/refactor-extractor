commit 0865385217e4305dd4b58c7f53acb4a35dc15d8a
Author: Dennis Oelkers <dennis@graylog.com>
Date:   Thu Aug 10 12:14:33 2017 +0200

    Improve filtering for standard aggregation queries. (#4056)

    * Filter by time range in search query instead of aggregation.

    This change improves the queries generated by the
    Searches#terms/fieldStats/histogram/fieldHistogram methods. By filtering
    the search result based on the specified time range in the query instead
    of the aggregation, overall ES runtime is improved.

    Fortunately, filteredSearchRequest is already returning a matching query
    + time range search builder which can be used for those cases. Before
    this change, the source builder was generated by the specific method and
    contained only the query instead of query + time range.

    Fixes #4051.

    * Removing now unneeded code, fetching correct aggregations.