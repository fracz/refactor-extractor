public void putNext(DirectBuffer buffer, int offset, int length) throws Exception {
    if (!active) {
        throw new Exception("Stream has ended.");
    }
    copybuf.wrap(buffer, offset, length);
    /* Assume we've already checked and it appears we have a verifiable message. */
    /* Save the checksums first, then blank them out. */
    int msgCksum = copybuf.getInt(MESSAGE_CHECKSUM_OFFSET);
    int streamCksum = copybuf.getInt(STREAM_CHECKSUM_OFFSET);
    copybuf.putInt(MESSAGE_CHECKSUM_OFFSET, 0);
    copybuf.putInt(STREAM_CHECKSUM_OFFSET, 0);
    CRC32 crc = MSG_CHECKSUM.get();
    crc.reset();
    for (int i = 0; i < length; i++) {
        crc.update(copybuf.getByte(i));
        stream_checksum.update(copybuf.getByte(i));
    }
    if ((int) (crc.getValue()) != msgCksum) {
        /* Put originally received checksums back in place. */
        copybuf.putInt(MESSAGE_CHECKSUM_OFFSET, msgCksum);
        copybuf.putInt(STREAM_CHECKSUM_OFFSET, streamCksum);
        throw new Exception("Verifiable message per-message checksum invalid; received " + msgCksum + " but calculated " + (int) (crc.getValue()));
    }
    if ((int) (stream_checksum.getValue()) != streamCksum) {
        /* Put originally received checksums back in place. */
        copybuf.putInt(MESSAGE_CHECKSUM_OFFSET, msgCksum);
        copybuf.putInt(STREAM_CHECKSUM_OFFSET, streamCksum);
        throw new Exception("Verifiable message stream checksum invalid; received " + streamCksum + " but calculated " + (int) (stream_checksum.getValue()));
    }
    /* Put checksums back in place. */
    copybuf.putInt(MESSAGE_CHECKSUM_OFFSET, msgCksum);
    copybuf.putInt(STREAM_CHECKSUM_OFFSET, streamCksum);
    messageCount++;
    /* Look for an end marker. */
    if (copybuf.getInt(MAGIC_OFFSET) == MAGIC_END) {
        active = false;
    }
}||||||||public void putNext(DirectBuffer buffer, int offset, int length) throws Exception {
    if (!active) {
        throw new Exception("Stream has ended.");
    }
    copybuf.wrap(buffer, offset, length);
    /* Assume we've already checked and it appears we have a verifiable message. */
    /* Sequence number check first. */
    final long receivedSequenceNumber = copybuf.getLong(SEQUENCE_NUMBER_OFFSET);
    if (receivedSequenceNumber != sequenceNumber) {
        Exception e = new Exception("Verifiable message stream received sequence number " + receivedSequenceNumber + ", but was expecting " + sequenceNumber + ". Possibly missed " + (receivedSequenceNumber - sequenceNumber) + " messages.");
        /* Update expected SQN for next time. */
        sequenceNumber = receivedSequenceNumber + 1;
        throw e;
    }
    /* Update expected SQN for next time. */
    sequenceNumber++;
    /* Save the checksum first, then blank it out. */
    int msgCksum = copybuf.getInt(MESSAGE_CHECKSUM_OFFSET);
    copybuf.putInt(MESSAGE_CHECKSUM_OFFSET, 0);
    CRC32 crc = MSG_CHECKSUM.get();
    crc.reset();
    for (int i = 0; i < length; i++) {
        crc.update(copybuf.getByte(i));
    }
    /* Put originally received checksum back in place. */
    copybuf.putInt(MESSAGE_CHECKSUM_OFFSET, msgCksum);
    if ((int) (crc.getValue()) != msgCksum) {
        throw new Exception("Verifiable message per-message checksum invalid; received " + msgCksum + " but calculated " + (int) (crc.getValue()));
    }
    messageCount++;
    /* Look for an end marker. */
    if (copybuf.getInt(MAGIC_OFFSET) == MAGIC_END) {
        active = false;
    }
}||||||||(MethodDeclaration
	(BlockStmt
		(IfStmt
			(UnaryExpr
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ThrowStmt
					(ObjectCreationExpr
						StringLiteralExpr
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				NameExpr
					SimpleName
				NameExpr
					SimpleName
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						NameExpr
							SimpleName
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
			(BlockComment
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						NameExpr
							SimpleName
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				(IntegerLiteralExpr
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				(IntegerLiteralExpr
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ForStmt
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						(MethodCallExpr
							NameExpr
								SimpleName
							SimpleName
							NameExpr
								SimpleName
						)
						SimpleName
						NameExpr
							SimpleName
					)
				)
				(ExpressionStmt
					(MethodCallExpr
						(MethodCallExpr
							NameExpr
								SimpleName
							SimpleName
							NameExpr
								SimpleName
						)
						SimpleName
						NameExpr
							SimpleName
					)
				)
			)
			(BinaryExpr
				NameExpr
					SimpleName
				NameExpr
					SimpleName
			)
			(VariableDeclarationExpr
				(VariableDeclarator
					(IntegerLiteralExpr
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
			(UnaryExpr
				NameExpr
					SimpleName
			)
		)
		(IfStmt
			(BinaryExpr
				(CastExpr
					(EnclosedExpr
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
					)
					(PrimitiveType
					)
				)
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						NameExpr
							SimpleName
						NameExpr
							SimpleName
						SimpleName
						NameExpr
							SimpleName
					)
					(BlockComment
					)
				)
				(ExpressionStmt
					(MethodCallExpr
						NameExpr
							SimpleName
						NameExpr
							SimpleName
						SimpleName
						NameExpr
							SimpleName
					)
				)
				(ThrowStmt
					(ObjectCreationExpr
						(BinaryExpr
							(BinaryExpr
								(BinaryExpr
									StringLiteralExpr
									NameExpr
										SimpleName
								)
								StringLiteralExpr
							)
							(CastExpr
								(EnclosedExpr
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
								)
								(PrimitiveType
								)
							)
						)
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
		)
		(IfStmt
			(BinaryExpr
				(CastExpr
					(EnclosedExpr
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
					)
					(PrimitiveType
					)
				)
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						NameExpr
							SimpleName
						NameExpr
							SimpleName
						SimpleName
						NameExpr
							SimpleName
					)
					(BlockComment
					)
				)
				(ExpressionStmt
					(MethodCallExpr
						NameExpr
							SimpleName
						NameExpr
							SimpleName
						SimpleName
						NameExpr
							SimpleName
					)
				)
				(ThrowStmt
					(ObjectCreationExpr
						(BinaryExpr
							(BinaryExpr
								(BinaryExpr
									StringLiteralExpr
									NameExpr
										SimpleName
								)
								StringLiteralExpr
							)
							(CastExpr
								(EnclosedExpr
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
								)
								(PrimitiveType
								)
							)
						)
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				NameExpr
					SimpleName
				SimpleName
				NameExpr
					SimpleName
			)
			(BlockComment
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				NameExpr
					SimpleName
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(UnaryExpr
				NameExpr
					SimpleName
			)
		)
		(IfStmt
			(BinaryExpr
				(MethodCallExpr
					NameExpr
						SimpleName
					SimpleName
					NameExpr
						SimpleName
				)
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ExpressionStmt
					(AssignExpr
						NameExpr
							SimpleName
						(BooleanLiteralExpr
						)
					)
				)
			)
			(BlockComment
			)
		)
	)
	(VoidType
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(Parameter
		SimpleName
		(PrimitiveType
		)
	)
	(Parameter
		SimpleName
		(PrimitiveType
		)
	)
	(ClassOrInterfaceType
		SimpleName
	)
)
||||||||(MethodDeclaration
	(BlockStmt
		(IfStmt
			(UnaryExpr
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ThrowStmt
					(ObjectCreationExpr
						StringLiteralExpr
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				NameExpr
					SimpleName
				NameExpr
					SimpleName
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						NameExpr
							SimpleName
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
			(BlockComment
			)
		)
		(IfStmt
			(BinaryExpr
				NameExpr
					SimpleName
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ExpressionStmt
					(VariableDeclarationExpr
						(VariableDeclarator
							(ObjectCreationExpr
								(BinaryExpr
									(BinaryExpr
										(BinaryExpr
											(BinaryExpr
												(BinaryExpr
													(BinaryExpr
														StringLiteralExpr
														NameExpr
															SimpleName
													)
													StringLiteralExpr
												)
												NameExpr
													SimpleName
											)
											StringLiteralExpr
										)
										(EnclosedExpr
											(BinaryExpr
												NameExpr
													SimpleName
												NameExpr
													SimpleName
											)
										)
									)
									StringLiteralExpr
								)
								(ClassOrInterfaceType
									SimpleName
								)
							)
							SimpleName
							(ClassOrInterfaceType
								SimpleName
							)
						)
					)
				)
				(ExpressionStmt
					(AssignExpr
						NameExpr
							SimpleName
						(BinaryExpr
							NameExpr
								SimpleName
							(IntegerLiteralExpr
							)
						)
					)
					(BlockComment
					)
				)
				(ThrowStmt
					NameExpr
						SimpleName
				)
			)
		)
		(ExpressionStmt
			(UnaryExpr
				NameExpr
					SimpleName
			)
			(BlockComment
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						NameExpr
							SimpleName
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
			(BlockComment
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				(IntegerLiteralExpr
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ForStmt
			(BlockStmt
				(ExpressionStmt
					(MethodCallExpr
						(MethodCallExpr
							NameExpr
								SimpleName
							SimpleName
							NameExpr
								SimpleName
						)
						SimpleName
						NameExpr
							SimpleName
					)
				)
			)
			(BinaryExpr
				NameExpr
					SimpleName
				NameExpr
					SimpleName
			)
			(VariableDeclarationExpr
				(VariableDeclarator
					(IntegerLiteralExpr
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
			(UnaryExpr
				NameExpr
					SimpleName
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				NameExpr
					SimpleName
				SimpleName
				NameExpr
					SimpleName
			)
			(BlockComment
			)
		)
		(IfStmt
			(BinaryExpr
				(CastExpr
					(EnclosedExpr
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
					)
					(PrimitiveType
					)
				)
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ThrowStmt
					(ObjectCreationExpr
						(BinaryExpr
							(BinaryExpr
								(BinaryExpr
									StringLiteralExpr
									NameExpr
										SimpleName
								)
								StringLiteralExpr
							)
							(CastExpr
								(EnclosedExpr
									(MethodCallExpr
										SimpleName
										NameExpr
											SimpleName
									)
								)
								(PrimitiveType
								)
							)
						)
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
		)
		(ExpressionStmt
			(UnaryExpr
				NameExpr
					SimpleName
			)
		)
		(IfStmt
			(BinaryExpr
				(MethodCallExpr
					NameExpr
						SimpleName
					SimpleName
					NameExpr
						SimpleName
				)
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ExpressionStmt
					(AssignExpr
						NameExpr
							SimpleName
						(BooleanLiteralExpr
						)
					)
				)
			)
			(BlockComment
			)
		)
	)
	(VoidType
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(Parameter
		SimpleName
		(PrimitiveType
		)
	)
	(Parameter
		SimpleName
		(PrimitiveType
		)
	)
	(ClassOrInterfaceType
		SimpleName
	)
)

