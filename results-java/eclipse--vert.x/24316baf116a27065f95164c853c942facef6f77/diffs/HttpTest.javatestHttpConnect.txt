@Test
public void testHttpConnect() {
    Buffer buffer = TestUtils.randomBuffer(128);
    Buffer received = Buffer.buffer();
    vertx.createNetServer(new NetServerOptions().setPort(1235)).connectHandler(socket -> {
        socket.handler(socket::write);
    }).listen(onSuccess(netServer -> {
        server.requestHandler(req -> {
            vertx.createNetClient(new NetClientOptions()).connect(netServer.actualPort(), "localhost", onSuccess(socket -> {
                req.response().setStatusCode(200);
                req.response().setStatusMessage("Connection established");
                req.response().end();
                // Create pumps which echo stuff
                Pump.pump(req.netSocket(), socket).start();
                Pump.pump(socket, req.netSocket()).start();
                req.netSocket().closeHandler(v -> socket.close());
            }));
        });
        server.listen(onSuccess(s -> {
            client.connect(new RequestOptions().setPort(DEFAULT_HTTP_PORT).setRequestURI(DEFAULT_TEST_URI), resp -> {
                assertEquals(200, resp.statusCode());
                NetSocket socket = resp.netSocket();
                socket.handler(buff -> {
                    received.appendBuffer(buff);
                    if (received.length() == buffer.length()) {
                        netServer.close();
                        assertEquals(buffer, received);
                        testComplete();
                    }
                });
                socket.write(buffer);
            }).end();
        }));
    }));
    await();
}||||||||@Test
public void testHttpConnect() {
    Buffer buffer = TestUtils.randomBuffer(128);
    Buffer received = Buffer.buffer();
    vertx.createNetServer(new NetServerOptions().setPort(1235)).connectHandler(socket -> {
        socket.handler(socket::write);
    }).listen(onSuccess(netServer -> {
        server.requestHandler(req -> {
            vertx.createNetClient(new NetClientOptions()).connect(netServer.actualPort(), "localhost", onSuccess(socket -> {
                req.response().setStatusCode(200);
                req.response().setStatusMessage("Connection established");
                req.response().end();
                // Create pumps which echo stuff
                Pump.pump(req.netSocket(), socket).start();
                Pump.pump(socket, req.netSocket()).start();
                req.netSocket().closeHandler(v -> socket.close());
            }));
        });
        server.listen(onSuccess(s -> {
            client.request(HttpMethod.CONNECT, DEFAULT_HTTP_PORT, DEFAULT_HTTP_HOST, DEFAULT_TEST_URI, resp -> {
                assertEquals(200, resp.statusCode());
                NetSocket socket = resp.netSocket();
                socket.handler(buff -> {
                    received.appendBuffer(buff);
                    if (received.length() == buffer.length()) {
                        netServer.close();
                        assertEquals(buffer, received);
                        testComplete();
                    }
                });
                socket.write(buffer);
            }).end();
        }));
    }));
    await();
}||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						(IntegerLiteralExpr
						)
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				(MethodCallExpr
					(LambdaExpr
						(BlockStmt
							(ExpressionStmt
								(MethodCallExpr
									(LambdaExpr
										(BlockStmt
											(ExpressionStmt
												(MethodCallExpr
													(MethodCallExpr
														SimpleName
														NameExpr
															SimpleName
													)
													StringLiteralExpr
													(MethodCallExpr
														(LambdaExpr
															(BlockStmt
																(ExpressionStmt
																	(MethodCallExpr
																		(IntegerLiteralExpr
																		)
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		StringLiteralExpr
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		SimpleName
																		(MethodCallExpr
																			(MethodCallExpr
																				SimpleName
																				NameExpr
																					SimpleName
																			)
																			NameExpr
																				SimpleName
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																	LineComment
																)
																(ExpressionStmt
																	(MethodCallExpr
																		SimpleName
																		(MethodCallExpr
																			NameExpr
																				SimpleName
																			(MethodCallExpr
																				SimpleName
																				NameExpr
																					SimpleName
																			)
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		(LambdaExpr
																			(ExpressionStmt
																				(MethodCallExpr
																					SimpleName
																					NameExpr
																						SimpleName
																				)
																			)
																			(Parameter
																				SimpleName
																				(UnknownType
																				)
																			)
																		)
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
															)
															(Parameter
																SimpleName
																(UnknownType
																)
															)
														)
														SimpleName
													)
													SimpleName
													(MethodCallExpr
														(ObjectCreationExpr
															(ClassOrInterfaceType
																SimpleName
															)
														)
														SimpleName
														NameExpr
															SimpleName
													)
												)
											)
										)
										(Parameter
											SimpleName
											(UnknownType
											)
										)
									)
									SimpleName
									NameExpr
										SimpleName
								)
							)
							(ExpressionStmt
								(MethodCallExpr
									(MethodCallExpr
										(LambdaExpr
											(BlockStmt
												(ExpressionStmt
													(MethodCallExpr
														SimpleName
														(MethodCallExpr
															(MethodCallExpr
																NameExpr
																	SimpleName
																SimpleName
																(MethodCallExpr
																	NameExpr
																		SimpleName
																	SimpleName
																	(ObjectCreationExpr
																		(ClassOrInterfaceType
																			SimpleName
																		)
																	)
																)
															)
															(LambdaExpr
																(BlockStmt
																	(ExpressionStmt
																		(MethodCallExpr
																			(IntegerLiteralExpr
																			)
																			(MethodCallExpr
																				SimpleName
																				NameExpr
																					SimpleName
																			)
																			SimpleName
																		)
																	)
																	(ExpressionStmt
																		(VariableDeclarationExpr
																			(VariableDeclarator
																				(MethodCallExpr
																					SimpleName
																					NameExpr
																						SimpleName
																				)
																				SimpleName
																				(ClassOrInterfaceType
																					SimpleName
																				)
																			)
																		)
																	)
																	(ExpressionStmt
																		(MethodCallExpr
																			(LambdaExpr
																				(BlockStmt
																					(ExpressionStmt
																						(MethodCallExpr
																							NameExpr
																								SimpleName
																							SimpleName
																							NameExpr
																								SimpleName
																						)
																					)
																					(IfStmt
																						(BinaryExpr
																							(MethodCallExpr
																								SimpleName
																								NameExpr
																									SimpleName
																							)
																							(MethodCallExpr
																								SimpleName
																								NameExpr
																									SimpleName
																							)
																						)
																						(BlockStmt
																							(ExpressionStmt
																								(MethodCallExpr
																									SimpleName
																									NameExpr
																										SimpleName
																								)
																							)
																							(ExpressionStmt
																								(MethodCallExpr
																									NameExpr
																										SimpleName
																									NameExpr
																										SimpleName
																									SimpleName
																								)
																							)
																							(ExpressionStmt
																								(MethodCallExpr
																									SimpleName
																								)
																							)
																						)
																					)
																				)
																				(Parameter
																					SimpleName
																					(UnknownType
																					)
																				)
																			)
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																	(ExpressionStmt
																		(MethodCallExpr
																			NameExpr
																				SimpleName
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(Parameter
																	SimpleName
																	(UnknownType
																	)
																)
															)
															SimpleName
															NameExpr
																SimpleName
														)
													)
												)
											)
											(Parameter
												SimpleName
												(UnknownType
												)
											)
										)
										SimpleName
									)
									SimpleName
									NameExpr
										SimpleName
								)
							)
						)
						(Parameter
							SimpleName
							(UnknownType
							)
						)
					)
					SimpleName
				)
				SimpleName
				(MethodCallExpr
					(LambdaExpr
						(BlockStmt
							(ExpressionStmt
								(MethodCallExpr
									(MethodReferenceExpr
										(TypeExpr
											(ClassOrInterfaceType
												SimpleName
											)
										)
									)
									SimpleName
									NameExpr
										SimpleName
								)
							)
						)
						(Parameter
							SimpleName
							(UnknownType
							)
						)
					)
					SimpleName
					(MethodCallExpr
						(MethodCallExpr
							(IntegerLiteralExpr
							)
							SimpleName
							(ObjectCreationExpr
								(ClassOrInterfaceType
									SimpleName
								)
							)
						)
						SimpleName
						NameExpr
							SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				SimpleName
			)
		)
	)
	(VoidType
	)
	SimpleName
	(MarkerAnnotationExpr
		Name
	)
)
||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						(IntegerLiteralExpr
						)
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				(MethodCallExpr
					(LambdaExpr
						(BlockStmt
							(ExpressionStmt
								(MethodCallExpr
									(LambdaExpr
										(BlockStmt
											(ExpressionStmt
												(MethodCallExpr
													(MethodCallExpr
														SimpleName
														NameExpr
															SimpleName
													)
													StringLiteralExpr
													(MethodCallExpr
														(LambdaExpr
															(BlockStmt
																(ExpressionStmt
																	(MethodCallExpr
																		(IntegerLiteralExpr
																		)
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		StringLiteralExpr
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		SimpleName
																		(MethodCallExpr
																			(MethodCallExpr
																				SimpleName
																				NameExpr
																					SimpleName
																			)
																			NameExpr
																				SimpleName
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																	LineComment
																)
																(ExpressionStmt
																	(MethodCallExpr
																		SimpleName
																		(MethodCallExpr
																			NameExpr
																				SimpleName
																			(MethodCallExpr
																				SimpleName
																				NameExpr
																					SimpleName
																			)
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(ExpressionStmt
																	(MethodCallExpr
																		(LambdaExpr
																			(ExpressionStmt
																				(MethodCallExpr
																					SimpleName
																					NameExpr
																						SimpleName
																				)
																			)
																			(Parameter
																				SimpleName
																				(UnknownType
																				)
																			)
																		)
																		SimpleName
																		(MethodCallExpr
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
															)
															(Parameter
																SimpleName
																(UnknownType
																)
															)
														)
														SimpleName
													)
													SimpleName
													(MethodCallExpr
														(ObjectCreationExpr
															(ClassOrInterfaceType
																SimpleName
															)
														)
														SimpleName
														NameExpr
															SimpleName
													)
												)
											)
										)
										(Parameter
											SimpleName
											(UnknownType
											)
										)
									)
									SimpleName
									NameExpr
										SimpleName
								)
							)
							(ExpressionStmt
								(MethodCallExpr
									(MethodCallExpr
										(LambdaExpr
											(BlockStmt
												(ExpressionStmt
													(MethodCallExpr
														SimpleName
														(MethodCallExpr
															(FieldAccessExpr
																SimpleName
																NameExpr
																	SimpleName
															)
															NameExpr
																SimpleName
															NameExpr
																SimpleName
															NameExpr
																SimpleName
															(LambdaExpr
																(BlockStmt
																	(ExpressionStmt
																		(MethodCallExpr
																			(IntegerLiteralExpr
																			)
																			(MethodCallExpr
																				SimpleName
																				NameExpr
																					SimpleName
																			)
																			SimpleName
																		)
																	)
																	(ExpressionStmt
																		(VariableDeclarationExpr
																			(VariableDeclarator
																				(MethodCallExpr
																					SimpleName
																					NameExpr
																						SimpleName
																				)
																				SimpleName
																				(ClassOrInterfaceType
																					SimpleName
																				)
																			)
																		)
																	)
																	(ExpressionStmt
																		(MethodCallExpr
																			(LambdaExpr
																				(BlockStmt
																					(ExpressionStmt
																						(MethodCallExpr
																							NameExpr
																								SimpleName
																							SimpleName
																							NameExpr
																								SimpleName
																						)
																					)
																					(IfStmt
																						(BinaryExpr
																							(MethodCallExpr
																								SimpleName
																								NameExpr
																									SimpleName
																							)
																							(MethodCallExpr
																								SimpleName
																								NameExpr
																									SimpleName
																							)
																						)
																						(BlockStmt
																							(ExpressionStmt
																								(MethodCallExpr
																									SimpleName
																									NameExpr
																										SimpleName
																								)
																							)
																							(ExpressionStmt
																								(MethodCallExpr
																									NameExpr
																										SimpleName
																									NameExpr
																										SimpleName
																									SimpleName
																								)
																							)
																							(ExpressionStmt
																								(MethodCallExpr
																									SimpleName
																								)
																							)
																						)
																					)
																				)
																				(Parameter
																					SimpleName
																					(UnknownType
																					)
																				)
																			)
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																	(ExpressionStmt
																		(MethodCallExpr
																			NameExpr
																				SimpleName
																			SimpleName
																			NameExpr
																				SimpleName
																		)
																	)
																)
																(Parameter
																	SimpleName
																	(UnknownType
																	)
																)
															)
															SimpleName
															NameExpr
																SimpleName
														)
													)
												)
											)
											(Parameter
												SimpleName
												(UnknownType
												)
											)
										)
										SimpleName
									)
									SimpleName
									NameExpr
										SimpleName
								)
							)
						)
						(Parameter
							SimpleName
							(UnknownType
							)
						)
					)
					SimpleName
				)
				SimpleName
				(MethodCallExpr
					(LambdaExpr
						(BlockStmt
							(ExpressionStmt
								(MethodCallExpr
									(MethodReferenceExpr
										(TypeExpr
											(ClassOrInterfaceType
												SimpleName
											)
										)
									)
									SimpleName
									NameExpr
										SimpleName
								)
							)
						)
						(Parameter
							SimpleName
							(UnknownType
							)
						)
					)
					SimpleName
					(MethodCallExpr
						(MethodCallExpr
							(IntegerLiteralExpr
							)
							SimpleName
							(ObjectCreationExpr
								(ClassOrInterfaceType
									SimpleName
								)
							)
						)
						SimpleName
						NameExpr
							SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				SimpleName
			)
		)
	)
	(VoidType
	)
	SimpleName
	(MarkerAnnotationExpr
		Name
	)
)

