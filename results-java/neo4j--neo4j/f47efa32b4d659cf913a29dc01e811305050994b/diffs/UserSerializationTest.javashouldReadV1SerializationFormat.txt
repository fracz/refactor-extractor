/**
 * This is a future-proofing test. If you come here because you've made changes to the serialization format,
 * this is your reminder to make sure to build this is in a backwards compatible way.
 */
@Test
public void shouldReadV1SerializationFormat() throws Exception {
    // Given
    UserSerialization serialization = new UserSerialization();
    byte[] salt1 = new byte[] { (byte) 0xa5, (byte) 0x43 };
    byte[] hash1 = new byte[] { (byte) 0xfe, (byte) 0x00, (byte) 0x56, (byte) 0xc3, (byte) 0x7e };
    byte[] salt2 = new byte[] { (byte) 0x34, (byte) 0xa4 };
    byte[] hash2 = new byte[] { (byte) 0x0e, (byte) 0x1f, (byte) 0xff, (byte) 0xc2, (byte) 0x3e };
    // When
    List<User> deserialized = serialization.deserializeUsers(UTF8.encode(("Steve:SHA-256,FE0056C37E,A543:\n" + "Bob:SHA-256,0E1FFFC23E,34A4:password_change_required\n")));
    // Then
    assertThat(deserialized, equalTo(asList(new User("Steve", new Credential(salt1, hash1), false), new User("Bob", new Credential(salt2, hash2), true))));
}||||||||/**
 * This is a future-proofing test. If you come here because you've made changes to the serialization format,
 * this is your reminder to make sure to build this is in a backwards compatible way.
 */
@Test
public void shouldReadV1SerializationFormat() throws Exception {
    // Given
    UserSerialization serialization = new UserSerialization();
    byte[] salt1 = new byte[] { (byte) 0xa5, (byte) 0x43 };
    byte[] hash1 = new byte[] { (byte) 0xfe, (byte) 0x00, (byte) 0x56, (byte) 0xc3, (byte) 0x7e };
    byte[] salt2 = new byte[] { (byte) 0x34, (byte) 0xa4 };
    byte[] hash2 = new byte[] { (byte) 0x0e, (byte) 0x1f, (byte) 0xff, (byte) 0xc2, (byte) 0x3e };
    // When
    List<User> deserialized = serialization.deserializeUsers(UTF8.encode(("Mike:SHA-256,FE0056C37E,A543:\n" + "Steve:SHA-256,FE0056C37E,A543:nice_guy,password_change_required\n" + "Bob:SHA-256,0E1FFFC23E,34A4:password_change_required\n")));
    // Then
    assertThat(deserialized, equalTo(asList(new User.Builder("Mike", new Credential(salt1, hash1)).build(), new User.Builder("Steve", new Credential(salt1, hash1)).withRequiredPasswordChange(true).withFlag("nice_guy").build(), new User.Builder("Bob", new Credential(salt2, hash2)).withRequiredPasswordChange(true).build())));
}||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ObjectCreationExpr
						(ClassOrInterfaceType
							SimpleName
						)
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
			LineComment
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ArrayCreationExpr
						(PrimitiveType
						)
						(ArrayInitializerExpr
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
						)
						(ArrayCreationLevel
						)
					)
					SimpleName
					(ArrayType
						(PrimitiveType
						)
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ArrayCreationExpr
						(PrimitiveType
						)
						(ArrayInitializerExpr
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
						)
						(ArrayCreationLevel
						)
					)
					SimpleName
					(ArrayType
						(PrimitiveType
						)
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ArrayCreationExpr
						(PrimitiveType
						)
						(ArrayInitializerExpr
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
						)
						(ArrayCreationLevel
						)
					)
					SimpleName
					(ArrayType
						(PrimitiveType
						)
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ArrayCreationExpr
						(PrimitiveType
						)
						(ArrayInitializerExpr
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
						)
						(ArrayCreationLevel
						)
					)
					SimpleName
					(ArrayType
						(PrimitiveType
						)
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						(MethodCallExpr
							(EnclosedExpr
								(BinaryExpr
									StringLiteralExpr
									StringLiteralExpr
								)
							)
							SimpleName
							NameExpr
								SimpleName
						)
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
			LineComment
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				(MethodCallExpr
					(MethodCallExpr
						(ObjectCreationExpr
							StringLiteralExpr
							(ObjectCreationExpr
								NameExpr
									SimpleName
								NameExpr
									SimpleName
								(ClassOrInterfaceType
									SimpleName
								)
							)
							(BooleanLiteralExpr
							)
							(ClassOrInterfaceType
								SimpleName
							)
						)
						(ObjectCreationExpr
							StringLiteralExpr
							(ObjectCreationExpr
								NameExpr
									SimpleName
								NameExpr
									SimpleName
								(ClassOrInterfaceType
									SimpleName
								)
							)
							(BooleanLiteralExpr
							)
							(ClassOrInterfaceType
								SimpleName
							)
						)
						SimpleName
					)
					SimpleName
				)
				SimpleName
			)
			LineComment
		)
	)
	(VoidType
	)
	SimpleName
	(ClassOrInterfaceType
		SimpleName
	)
	(MarkerAnnotationExpr
		Name
	)
	(JavadocComment
	)
)
||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ObjectCreationExpr
						(ClassOrInterfaceType
							SimpleName
						)
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
			LineComment
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ArrayCreationExpr
						(PrimitiveType
						)
						(ArrayInitializerExpr
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
						)
						(ArrayCreationLevel
						)
					)
					SimpleName
					(ArrayType
						(PrimitiveType
						)
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ArrayCreationExpr
						(PrimitiveType
						)
						(ArrayInitializerExpr
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
						)
						(ArrayCreationLevel
						)
					)
					SimpleName
					(ArrayType
						(PrimitiveType
						)
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ArrayCreationExpr
						(PrimitiveType
						)
						(ArrayInitializerExpr
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
						)
						(ArrayCreationLevel
						)
					)
					SimpleName
					(ArrayType
						(PrimitiveType
						)
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(ArrayCreationExpr
						(PrimitiveType
						)
						(ArrayInitializerExpr
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
							(CastExpr
								(IntegerLiteralExpr
								)
								(PrimitiveType
								)
							)
						)
						(ArrayCreationLevel
						)
					)
					SimpleName
					(ArrayType
						(PrimitiveType
						)
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						(MethodCallExpr
							(EnclosedExpr
								(BinaryExpr
									(BinaryExpr
										StringLiteralExpr
										StringLiteralExpr
									)
									StringLiteralExpr
								)
							)
							SimpleName
							NameExpr
								SimpleName
						)
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
						(ClassOrInterfaceType
							SimpleName
						)
					)
				)
			)
			LineComment
		)
		(ExpressionStmt
			(MethodCallExpr
				NameExpr
					SimpleName
				(MethodCallExpr
					(MethodCallExpr
						(MethodCallExpr
							SimpleName
							(ObjectCreationExpr
								StringLiteralExpr
								(ObjectCreationExpr
									NameExpr
										SimpleName
									NameExpr
										SimpleName
									(ClassOrInterfaceType
										SimpleName
									)
								)
								(ClassOrInterfaceType
									SimpleName
									(ClassOrInterfaceType
										SimpleName
									)
								)
							)
						)
						(MethodCallExpr
							SimpleName
							(MethodCallExpr
								StringLiteralExpr
								SimpleName
								(MethodCallExpr
									(BooleanLiteralExpr
									)
									SimpleName
									(ObjectCreationExpr
										StringLiteralExpr
										(ObjectCreationExpr
											NameExpr
												SimpleName
											NameExpr
												SimpleName
											(ClassOrInterfaceType
												SimpleName
											)
										)
										(ClassOrInterfaceType
											SimpleName
											(ClassOrInterfaceType
												SimpleName
											)
										)
									)
								)
							)
						)
						(MethodCallExpr
							SimpleName
							(MethodCallExpr
								(BooleanLiteralExpr
								)
								SimpleName
								(ObjectCreationExpr
									StringLiteralExpr
									(ObjectCreationExpr
										NameExpr
											SimpleName
										NameExpr
											SimpleName
										(ClassOrInterfaceType
											SimpleName
										)
									)
									(ClassOrInterfaceType
										SimpleName
										(ClassOrInterfaceType
											SimpleName
										)
									)
								)
							)
						)
						SimpleName
					)
					SimpleName
				)
				SimpleName
			)
			LineComment
		)
	)
	(VoidType
	)
	SimpleName
	(ClassOrInterfaceType
		SimpleName
	)
	(MarkerAnnotationExpr
		Name
	)
	(JavadocComment
	)
)

