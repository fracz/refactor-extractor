/**
 * Gets the effective probability value when the monkey processes an instance group, it uses the following
 * logic in the order as listed below.
 *
 * 1) When minimum mandatory termination is enabled, a default non-zero probability is used for opted-in
 * groups, if a) the application has been opted in for the last mandatory termination window
 * and b) there was no terminations in the last mandatory termination window
 * 2) Use the probability configured for the group type and name
 * 3) Use the probability configured for the group
 * 4) Use 1.0
 * @param group
 * @return double
 */
protected double getEffectiveProbabilityFromCfg(InstanceGroup group) {
    String propName;
    if (cfg.getBool(NS + "mandatoryTermination.enabled")) {
        String mtwProp = NS + "mandatoryTermination.windowInDays";
        int mandatoryTerminationWindowInDays = (int) cfg.getNumOrElse(mtwProp, 0);
        if (mandatoryTerminationWindowInDays > 0 && noTerminationInLastWindow(group, mandatoryTerminationWindowInDays)) {
            double mandatoryProb = cfg.getNumOrElse(NS + "mandatoryTermination.defaultProbability", DEFAULT_MANDATORY_TERMINATION_PROBABILITY);
            LOGGER.info("There has been no terminations for group {} [type {}] in the last {} days," + "setting the probability to {} for mandatory termination.", new Object[] { group.name(), group.type(), mandatoryTerminationWindowInDays, mandatoryProb });
            return mandatoryProb;
        }
    }
    propName = "probability";
    String defaultProp = NS + group.type();
    String probProp = NS + group.type() + "." + group.name() + "." + propName;
    double prob = cfg.getNumOrElse(probProp, cfg.getNumOrElse(defaultProp + "." + propName, 1.0));
    LOGGER.info("Group {} [type {}] enabled [prob {}]", new Object[] { group.name(), group.type(), prob });
    return prob;
}||||||||/**
 * Gets the effective probability value when the monkey processes an instance group, it uses the following
 * logic in the order as listed below.
 *
 * 1) When minimum mandatory termination is enabled, a default non-zero probability is used for opted-in
 * groups, if a) the application has been opted in for the last mandatory termination window
 * and b) there was no terminations in the last mandatory termination window
 * 2) Use the probability configured for the group type and name
 * 3) Use the probability configured for the group
 * 4) Use 1.0
 * @param group
 * @return double
 */
protected double getEffectiveProbabilityFromCfg(InstanceGroup group) {
    String propName;
    if (cfg.getBool(NS + "mandatoryTermination.enabled")) {
        String mtwProp = NS + "mandatoryTermination.windowInDays";
        int mandatoryTerminationWindowInDays = (int) cfg.getNumOrElse(mtwProp, 0);
        if (mandatoryTerminationWindowInDays > 0 && noTerminationInLastWindow(group, mandatoryTerminationWindowInDays)) {
            double mandatoryProb = cfg.getNumOrElse(NS + "mandatoryTermination.defaultProbability", DEFAULT_MANDATORY_TERMINATION_PROBABILITY);
            LOGGER.info("There has been no terminations for group {} [type {}] in the last {} days," + "setting the probability to {} for mandatory termination.", new Object[] { group.name(), group.type(), mandatoryTerminationWindowInDays, mandatoryProb });
            return mandatoryProb;
        }
    }
    propName = "probability";
    double prob = getNumFromCfgOrDefault(group, propName, 1.0);
    LOGGER.info("Group {} [type {}] enabled [prob {}]", new Object[] { group.name(), group.type(), prob });
    return prob;
}||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(IfStmt
			(MethodCallExpr
				(BinaryExpr
					NameExpr
						SimpleName
					StringLiteralExpr
				)
				SimpleName
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ExpressionStmt
					(VariableDeclarationExpr
						(VariableDeclarator
							(BinaryExpr
								NameExpr
									SimpleName
								StringLiteralExpr
							)
							SimpleName
							(ClassOrInterfaceType
								SimpleName
							)
						)
					)
				)
				(ExpressionStmt
					(VariableDeclarationExpr
						(VariableDeclarator
							(CastExpr
								(MethodCallExpr
									NameExpr
										SimpleName
									(IntegerLiteralExpr
									)
									SimpleName
									NameExpr
										SimpleName
								)
								(PrimitiveType
								)
							)
							SimpleName
							(PrimitiveType
							)
						)
					)
				)
				(IfStmt
					(BinaryExpr
						(BinaryExpr
							NameExpr
								SimpleName
							(IntegerLiteralExpr
							)
						)
						(MethodCallExpr
							NameExpr
								SimpleName
							NameExpr
								SimpleName
							SimpleName
						)
					)
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										(BinaryExpr
											NameExpr
												SimpleName
											StringLiteralExpr
										)
										NameExpr
											SimpleName
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(PrimitiveType
									)
								)
							)
						)
						(ExpressionStmt
							(MethodCallExpr
								(BinaryExpr
									StringLiteralExpr
									StringLiteralExpr
								)
								(ArrayCreationExpr
									(ClassOrInterfaceType
										SimpleName
									)
									(ArrayInitializerExpr
										(MethodCallExpr
											SimpleName
											NameExpr
												SimpleName
										)
										(MethodCallExpr
											SimpleName
											NameExpr
												SimpleName
										)
										NameExpr
											SimpleName
										NameExpr
											SimpleName
									)
									(ArrayCreationLevel
									)
								)
								SimpleName
								NameExpr
									SimpleName
							)
						)
						(ReturnStmt
							NameExpr
								SimpleName
						)
					)
				)
			)
		)
		(ExpressionStmt
			(AssignExpr
				NameExpr
					SimpleName
				StringLiteralExpr
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(BinaryExpr
						NameExpr
							SimpleName
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(BinaryExpr
						(BinaryExpr
							(BinaryExpr
								(BinaryExpr
									(BinaryExpr
										NameExpr
											SimpleName
										(MethodCallExpr
											SimpleName
											NameExpr
												SimpleName
										)
									)
									StringLiteralExpr
								)
								(MethodCallExpr
									SimpleName
									NameExpr
										SimpleName
								)
							)
							StringLiteralExpr
						)
						NameExpr
							SimpleName
					)
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						NameExpr
							SimpleName
						(MethodCallExpr
							(BinaryExpr
								(BinaryExpr
									NameExpr
										SimpleName
									StringLiteralExpr
								)
								NameExpr
									SimpleName
							)
							(DoubleLiteralExpr
							)
							SimpleName
							NameExpr
								SimpleName
						)
						SimpleName
						NameExpr
							SimpleName
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				StringLiteralExpr
				(ArrayCreationExpr
					(ClassOrInterfaceType
						SimpleName
					)
					(ArrayInitializerExpr
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
						NameExpr
							SimpleName
					)
					(ArrayCreationLevel
					)
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ReturnStmt
			NameExpr
				SimpleName
		)
	)
	(PrimitiveType
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(JavadocComment
	)
)
||||||||(MethodDeclaration
	(BlockStmt
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					SimpleName
					(ClassOrInterfaceType
						SimpleName
					)
				)
			)
		)
		(IfStmt
			(MethodCallExpr
				(BinaryExpr
					NameExpr
						SimpleName
					StringLiteralExpr
				)
				SimpleName
				NameExpr
					SimpleName
			)
			(BlockStmt
				(ExpressionStmt
					(VariableDeclarationExpr
						(VariableDeclarator
							(BinaryExpr
								NameExpr
									SimpleName
								StringLiteralExpr
							)
							SimpleName
							(ClassOrInterfaceType
								SimpleName
							)
						)
					)
				)
				(ExpressionStmt
					(VariableDeclarationExpr
						(VariableDeclarator
							(CastExpr
								(MethodCallExpr
									NameExpr
										SimpleName
									(IntegerLiteralExpr
									)
									SimpleName
									NameExpr
										SimpleName
								)
								(PrimitiveType
								)
							)
							SimpleName
							(PrimitiveType
							)
						)
					)
				)
				(IfStmt
					(BinaryExpr
						(BinaryExpr
							NameExpr
								SimpleName
							(IntegerLiteralExpr
							)
						)
						(MethodCallExpr
							NameExpr
								SimpleName
							NameExpr
								SimpleName
							SimpleName
						)
					)
					(BlockStmt
						(ExpressionStmt
							(VariableDeclarationExpr
								(VariableDeclarator
									(MethodCallExpr
										(BinaryExpr
											NameExpr
												SimpleName
											StringLiteralExpr
										)
										NameExpr
											SimpleName
										SimpleName
										NameExpr
											SimpleName
									)
									SimpleName
									(PrimitiveType
									)
								)
							)
						)
						(ExpressionStmt
							(MethodCallExpr
								(BinaryExpr
									StringLiteralExpr
									StringLiteralExpr
								)
								(ArrayCreationExpr
									(ClassOrInterfaceType
										SimpleName
									)
									(ArrayInitializerExpr
										(MethodCallExpr
											SimpleName
											NameExpr
												SimpleName
										)
										(MethodCallExpr
											SimpleName
											NameExpr
												SimpleName
										)
										NameExpr
											SimpleName
										NameExpr
											SimpleName
									)
									(ArrayCreationLevel
									)
								)
								SimpleName
								NameExpr
									SimpleName
							)
						)
						(ReturnStmt
							NameExpr
								SimpleName
						)
					)
				)
			)
		)
		(ExpressionStmt
			(AssignExpr
				NameExpr
					SimpleName
				StringLiteralExpr
			)
		)
		(ExpressionStmt
			(VariableDeclarationExpr
				(VariableDeclarator
					(MethodCallExpr
						NameExpr
							SimpleName
						NameExpr
							SimpleName
						(DoubleLiteralExpr
						)
						SimpleName
					)
					SimpleName
					(PrimitiveType
					)
				)
			)
		)
		(ExpressionStmt
			(MethodCallExpr
				StringLiteralExpr
				(ArrayCreationExpr
					(ClassOrInterfaceType
						SimpleName
					)
					(ArrayInitializerExpr
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
						(MethodCallExpr
							SimpleName
							NameExpr
								SimpleName
						)
						NameExpr
							SimpleName
					)
					(ArrayCreationLevel
					)
				)
				SimpleName
				NameExpr
					SimpleName
			)
		)
		(ReturnStmt
			NameExpr
				SimpleName
		)
	)
	(PrimitiveType
	)
	SimpleName
	(Parameter
		SimpleName
		(ClassOrInterfaceType
			SimpleName
		)
	)
	(JavadocComment
	)
)

