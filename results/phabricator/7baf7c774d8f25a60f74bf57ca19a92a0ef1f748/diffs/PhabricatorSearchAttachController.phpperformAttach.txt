||||||||  private function performAttach(
    $object_type,
    $object,
    $attach_type,
    array $phids) {

    $object_phid = $object->getPHID();

    // sort() so that removing [X, Y] and then adding [Y, X] is correctly
    // detected as a no-op.
    sort($phids);
    $old_phids = $object->getAttachedPHIDs($attach_type);
    sort($old_phids);
    $phids = array_values($phids);
    $old_phids = array_values($old_phids);

    if ($phids === $old_phids) {
      return;
    }

    $all_phids = array_merge($phids, $old_phids);
    $attach_objs = id(new PhabricatorObjectHandleData($all_phids))
      ->loadObjects();

    // Remove PHIDs which don't actually exist, to prevent silliness.
    $phids = array_keys(array_select_keys($attach_objs, $phids));
    if ($phids) {
      $phids = array_combine($phids, $phids);
    }

    // Update the primary object.
    $this->writeOutboundEdges($object_type, $object, $attach_type, $phids);

    // Loop through all of the attached/detached objects and update them.
    foreach ($attach_objs as $phid => $attach_obj) {
      $attached_phids = $attach_obj->getAttachedPHIDs($object_type);
      // Figure out if we're attaching or detaching this object.
      if (isset($phids[$phid])) {
        $attached_phids[] = $object_phid;
      } else {
        $attached_phids = array_fill_keys($attached_phids, true);
        unset($attached_phids[$object_phid]);
        $attached_phids = array_keys($attached_phids);
      }
      $this->writeOutboundEdges(
        $attach_type,
        $attach_obj,
        $object_type,
        $attached_phids);
    }
  }

||||||||||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(NO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPENO_PARAM_DEFAULTPARAM_TYPENO_PARAM_DEFAULT)
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_METHOD_CALL
            (AST_VAR)))
    (AST_CALL
        (
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_METHOD_CALL
            (AST_VAR)
            (
                (AST_VAR))))
    (AST_CALL
        (
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_CALL
            (
                (AST_VAR))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_CALL
            (
                (AST_VAR))))
    (AST_IF
        (AST_IF_ELEM
            (AST_BINARY_OP
                (AST_VAR)
                (AST_VAR))
            (
                (AST_RETURN
                    (NULL)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_CALL
            (
                (AST_VAR)
                (AST_VAR))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_METHOD_CALL
            (AST_CALL
                (
                    (AST_NEW
                        (
                            (AST_VAR)))))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_CALL
            (
                (AST_CALL
                    (
                        (AST_VAR)
                        (AST_VAR))))))
    (AST_IF
        (AST_IF_ELEM
            (AST_VAR)
            (
                (AST_ASSIGN
                    (AST_VAR)
                    (AST_CALL
                        (
                            (AST_VAR)
                            (AST_VAR)))))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)
            (AST_VAR)
            (AST_VAR)))
    (AST_FOREACH
        (AST_VAR)
        (AST_VAR)
        (AST_VAR)
        (
            (AST_ASSIGN
                (AST_VAR)
                (AST_METHOD_CALL
                    (AST_VAR)
                    (
                        (AST_VAR))))
            (AST_IF
                (AST_IF_ELEM
                    (AST_ISSET
                        (AST_DIM
                            (AST_VAR)
                            (AST_VAR)))
                    (
                        (AST_ASSIGN
                            (AST_DIM
                                (AST_VAR)
                                (NULL))
                            (AST_VAR))))
                (AST_IF_ELEM
                    (NULL)
                    (
                        (AST_ASSIGN
                            (AST_VAR)
                            (AST_CALL
                                (
                                    (AST_VAR)
                                    (AST_CONST))))
                        (AST_UNSET
                            (AST_DIM
                                (AST_VAR)
                                (AST_VAR)))
                        (AST_ASSIGN
                            (AST_VAR)
                            (AST_CALL
                                (
                                    (AST_VAR)))))))
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (AST_VAR)
                    (AST_VAR)
                    (AST_VAR)
                    (AST_VAR))))))