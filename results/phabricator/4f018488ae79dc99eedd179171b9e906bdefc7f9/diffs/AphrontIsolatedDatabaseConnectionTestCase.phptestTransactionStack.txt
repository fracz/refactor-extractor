||||||||  public function testTransactionStack() {
    $conn = $this->newIsolatedConnection();
    $conn->openTransaction();
      queryfx($conn, 'INSERT');
    $conn->saveTransaction();
    $this->assertEqual(
      array(
        'START TRANSACTION',
        'INSERT',
        'COMMIT',
      ),
      $conn->getQueryTranscript());

    $conn = $this->newIsolatedConnection();
    $conn->openTransaction();
      queryfx($conn, 'INSERT 1');
      $conn->openTransaction();
        queryfx($conn, 'INSERT 2');
      $conn->killTransaction();
      $conn->openTransaction();
        queryfx($conn, 'INSERT 3');
        $conn->openTransaction();
          queryfx($conn, 'INSERT 4');
        $conn->saveTransaction();
      $conn->saveTransaction();
      $conn->openTransaction();
        queryfx($conn, 'INSERT 5');
      $conn->killTransaction();
      queryfx($conn, 'INSERT 6');
    $conn->saveTransaction();

    $this->assertEqual(
      array(
        'START TRANSACTION',
        'INSERT 1',
        'SAVEPOINT Aphront_Savepoint_1',
        'INSERT 2',
        'ROLLBACK TO SAVEPOINT Aphront_Savepoint_1',
        'SAVEPOINT Aphront_Savepoint_1',
        'INSERT 3',
        'SAVEPOINT Aphront_Savepoint_2',
        'INSERT 4',
        'SAVEPOINT Aphront_Savepoint_1',
        'INSERT 5',
        'ROLLBACK TO SAVEPOINT Aphront_Savepoint_1',
        'INSERT 6',
        'COMMIT',
      ),
      $conn->getQueryTranscript());
  }

||||||||||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_METHOD_CALL
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_CALL
        (
            (AST_VAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL)))
            (AST_METHOD_CALL
                (AST_VAR))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_METHOD_CALL
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_CALL
        (
            (AST_VAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_CALL
        (
            (AST_VAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_CALL
        (
            (AST_VAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_CALL
        (
            (AST_VAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_CALL
        (
            (AST_VAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_CALL
        (
            (AST_VAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL)))
            (AST_METHOD_CALL
                (AST_VAR)))))