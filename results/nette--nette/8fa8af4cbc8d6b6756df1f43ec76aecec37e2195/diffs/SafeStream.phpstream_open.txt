||||||||	public function stream_open($path, $mode, $options, &$opened_path)
	{
		$path = substr($path, strlen(self::PROTOCOL)+3);  // trim protocol safe://

		$flag = trim($mode, 'rwax+');  // text | binary mode
		$mode = trim($mode, 'tb');     // mode
		$use_path = (bool) (STREAM_USE_PATH & $options); // use include_path?

		$append = FALSE;

		switch ($mode) {
		case 'r':
		case 'r+':
			// enter critical section: open and lock EXISTING file for reading/writing
			$handle = @fopen($path, $mode.$flag, $use_path); // intentionally @
			if (!$handle) return FALSE;
			if (flock($handle, $mode == 'r' ? LOCK_SH : LOCK_EX)) {
				$this->handle = $handle;
				return TRUE;
			}
			fclose($handle);
			return FALSE;

		case 'a':
		case 'a+': $append = TRUE;
		case 'w':
		case 'w+':
			// try enter critical section: open and lock EXISTING file for rewriting
			$handle = @fopen($path, 'r+'.$flag, $use_path); // intentionally @

			if ($handle) {
				if (flock($handle, LOCK_EX)) {
					if ($append) {
						fseek($handle, 0, SEEK_END);
						$this->startPos = ftell($handle);
					} else {
						ftruncate($handle, 0);
					}
					$this->handle = $handle;
					return TRUE;
				}
				fclose($handle);
			}
			// file doesn't exists, continue...
			$mode{0} = 'x'; // x || x+

		case 'x':
		case 'x+':
			if (file_exists($path)) return FALSE;

			// create temporary file in the same directory
			$tmp = '~~' . time() . '.tmp';

			// enter critical section: create temporary file
			$handle = @fopen($path . $tmp, $mode . $flag, $use_path); // intentionally @
			if ($handle) {
				if (flock($handle, LOCK_EX)) {
					$this->handle = $handle;
					if (!@rename($path . $tmp, $path)) { // intentionally @
						// rename later - for windows
						$this->tempFile = realpath($path . $tmp);
						$this->filePath = substr($this->tempFile, 0, -strlen($tmp));
					}
					return TRUE;
				}
				fclose($handle);
				unlink($path . $tmp);
			}
			return FALSE;

		default:
			trigger_error("Unsupported mode $mode", E_USER_WARNING);
			return FALSE;
		} // switch

	} // stream_open



	/**
	 * Closes file.
	 * @return void
	 */
||||||||||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(NO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPENO_PARAM_DEFAULT)
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_CALL
            (
                (AST_VAR)
                (AST_BINARY_OP
                    (AST_CALL
                        (
                            (AST_CLASS_CONST
                                (SCALAR))))
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_CALL
            (
                (AST_VAR)
                (SCALAR))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_CALL
            (
                (AST_VAR)
                (SCALAR))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_CAST
            (AST_BINARY_OP
                (AST_CONST)
                (AST_VAR))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_CONST))
    (AST_SWITCH
        (AST_VAR)
        (AST_SWITCH_LIST
            (AST_SWITCH_CASE
                (SCALAR))
            (AST_SWITCH_CASE
                (SCALAR)
                (
                    (AST_ASSIGN
                        (AST_VAR)
                        (AST_UNARY_OP
                            (AST_CALL
                                (
                                    (AST_VAR)
                                    (AST_BINARY_OP
                                        (AST_VAR)
                                        (AST_VAR))
                                    (AST_VAR)))))
                    (AST_IF
                        (AST_IF_ELEM
                            (AST_UNARY_OP
                                (AST_VAR))
                            (
                                (AST_RETURN
                                    (AST_CONST)))))
                    (AST_IF
                        (AST_IF_ELEM
                            (AST_CALL
                                (
                                    (AST_VAR)
                                    (AST_CONDITIONAL
                                        (AST_BINARY_OP
                                            (AST_VAR)
                                            (SCALAR))
                                        (AST_CONST)
                                        (AST_CONST))))
                            (
                                (AST_ASSIGN
                                    (AST_PROP
                                        (AST_VAR))
                                    (AST_VAR))
                                (AST_RETURN
                                    (AST_CONST)))))
                    (AST_CALL
                        (
                            (AST_VAR)))
                    (AST_RETURN
                        (AST_CONST))))
            (AST_SWITCH_CASE
                (SCALAR))
            (AST_SWITCH_CASE
                (SCALAR)
                (
                    (AST_ASSIGN
                        (AST_VAR)
                        (AST_CONST))))
            (AST_SWITCH_CASE
                (SCALAR))
            (AST_SWITCH_CASE
                (SCALAR)
                (
                    (AST_ASSIGN
                        (AST_VAR)
                        (AST_UNARY_OP
                            (AST_CALL
                                (
                                    (AST_VAR)
                                    (AST_BINARY_OP
                                        (SCALAR)
                                        (AST_VAR))
                                    (AST_VAR)))))
                    (AST_IF
                        (AST_IF_ELEM
                            (AST_VAR)
                            (
                                (AST_IF
                                    (AST_IF_ELEM
                                        (AST_CALL
                                            (
                                                (AST_VAR)
                                                (AST_CONST)))
                                        (
                                            (AST_IF
                                                (AST_IF_ELEM
                                                    (AST_VAR)
                                                    (
                                                        (AST_CALL
                                                            (
                                                                (AST_VAR)
                                                                (SCALAR)
                                                                (AST_CONST)))
                                                        (AST_ASSIGN
                                                            (AST_PROP
                                                                (AST_VAR))
                                                            (AST_CALL
                                                                (
                                                                    (AST_VAR))))))
                                                (AST_IF_ELEM
                                                    (NULL)
                                                    (
                                                        (AST_CALL
                                                            (
                                                                (AST_VAR)
                                                                (SCALAR))))))
                                            (AST_ASSIGN
                                                (AST_PROP
                                                    (AST_VAR))
                                                (AST_VAR))
                                            (AST_RETURN
                                                (AST_CONST)))))
                                (AST_CALL
                                    (
                                        (AST_VAR))))))
                    (AST_ASSIGN
                        (AST_DIM
                            (AST_VAR)
                            (SCALAR))
                        (SCALAR))))
            (AST_SWITCH_CASE
                (SCALAR))
            (AST_SWITCH_CASE
                (SCALAR)
                (
                    (AST_IF
                        (AST_IF_ELEM
                            (AST_CALL
                                (
                                    (AST_VAR)))
                            (
                                (AST_RETURN
                                    (AST_CONST)))))
                    (AST_ASSIGN
                        (AST_VAR)
                        (AST_BINARY_OP
                            (AST_BINARY_OP
                                (SCALAR)
                                (AST_CALL))
                            (SCALAR)))
                    (AST_ASSIGN
                        (AST_VAR)
                        (AST_UNARY_OP
                            (AST_CALL
                                (
                                    (AST_BINARY_OP
                                        (AST_VAR)
                                        (AST_VAR))
                                    (AST_BINARY_OP
                                        (AST_VAR)
                                        (AST_VAR))
                                    (AST_VAR)))))
                    (AST_IF
                        (AST_IF_ELEM
                            (AST_VAR)
                            (
                                (AST_IF
                                    (AST_IF_ELEM
                                        (AST_CALL
                                            (
                                                (AST_VAR)
                                                (AST_CONST)))
                                        (
                                            (AST_ASSIGN
                                                (AST_PROP
                                                    (AST_VAR))
                                                (AST_VAR))
                                            (AST_IF
                                                (AST_IF_ELEM
                                                    (AST_UNARY_OP
                                                        (AST_UNARY_OP
                                                            (AST_CALL
                                                                (
                                                                    (AST_BINARY_OP
                                                                        (AST_VAR)
                                                                        (AST_VAR))
                                                                    (AST_VAR)))))
                                                    (
                                                        (AST_ASSIGN
                                                            (AST_PROP
                                                                (AST_VAR))
                                                            (AST_CALL
                                                                (
                                                                    (AST_BINARY_OP
                                                                        (AST_VAR)
                                                                        (AST_VAR)))))
                                                        (AST_ASSIGN
                                                            (AST_PROP
                                                                (AST_VAR))
                                                            (AST_CALL
                                                                (
                                                                    (AST_PROP
                                                                        (AST_VAR))
                                                                    (SCALAR)
                                                                    (AST_UNARY_OP
                                                                        (AST_CALL
                                                                            (
                                                                                (AST_VAR))))))))))
                                            (AST_RETURN
                                                (AST_CONST)))))
                                (AST_CALL
                                    (
                                        (AST_VAR)))
                                (AST_CALL
                                    (
                                        (AST_BINARY_OP
                                            (AST_VAR)
                                            (AST_VAR)))))))
                    (AST_RETURN
                        (AST_CONST))))
            (AST_SWITCH_CASE
                (NULL)
                (
                    (AST_CALL
                        (
                            (AST_ENCAPS_LIST
                                (SCALAR)
                                (AST_VAR))
                            (AST_CONST)))
                    (AST_RETURN
                        (AST_CONST)))))))