	private function newsletterRegistration()
	{
		if (empty($_POST['email']) || !Validate::isEmail($_POST['email']))
			return $this->error = $this->l('Invalid email address');

		/* Unsubscription */
		else if ($_POST['action'] == '1')
		{
			$register_status = $this->isNewsletterRegistered($_POST['email']);
			if ($register_status < 1)
				return $this->error = $this->l('This email address is not registered.');
			else if ($register_status == self::GUEST_REGISTERED)
			{
				if (!Db::getInstance()->execute('DELETE FROM '._DB_PREFIX_.'newsletter WHERE `email` = \''.pSQL($_POST['email']).'\' AND id_shop = '.$this->context->shop->id))
					return $this->error = $this->l('An error occurred while attempting to unsubscribe.');
				return $this->valid = $this->l('Unsubscription successful');
			}
			else if ($register_status == self::CUSTOMER_REGISTERED)
			{
				if (!Db::getInstance()->execute('UPDATE '._DB_PREFIX_.'customer SET `newsletter` = 0 WHERE `email` = \''.pSQL($_POST['email']).'\' AND id_shop = '.$this->context->shop->id))
					return $this->error = $this->l('An error occurred while attempting to unsubscribe.');
				return $this->valid = $this->l('Unsubscription successful');
			}
		}
		/* Subscription */
		else if ($_POST['action'] == '0')
		{
			$register_status = $this->isNewsletterRegistered($_POST['email']);
			if ($register_status > 0)
				return $this->error = $this->l('This email address is already registered.');

			$email = pSQL($_POST['email']);
			if (!$this->isRegistered($register_status))
			{
				if (Configuration::get('NW_VERIFICATION_EMAIL'))
				{
					// create an unactive entry in the newsletter database
					if ($register_status == self::GUEST_NOT_REGISTERED)
						$this->registerGuest($email, false);

					if (!$token = $this->getToken($email, $register_status))
						return $this->error = $this->l('An error occurred during the subscription process.');

					$this->sendVerificationEmail($email, $token);

					return $this->valid = $this->l('A verification email has been sent. Please check your inbox.');
				}
				else
				{
					if ($this->register($email, $register_status))
						$this->valid = $this->l('You have successfully subscribed to this newsletter.');
					else
						return $this->error = $this->l('An error occurred during the subscription process.');

					if ($code = Configuration::get('NW_VOUCHER_CODE'))
						$this->sendVoucher($email, $code);

					if (Configuration::get('NW_CONFIRMATION_EMAIL'))
						$this->sendConfirmationEmail($email);
				}
			}
		}
	}

	/**
	 * Return true if the registered status correspond to a registered user
	 * @param int $register_status
	 * @return bool
	 */
||||||||	private function newsletterRegistration()
	{
		if (empty($_POST['email']) || !Validate::isEmail($_POST['email']))
			return $this->error = $this->l('Invalid email address');

		/* Unsubscription */
		else if ($_POST['action'] == '1')
		{
			$register_status = $this->isNewsletterRegistered($_POST['email']);

			if ($register_status < 1)
				return $this->error = $this->l('This email address is not registered.');

			if (!$this->unregister($_POST['email'], $register_status))
				return $this->error = $this->l('An error occurred while attempting to unsubscribe.');

			return $this->valid = $this->l('Unsubscription successful');
		}
		/* Subscription */
		else if ($_POST['action'] == '0')
		{
			$register_status = $this->isNewsletterRegistered($_POST['email']);
			if ($register_status > 0)
				return $this->error = $this->l('This email address is already registered.');

			$email = pSQL($_POST['email']);
			if (!$this->isRegistered($register_status))
			{
				if (Configuration::get('NW_VERIFICATION_EMAIL'))
				{
					// create an unactive entry in the newsletter database
					if ($register_status == self::GUEST_NOT_REGISTERED)
						$this->registerGuest($email, false);

					if (!$token = $this->getToken($email, $register_status))
						return $this->error = $this->l('An error occurred during the subscription process.');

					$this->sendVerificationEmail($email, $token);

					return $this->valid = $this->l('A verification email has been sent. Please check your inbox.');
				}
				else
				{
					if ($this->register($email, $register_status))
						$this->valid = $this->l('You have successfully subscribed to this newsletter.');
					else
						return $this->error = $this->l('An error occurred during the subscription process.');

					if ($code = Configuration::get('NW_VOUCHER_CODE'))
						$this->sendVoucher($email, $code);

					if (Configuration::get('NW_CONFIRMATION_EMAIL'))
						$this->sendConfirmationEmail($email);
				}
			}
		}
	}

	/**
	 * Return true if the registered status correspond to a registered user
	 * @param int $register_status
	 * @return bool
	 */
||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_IF
        (AST_IF_ELEM
            (AST_BINARY_OP
                (AST_EMPTY
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_UNARY_OP
                    (AST_STATIC_CALL
                        (
                            (AST_DIM
                                (AST_VAR)
                                (SCALAR))))))
            (
                (AST_RETURN
                    (AST_ASSIGN
                        (AST_PROP
                            (AST_VAR))
                        (AST_METHOD_CALL
                            (AST_VAR)
                            (
                                (SCALAR)))))))
        (AST_IF_ELEM
            (NULL)
            (
                (AST_IF
                    (AST_IF_ELEM
                        (AST_BINARY_OP
                            (AST_DIM
                                (AST_VAR)
                                (SCALAR))
                            (SCALAR))
                        (
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_METHOD_CALL
                                    (AST_VAR)
                                    (
                                        (AST_DIM
                                            (AST_VAR)
                                            (SCALAR)))))
                            (AST_IF
                                (AST_IF_ELEM
                                    (AST_BINARY_OP
                                        (AST_VAR)
                                        (SCALAR))
                                    (
                                        (AST_RETURN
                                            (AST_ASSIGN
                                                (AST_PROP
                                                    (AST_VAR))
                                                (AST_METHOD_CALL
                                                    (AST_VAR)
                                                    (
                                                        (SCALAR)))))))
                                (AST_IF_ELEM
                                    (NULL)
                                    (
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_BINARY_OP
                                                    (AST_VAR)
                                                    (AST_CLASS_CONST
                                                        (SCALAR)))
                                                (
                                                    (AST_IF
                                                        (AST_IF_ELEM
                                                            (AST_UNARY_OP
                                                                (AST_METHOD_CALL
                                                                    (AST_STATIC_CALL)
                                                                    (
                                                                        (AST_BINARY_OP
                                                                            (AST_BINARY_OP
                                                                                (AST_BINARY_OP
                                                                                    (AST_BINARY_OP
                                                                                        (AST_BINARY_OP
                                                                                            (SCALAR)
                                                                                            (AST_CONST))
                                                                                        (SCALAR))
                                                                                    (AST_CALL
                                                                                        (
                                                                                            (AST_DIM
                                                                                                (AST_VAR)
                                                                                                (SCALAR)))))
                                                                                (SCALAR))
                                                                            (AST_PROP
                                                                                (AST_PROP
                                                                                    (AST_PROP
                                                                                        (AST_VAR))))))))
                                                            (
                                                                (AST_RETURN
                                                                    (AST_ASSIGN
                                                                        (AST_PROP
                                                                            (AST_VAR))
                                                                        (AST_METHOD_CALL
                                                                            (AST_VAR)
                                                                            (
                                                                                (SCALAR))))))))
                                                    (AST_RETURN
                                                        (AST_ASSIGN
                                                            (AST_PROP
                                                                (AST_VAR))
                                                            (AST_METHOD_CALL
                                                                (AST_VAR)
                                                                (
                                                                    (SCALAR)))))))
                                            (AST_IF_ELEM
                                                (NULL)
                                                (
                                                    (AST_IF
                                                        (AST_IF_ELEM
                                                            (AST_BINARY_OP
                                                                (AST_VAR)
                                                                (AST_CLASS_CONST
                                                                    (SCALAR)))
                                                            (
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_UNARY_OP
                                                                            (AST_METHOD_CALL
                                                                                (AST_STATIC_CALL)
                                                                                (
                                                                                    (AST_BINARY_OP
                                                                                        (AST_BINARY_OP
                                                                                            (AST_BINARY_OP
                                                                                                (AST_BINARY_OP
                                                                                                    (AST_BINARY_OP
                                                                                                        (SCALAR)
                                                                                                        (AST_CONST))
                                                                                                    (SCALAR))
                                                                                                (AST_CALL
                                                                                                    (
                                                                                                        (AST_DIM
                                                                                                            (AST_VAR)
                                                                                                            (SCALAR)))))
                                                                                            (SCALAR))
                                                                                        (AST_PROP
                                                                                            (AST_PROP
                                                                                                (AST_PROP
                                                                                                    (AST_VAR))))))))
                                                                        (
                                                                            (AST_RETURN
                                                                                (AST_ASSIGN
                                                                                    (AST_PROP
                                                                                        (AST_VAR))
                                                                                    (AST_METHOD_CALL
                                                                                        (AST_VAR)
                                                                                        (
                                                                                            (SCALAR))))))))
                                                                (AST_RETURN
                                                                    (AST_ASSIGN
                                                                        (AST_PROP
                                                                            (AST_VAR))
                                                                        (AST_METHOD_CALL
                                                                            (AST_VAR)
                                                                            (
                                                                                (SCALAR))))))))))))))))
                    (AST_IF_ELEM
                        (NULL)
                        (
                            (AST_IF
                                (AST_IF_ELEM
                                    (AST_BINARY_OP
                                        (AST_DIM
                                            (AST_VAR)
                                            (SCALAR))
                                        (SCALAR))
                                    (
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_METHOD_CALL
                                                (AST_VAR)
                                                (
                                                    (AST_DIM
                                                        (AST_VAR)
                                                        (SCALAR)))))
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_BINARY_OP
                                                    (AST_VAR)
                                                    (SCALAR))
                                                (
                                                    (AST_RETURN
                                                        (AST_ASSIGN
                                                            (AST_PROP
                                                                (AST_VAR))
                                                            (AST_METHOD_CALL
                                                                (AST_VAR)
                                                                (
                                                                    (SCALAR))))))))
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_CALL
                                                (
                                                    (AST_DIM
                                                        (AST_VAR)
                                                        (SCALAR)))))
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_UNARY_OP
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (AST_VAR))))
                                                (
                                                    (AST_IF
                                                        (AST_IF_ELEM
                                                            (AST_STATIC_CALL
                                                                (
                                                                    (SCALAR)))
                                                            (
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_BINARY_OP
                                                                            (AST_VAR)
                                                                            (AST_CLASS_CONST
                                                                                (SCALAR)))
                                                                        (
                                                                            (AST_METHOD_CALL
                                                                                (AST_VAR)
                                                                                (
                                                                                    (AST_VAR)
                                                                                    (AST_CONST))))))
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_UNARY_OP
                                                                            (AST_ASSIGN
                                                                                (AST_VAR)
                                                                                (AST_METHOD_CALL
                                                                                    (AST_VAR)
                                                                                    (
                                                                                        (AST_VAR)
                                                                                        (AST_VAR)))))
                                                                        (
                                                                            (AST_RETURN
                                                                                (AST_ASSIGN
                                                                                    (AST_PROP
                                                                                        (AST_VAR))
                                                                                    (AST_METHOD_CALL
                                                                                        (AST_VAR)
                                                                                        (
                                                                                            (SCALAR))))))))
                                                                (AST_METHOD_CALL
                                                                    (AST_VAR)
                                                                    (
                                                                        (AST_VAR)
                                                                        (AST_VAR)))
                                                                (AST_RETURN
                                                                    (AST_ASSIGN
                                                                        (AST_PROP
                                                                            (AST_VAR))
                                                                        (AST_METHOD_CALL
                                                                            (AST_VAR)
                                                                            (
                                                                                (SCALAR)))))))
                                                        (AST_IF_ELEM
                                                            (NULL)
                                                            (
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_METHOD_CALL
                                                                            (AST_VAR)
                                                                            (
                                                                                (AST_VAR)
                                                                                (AST_VAR)))
                                                                        (
                                                                            (AST_ASSIGN
                                                                                (AST_PROP
                                                                                    (AST_VAR))
                                                                                (AST_METHOD_CALL
                                                                                    (AST_VAR)
                                                                                    (
                                                                                        (SCALAR))))))
                                                                    (AST_IF_ELEM
                                                                        (NULL)
                                                                        (
                                                                            (AST_RETURN
                                                                                (AST_ASSIGN
                                                                                    (AST_PROP
                                                                                        (AST_VAR))
                                                                                    (AST_METHOD_CALL
                                                                                        (AST_VAR)
                                                                                        (
                                                                                            (SCALAR))))))))
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_ASSIGN
                                                                            (AST_VAR)
                                                                            (AST_STATIC_CALL
                                                                                (
                                                                                    (SCALAR))))
                                                                        (
                                                                            (AST_METHOD_CALL
                                                                                (AST_VAR)
                                                                                (
                                                                                    (AST_VAR)
                                                                                    (AST_VAR))))))
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_STATIC_CALL
                                                                            (
                                                                                (SCALAR)))
                                                                        (
                                                                            (AST_METHOD_CALL
                                                                                (AST_VAR)
                                                                                (
                                                                                    (AST_VAR))))))))))))))))))))))||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_IF
        (AST_IF_ELEM
            (AST_BINARY_OP
                (AST_EMPTY
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_UNARY_OP
                    (AST_STATIC_CALL
                        (
                            (AST_DIM
                                (AST_VAR)
                                (SCALAR))))))
            (
                (AST_RETURN
                    (AST_ASSIGN
                        (AST_PROP
                            (AST_VAR))
                        (AST_METHOD_CALL
                            (AST_VAR)
                            (
                                (SCALAR)))))))
        (AST_IF_ELEM
            (NULL)
            (
                (AST_IF
                    (AST_IF_ELEM
                        (AST_BINARY_OP
                            (AST_DIM
                                (AST_VAR)
                                (SCALAR))
                            (SCALAR))
                        (
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_METHOD_CALL
                                    (AST_VAR)
                                    (
                                        (AST_DIM
                                            (AST_VAR)
                                            (SCALAR)))))
                            (AST_IF
                                (AST_IF_ELEM
                                    (AST_BINARY_OP
                                        (AST_VAR)
                                        (SCALAR))
                                    (
                                        (AST_RETURN
                                            (AST_ASSIGN
                                                (AST_PROP
                                                    (AST_VAR))
                                                (AST_METHOD_CALL
                                                    (AST_VAR)
                                                    (
                                                        (SCALAR))))))))
                            (AST_IF
                                (AST_IF_ELEM
                                    (AST_UNARY_OP
                                        (AST_METHOD_CALL
                                            (AST_VAR)
                                            (
                                                (AST_DIM
                                                    (AST_VAR)
                                                    (SCALAR))
                                                (AST_VAR))))
                                    (
                                        (AST_RETURN
                                            (AST_ASSIGN
                                                (AST_PROP
                                                    (AST_VAR))
                                                (AST_METHOD_CALL
                                                    (AST_VAR)
                                                    (
                                                        (SCALAR))))))))
                            (AST_RETURN
                                (AST_ASSIGN
                                    (AST_PROP
                                        (AST_VAR))
                                    (AST_METHOD_CALL
                                        (AST_VAR)
                                        (
                                            (SCALAR)))))))
                    (AST_IF_ELEM
                        (NULL)
                        (
                            (AST_IF
                                (AST_IF_ELEM
                                    (AST_BINARY_OP
                                        (AST_DIM
                                            (AST_VAR)
                                            (SCALAR))
                                        (SCALAR))
                                    (
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_METHOD_CALL
                                                (AST_VAR)
                                                (
                                                    (AST_DIM
                                                        (AST_VAR)
                                                        (SCALAR)))))
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_BINARY_OP
                                                    (AST_VAR)
                                                    (SCALAR))
                                                (
                                                    (AST_RETURN
                                                        (AST_ASSIGN
                                                            (AST_PROP
                                                                (AST_VAR))
                                                            (AST_METHOD_CALL
                                                                (AST_VAR)
                                                                (
                                                                    (SCALAR))))))))
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_CALL
                                                (
                                                    (AST_DIM
                                                        (AST_VAR)
                                                        (SCALAR)))))
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_UNARY_OP
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (AST_VAR))))
                                                (
                                                    (AST_IF
                                                        (AST_IF_ELEM
                                                            (AST_STATIC_CALL
                                                                (
                                                                    (SCALAR)))
                                                            (
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_BINARY_OP
                                                                            (AST_VAR)
                                                                            (AST_CLASS_CONST
                                                                                (SCALAR)))
                                                                        (
                                                                            (AST_METHOD_CALL
                                                                                (AST_VAR)
                                                                                (
                                                                                    (AST_VAR)
                                                                                    (AST_CONST))))))
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_UNARY_OP
                                                                            (AST_ASSIGN
                                                                                (AST_VAR)
                                                                                (AST_METHOD_CALL
                                                                                    (AST_VAR)
                                                                                    (
                                                                                        (AST_VAR)
                                                                                        (AST_VAR)))))
                                                                        (
                                                                            (AST_RETURN
                                                                                (AST_ASSIGN
                                                                                    (AST_PROP
                                                                                        (AST_VAR))
                                                                                    (AST_METHOD_CALL
                                                                                        (AST_VAR)
                                                                                        (
                                                                                            (SCALAR))))))))
                                                                (AST_METHOD_CALL
                                                                    (AST_VAR)
                                                                    (
                                                                        (AST_VAR)
                                                                        (AST_VAR)))
                                                                (AST_RETURN
                                                                    (AST_ASSIGN
                                                                        (AST_PROP
                                                                            (AST_VAR))
                                                                        (AST_METHOD_CALL
                                                                            (AST_VAR)
                                                                            (
                                                                                (SCALAR)))))))
                                                        (AST_IF_ELEM
                                                            (NULL)
                                                            (
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_METHOD_CALL
                                                                            (AST_VAR)
                                                                            (
                                                                                (AST_VAR)
                                                                                (AST_VAR)))
                                                                        (
                                                                            (AST_ASSIGN
                                                                                (AST_PROP
                                                                                    (AST_VAR))
                                                                                (AST_METHOD_CALL
                                                                                    (AST_VAR)
                                                                                    (
                                                                                        (SCALAR))))))
                                                                    (AST_IF_ELEM
                                                                        (NULL)
                                                                        (
                                                                            (AST_RETURN
                                                                                (AST_ASSIGN
                                                                                    (AST_PROP
                                                                                        (AST_VAR))
                                                                                    (AST_METHOD_CALL
                                                                                        (AST_VAR)
                                                                                        (
                                                                                            (SCALAR))))))))
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_ASSIGN
                                                                            (AST_VAR)
                                                                            (AST_STATIC_CALL
                                                                                (
                                                                                    (SCALAR))))
                                                                        (
                                                                            (AST_METHOD_CALL
                                                                                (AST_VAR)
                                                                                (
                                                                                    (AST_VAR)
                                                                                    (AST_VAR))))))
                                                                (AST_IF
                                                                    (AST_IF_ELEM
                                                                        (AST_STATIC_CALL
                                                                            (
                                                                                (SCALAR)))
                                                                        (
                                                                            (AST_METHOD_CALL
                                                                                (AST_VAR)
                                                                                (
                                                                                    (AST_VAR))))))))))))))))))))))