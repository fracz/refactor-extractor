	protected static function getProductsToIndex($total_languages, $id_product = false, $limit = 50, $weight_array = array())
	{
		$ids = null;
		if (!$id_product)
		{
			// Limit products for each step but be sure that each attribute is taken into account
			$sql = 'SELECT p.id_product FROM '._DB_PREFIX_.'product p
				'.Shop::addSqlAssociation('product', 'p', true, null, true).'
				WHERE product_shop.`indexed` = 0
				AND product_shop.`visibility` IN ("both", "search")
				AND product_shop.`active` = 1
				ORDER BY product_shop.`id_product` ASC
				LIMIT '.(int)$limit;


			$res = Db::getInstance()->executeS($sql, false);
			while ($row = Db::getInstance()->nextRow($res))
				$ids[] = $row['id_product'];
		}

		// Now get every attribute in every language
		$sql = 'SELECT p.id_product, pl.id_lang, pl.id_shop, l.iso_code';

		if (is_array($weight_array))
			foreach ($weight_array as $key => $weight)
				if ((int)$weight)
					switch ($key)
					{
						case 'pname':
							$sql .= ', pl.name pname';
						break;
						case 'reference':
							$sql .= ', p.reference';
						break;
						case 'supplier_reference':
							$sql .= ', p.supplier_reference';
						break;
						case 'ean13':
							$sql .= ', p.ean13';
						break;
						case 'upc':
							$sql .= ', p.upc';
						break;
						case 'description_short':
							$sql .= ', pl.description_short';
						break;
						case 'description':
							$sql .= ', pl.description';
						break;
						case 'cname':
							$sql .= ', cl.name cname';
						break;
						case 'mname':
							$sql .= ', m.name mname';
						break;
					}

		$sql .= ' FROM '._DB_PREFIX_.'product p
			LEFT JOIN '._DB_PREFIX_.'product_lang pl
				ON p.id_product = pl.id_product
			'.Shop::addSqlAssociation('product', 'p', true, null, true).'
			LEFT JOIN '._DB_PREFIX_.'category_lang cl
				ON (cl.id_category = product_shop.id_category_default AND pl.id_lang = cl.id_lang AND cl.id_shop = product_shop.id_shop)
			LEFT JOIN '._DB_PREFIX_.'manufacturer m
				ON m.id_manufacturer = p.id_manufacturer
			LEFT JOIN '._DB_PREFIX_.'lang l
				ON l.id_lang = pl.id_lang
			WHERE product_shop.indexed = 0
			AND product_shop.visibility IN ("both", "search")
			'.($id_product ? 'AND p.id_product = '.(int)$id_product : '').'
			'.($ids ? 'AND p.id_product IN ('.implode(',', array_map('intval', $ids)).')' : '').'
			AND product_shop.`active` = 1
			AND pl.`id_shop` = product_shop.`id_shop`';

		return Db::getInstance()->executeS($sql);
	}

	/**
	 * @param Db     $db
	 * @param int    $id_product
	 * @param string $sql_attribute
	 *
	 * @return array|null
	 */
||||||||	protected static function getProductsToIndex($total_languages, $id_product = false, $limit = 50, $weight_array = array())
	{
		$ids = null;
		if (!$id_product)
		{
			// Limit products for each step but be sure that each attribute is taken into account
			$sql = 'SELECT p.id_product FROM '._DB_PREFIX_.'product p
				'.Shop::addSqlAssociation('product', 'p', true, null, true).'
				WHERE product_shop.`indexed` = 0
				AND product_shop.`visibility` IN ("both", "search")
				AND product_shop.`active` = 1
				ORDER BY product_shop.`id_product` ASC
				LIMIT '.(int)$limit;


			$res = Db::getInstance()->executeS($sql, false);
			while ($row = Db::getInstance()->nextRow($res))
				$ids[] = $row['id_product'];
		}

		// Now get every attribute in every language
		$sql = 'SELECT p.id_product, pl.id_lang, pl.id_shop, l.iso_code';

		if (is_array($weight_array))
			foreach ($weight_array as $key => $weight)
				if ((int)$weight)
					switch ($key)
					{
						case 'pname':
							$sql .= ', pl.name pname';
						break;
						case 'reference':
							$sql .= ', p.reference';
						break;
						case 'supplier_reference':
							$sql .= ', p.supplier_reference';
						break;
						case 'ean13':
							$sql .= ', p.ean13';
						break;
						case 'upc':
							$sql .= ', p.upc';
						break;
						case 'description_short':
							$sql .= ', pl.description_short';
						break;
						case 'description':
							$sql .= ', pl.description';
						break;
						case 'cname':
							$sql .= ', cl.name cname';
						break;
						case 'mname':
							$sql .= ', m.name mname';
						break;
					}

		$sql .= ' FROM '._DB_PREFIX_.'product p
			LEFT JOIN '._DB_PREFIX_.'product_lang pl
				ON p.id_product = pl.id_product
			'.Shop::addSqlAssociation('product', 'p', true, null, true).'
			LEFT JOIN '._DB_PREFIX_.'category_lang cl
				ON (cl.id_category = product_shop.id_category_default AND pl.id_lang = cl.id_lang AND cl.id_shop = product_shop.id_shop)
			LEFT JOIN '._DB_PREFIX_.'manufacturer m
				ON m.id_manufacturer = p.id_manufacturer
			LEFT JOIN '._DB_PREFIX_.'lang l
				ON l.id_lang = pl.id_lang
			WHERE product_shop.indexed = 0
			AND product_shop.visibility IN ("both", "search")
			'.($id_product ? 'AND p.id_product = '.(int)$id_product : '').'
			'.($ids ? 'AND p.id_product IN ('.implode(',', array_map('intval', $ids)).')' : '').'
			AND product_shop.`active` = 1
			AND pl.`id_shop` = product_shop.`id_shop`';

		return Db::getInstance()->executeS($sql, true, false);
	}

	/**
	 * @param Db     $db
	 * @param int    $id_product
	 * @param string $sql_attribute
	 *
	 * @return array|null
	 */
||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(NO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPEPARAM_DEFAULTNO_PARAM_TYPEPARAM_DEFAULTNO_PARAM_TYPEPARAM_DEFAULT)
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_CONST))
    (AST_IF
        (AST_IF_ELEM
            (AST_UNARY_OP
                (AST_VAR))
            (
                (AST_ASSIGN
                    (AST_VAR)
                    (AST_BINARY_OP
                        (AST_BINARY_OP
                            (AST_BINARY_OP
                                (AST_BINARY_OP
                                    (AST_BINARY_OP
                                        (SCALAR)
                                        (AST_CONST))
                                    (SCALAR))
                                (AST_STATIC_CALL
                                    (
                                        (SCALAR)
                                        (SCALAR)
                                        (AST_CONST)
                                        (AST_CONST)
                                        (AST_CONST))))
                            (SCALAR))
                        (AST_CAST
                            (AST_VAR))))
                (AST_ASSIGN
                    (AST_VAR)
                    (AST_METHOD_CALL
                        (AST_STATIC_CALL)
                        (
                            (AST_VAR)
                            (AST_CONST))))
                (AST_WHILE
                    (AST_ASSIGN
                        (AST_VAR)
                        (AST_METHOD_CALL
                            (AST_STATIC_CALL)
                            (
                                (AST_VAR))))
                    (
                        (AST_ASSIGN
                            (AST_DIM
                                (AST_VAR)
                                (NULL))
                            (AST_DIM
                                (AST_VAR)
                                (SCALAR))))))))
    (AST_ASSIGN
        (AST_VAR)
        (SCALAR))
    (AST_IF
        (AST_IF_ELEM
            (AST_CALL
                (
                    (AST_VAR)))
            (
                (AST_FOREACH
                    (AST_VAR)
                    (AST_VAR)
                    (AST_VAR)
                    (
                        (AST_IF
                            (AST_IF_ELEM
                                (AST_CAST
                                    (AST_VAR))
                                (
                                    (AST_SWITCH
                                        (AST_VAR)
                                        (AST_SWITCH_LIST
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))))))))))))
    (AST_ASSIGN_OP
        (AST_VAR)
        (AST_BINARY_OP
            (AST_BINARY_OP
                (AST_BINARY_OP
                    (AST_BINARY_OP
                        (AST_BINARY_OP
                            (AST_BINARY_OP
                                (AST_BINARY_OP
                                    (AST_BINARY_OP
                                        (AST_BINARY_OP
                                            (AST_BINARY_OP
                                                (AST_BINARY_OP
                                                    (AST_BINARY_OP
                                                        (AST_BINARY_OP
                                                            (AST_BINARY_OP
                                                                (AST_BINARY_OP
                                                                    (AST_BINARY_OP
                                                                        (SCALAR)
                                                                        (AST_CONST))
                                                                    (SCALAR))
                                                                (AST_CONST))
                                                            (SCALAR))
                                                        (AST_STATIC_CALL
                                                            (
                                                                (SCALAR)
                                                                (SCALAR)
                                                                (AST_CONST)
                                                                (AST_CONST)
                                                                (AST_CONST))))
                                                    (SCALAR))
                                                (AST_CONST))
                                            (SCALAR))
                                        (AST_CONST))
                                    (SCALAR))
                                (AST_CONST))
                            (SCALAR))
                        (AST_CONDITIONAL
                            (AST_VAR)
                            (AST_BINARY_OP
                                (SCALAR)
                                (AST_CAST
                                    (AST_VAR)))
                            (SCALAR)))
                    (SCALAR))
                (AST_CONDITIONAL
                    (AST_VAR)
                    (AST_BINARY_OP
                        (AST_BINARY_OP
                            (SCALAR)
                            (AST_CALL
                                (
                                    (SCALAR)
                                    (AST_CALL
                                        (
                                            (SCALAR)
                                            (AST_VAR))))))
                        (SCALAR))
                    (SCALAR)))
            (SCALAR)))
    (AST_RETURN
        (AST_METHOD_CALL
            (AST_STATIC_CALL)
            (
                (AST_VAR)))))||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(NO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPEPARAM_DEFAULTNO_PARAM_TYPEPARAM_DEFAULTNO_PARAM_TYPEPARAM_DEFAULT)
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_CONST))
    (AST_IF
        (AST_IF_ELEM
            (AST_UNARY_OP
                (AST_VAR))
            (
                (AST_ASSIGN
                    (AST_VAR)
                    (AST_BINARY_OP
                        (AST_BINARY_OP
                            (AST_BINARY_OP
                                (AST_BINARY_OP
                                    (AST_BINARY_OP
                                        (SCALAR)
                                        (AST_CONST))
                                    (SCALAR))
                                (AST_STATIC_CALL
                                    (
                                        (SCALAR)
                                        (SCALAR)
                                        (AST_CONST)
                                        (AST_CONST)
                                        (AST_CONST))))
                            (SCALAR))
                        (AST_CAST
                            (AST_VAR))))
                (AST_ASSIGN
                    (AST_VAR)
                    (AST_METHOD_CALL
                        (AST_STATIC_CALL)
                        (
                            (AST_VAR)
                            (AST_CONST))))
                (AST_WHILE
                    (AST_ASSIGN
                        (AST_VAR)
                        (AST_METHOD_CALL
                            (AST_STATIC_CALL)
                            (
                                (AST_VAR))))
                    (
                        (AST_ASSIGN
                            (AST_DIM
                                (AST_VAR)
                                (NULL))
                            (AST_DIM
                                (AST_VAR)
                                (SCALAR))))))))
    (AST_ASSIGN
        (AST_VAR)
        (SCALAR))
    (AST_IF
        (AST_IF_ELEM
            (AST_CALL
                (
                    (AST_VAR)))
            (
                (AST_FOREACH
                    (AST_VAR)
                    (AST_VAR)
                    (AST_VAR)
                    (
                        (AST_IF
                            (AST_IF_ELEM
                                (AST_CAST
                                    (AST_VAR))
                                (
                                    (AST_SWITCH
                                        (AST_VAR)
                                        (AST_SWITCH_LIST
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))
                                            (AST_SWITCH_CASE
                                                (SCALAR)
                                                (
                                                    (AST_ASSIGN_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (AST_BREAK
                                                        (NULL))))))))))))))
    (AST_ASSIGN_OP
        (AST_VAR)
        (AST_BINARY_OP
            (AST_BINARY_OP
                (AST_BINARY_OP
                    (AST_BINARY_OP
                        (AST_BINARY_OP
                            (AST_BINARY_OP
                                (AST_BINARY_OP
                                    (AST_BINARY_OP
                                        (AST_BINARY_OP
                                            (AST_BINARY_OP
                                                (AST_BINARY_OP
                                                    (AST_BINARY_OP
                                                        (AST_BINARY_OP
                                                            (AST_BINARY_OP
                                                                (AST_BINARY_OP
                                                                    (AST_BINARY_OP
                                                                        (SCALAR)
                                                                        (AST_CONST))
                                                                    (SCALAR))
                                                                (AST_CONST))
                                                            (SCALAR))
                                                        (AST_STATIC_CALL
                                                            (
                                                                (SCALAR)
                                                                (SCALAR)
                                                                (AST_CONST)
                                                                (AST_CONST)
                                                                (AST_CONST))))
                                                    (SCALAR))
                                                (AST_CONST))
                                            (SCALAR))
                                        (AST_CONST))
                                    (SCALAR))
                                (AST_CONST))
                            (SCALAR))
                        (AST_CONDITIONAL
                            (AST_VAR)
                            (AST_BINARY_OP
                                (SCALAR)
                                (AST_CAST
                                    (AST_VAR)))
                            (SCALAR)))
                    (SCALAR))
                (AST_CONDITIONAL
                    (AST_VAR)
                    (AST_BINARY_OP
                        (AST_BINARY_OP
                            (SCALAR)
                            (AST_CALL
                                (
                                    (SCALAR)
                                    (AST_CALL
                                        (
                                            (SCALAR)
                                            (AST_VAR))))))
                        (SCALAR))
                    (SCALAR)))
            (SCALAR)))
    (AST_RETURN
        (AST_METHOD_CALL
            (AST_STATIC_CALL)
            (
                (AST_VAR)
                (AST_CONST)
                (AST_CONST)))))