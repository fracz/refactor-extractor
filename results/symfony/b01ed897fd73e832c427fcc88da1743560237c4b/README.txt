commit b01ed897fd73e832c427fcc88da1743560237c4b
Merge: 90a7fa0 6fbe9b1
Author: Fabien Potencier <fabien.potencier@gmail.com>
Date:   Wed Apr 8 07:21:37 2015 +0200

    feature #14178 [Config] Delegate creation of ConfigCache instances to a factory. (mpdude)

    This PR was squashed before being merged into the 2.7 branch (closes #14178).

    Discussion
    ----------

    [Config] Delegate creation of ConfigCache instances to a factory.

    | Q             | A
    | ------------- | ---
    | Bug fix?      | no
    | New feature?  | yes (refactoring, new flex point)
    | BC breaks?    | no
    | Deprecations? | yes
    | Tests pass?   | we'll see :-)
    | Fixed tickets | n/a
    | License       | MIT
    | Doc PR        | symfony/symfony-docs#5136

    In the Routing/Router and Translation/Translator, delegate creation of ConfigCache instances to a factory. The factory can be setter-injected but will default to a BC implementation.

    The ```ConfigCacheFactoryInterface``` is designed in a way that captures the common ```$cache = new ...; if (!$cache->isFresh()) { ... do sth }``` pattern. But more importantly, this design allows factory implementations to take additional measures to avoid race conditions before actually filling the cache.

    By using an exchangeable ConfigCache factory it becomes possible to implement different resource (freshness) checking strategies, especially service-based ones.

    The goal is to be able to validate Translators and Routers generated by database-based loaders. It might also help with symfony/AsseticBundle#168. This PR only contains the minimum changes needed, so the rest could be implemented in a bundle outside the core (at least for the beginning).

    Component/HttpKernel/Kernel::initializeContainer still uses the ConfigCache implementation directly as there is no sensible way of getting/injecting a factory service (chicken-egg).

    This is a pick off #7230. It replaces #7781 which was against the master branch. Also see #7781 for additional comments/explanations.

    ## Todo

    * [ ] Allow `symfony/config` `~3.0.0` in `composer.json` for the HttpKernel and Translator component as well as TwigBundle once this PR has been merged into the master branch (fail deps=high tests for the time being).

    Commits
    -------

    6fbe9b1 [Config] Delegate creation of ConfigCache instances to a factory.