    public function testGlobalsGetPassedToTemplate()
    {
        $engine = new ProjectTemplateEngine(self::$loader);
        $engine->setRenderer('php', new PhpRenderer());
        $engine->addGlobal('global', 'global variable');

        self::$loader->setTemplate('global.php', '<?php echo $global; ?>');

        $this->assertEquals($engine->render('global:php'), 'global variable');

        $this->assertEquals($engine->render('global:php', array('global' => 'overwritten')), 'overwritten');
    }
}

class ProjectTemplateEngine extends Engine
{
    public function getLoader()
    {
        return $this->loader;
    }

    public function getRenderers()
    {
        return $this->renderers;
    }
}

class ProjectTemplateRenderer extends PhpRenderer
{
    public function getEngine()
    {
        return $this->engine;
    }
}

class ProjectTemplateLoader extends Loader
{
    public $templates = array();

    public function setTemplate($name, $template)
    {
        $this->templates[$name] = $template;
    }

    public function load($template, array $options = array())
    {
        if (isset($this->templates[$template.'.'.$options['renderer']])) {
            return new StringStorage($this->templates[$template.'.'.$options['renderer']], $options['renderer']);
        }

        return false;
    }

    public function isFresh($template, array $options = array(), $time)
    {
        return false;
    }
}

class FooTemplateRenderer extends Renderer
{
    public function evaluate(Storage $template, array $parameters = array())
    {
        return 'foo';
    }
}||||||||||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_NEW
            (
                (AST_STATIC_PROP))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)
            (AST_NEW)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_STATIC_PROP)
        (
            (SCALAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)
                    (AST_ARRAY
                        (AST_ARRAY_ELEM
                            (SCALAR)
                            (SCALAR)))))
            (SCALAR))))||||||||