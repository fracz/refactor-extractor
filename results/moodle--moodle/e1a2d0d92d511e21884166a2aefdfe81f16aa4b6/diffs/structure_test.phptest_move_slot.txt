||||||||    public function test_move_slot() {
        // Create a test quiz with 8 questions.
        list($quiz, $cm, $course) = $this->prepare_quiz_data();
        $this->add_eight_questions_to_the_quiz($quiz);
        $quizobj = new quiz($quiz, $cm, $course);
        $structure = \mod_quiz\structure::create_for_quiz($quizobj);

        // Store the original order of slots, so we can assert what has changed.
        $originalslotids = array();
        foreach ($structure->get_slots() as $slot) {
            $originalslotids[$slot->slot] = $slot->id;
        }

        // Don't actually move anything. Check the layout is unchanged.
        $idmove = $structure->get_question_in_slot(2)->slotid;
        $idbefore = $structure->get_question_in_slot(1)->slotid;
        $structure->move_slot($idmove, $idbefore, 2);

        // Having called move, we need to reload $structure.
        $structure = \mod_quiz\structure::create_for_quiz($quizobj);
        $this->assert_quiz_layout(array(
                    $originalslotids[1] => 1,
                    $originalslotids[2] => 2,
                    $originalslotids[3] => 2,
                    $originalslotids[4] => 2,
                    $originalslotids[5] => 2,
                    $originalslotids[6] => 2,
                    $originalslotids[7] => 3,
                    $originalslotids[8] => 4,
                ), $structure);

        // Slots don't move. Page changed.
        $idmove = $structure->get_question_in_slot(2)->slotid;
        $idbefore = $structure->get_question_in_slot(1)->slotid;
        $structure->move_slot($idmove, $idbefore, 1);

        // Having called move, we need to reload $structure.
        $structure = \mod_quiz\structure::create_for_quiz($quizobj);
        $this->assert_quiz_layout(array(
                    $originalslotids[1] => 1,
                    $originalslotids[2] => 1,
                    $originalslotids[3] => 2,
                    $originalslotids[4] => 2,
                    $originalslotids[5] => 2,
                    $originalslotids[6] => 2,
                    $originalslotids[7] => 3,
                    $originalslotids[8] => 4,
                ), $structure);

        // Slots move 2 > 3. Page unchanged. Pages not reordered.
        $idmove = $structure->get_question_in_slot(2)->slotid;
        $idbefore = $structure->get_question_in_slot(3)->slotid;
        $structure->move_slot($idmove, $idbefore, '2');

        // Having called move, we need to reload $structure.
        $structure = \mod_quiz\structure::create_for_quiz($quizobj);
        $this->assert_quiz_layout(array(
                $originalslotids[1] => 1,
                $originalslotids[3] => 2,
                $originalslotids[2] => 2,
                $originalslotids[4] => 2,
                $originalslotids[5] => 2,
                $originalslotids[6] => 2,
                $originalslotids[7] => 3,
                $originalslotids[8] => 4,
        ), $structure);

        // Slots move 6 > 7. Page changed. Pages not reordered.
        $idmove = $structure->get_question_in_slot(6)->slotid;
        $idbefore = $structure->get_question_in_slot(7)->slotid;
        $structure->move_slot($idmove, $idbefore, '3');

        // Having called move, we need to reload $structure.
        $structure = \mod_quiz\structure::create_for_quiz($quizobj);
        $this->assert_quiz_layout(array(
                $originalslotids[1] => 1,
                $originalslotids[3] => 2,
                $originalslotids[2] => 2,
                $originalslotids[4] => 2,
                $originalslotids[5] => 2,
                $originalslotids[7] => 3,
                $originalslotids[6] => 3,
                $originalslotids[8] => 4,
        ), $structure);

        // Page changed slot 6 . Pages not reordered.
        $idmove = $structure->get_question_in_slot(6)->slotid;
        $idbefore = $structure->get_question_in_slot(5)->slotid;
        $structure->move_slot($idmove, $idbefore, 2);

        // Having called move, we need to reload $structure.
        $structure = \mod_quiz\structure::create_for_quiz($quizobj);
        $this->assert_quiz_layout(array(
                $originalslotids[1] => 1,
                $originalslotids[3] => 2,
                $originalslotids[2] => 2,
                $originalslotids[4] => 2,
                $originalslotids[5] => 2,
                $originalslotids[7] => 2,
                $originalslotids[6] => 3,
                $originalslotids[8] => 4,
        ), $structure);

        // Slots move 1 > 2. Page changed. Page 2 becomes page 1. Pages reordered.
        $idmove = $structure->get_question_in_slot(1)->slotid;
        $idbefore = $structure->get_question_in_slot(2)->slotid;
        $structure->move_slot($idmove, $idbefore, 2);

        // Having called move, we need to reload $structure.
        $structure = \mod_quiz\structure::create_for_quiz($quizobj);
        $this->assert_quiz_layout(array(
                $originalslotids[3] => 1,
                $originalslotids[1] => 1,
                $originalslotids[2] => 1,
                $originalslotids[4] => 1,
                $originalslotids[5] => 1,
                $originalslotids[7] => 1,
                $originalslotids[6] => 2,
                $originalslotids[8] => 3,
        ), $structure);

        // Slots move 7 > 3. Page changed. Page 3 becomes page 2. Pages reordered.
        $idmove = $structure->get_question_in_slot(7)->slotid;
        $idbefore = $structure->get_question_in_slot(2)->slotid;
        $structure->move_slot($idmove, $idbefore, 1);

        // Having called move, we need to reload $structure.
        $structure = \mod_quiz\structure::create_for_quiz($quizobj);
        $this->assert_quiz_layout(array(
                $originalslotids[3] => 1,
                $originalslotids[1] => 1,
                $originalslotids[6] => 1,
                $originalslotids[2] => 1,
                $originalslotids[4] => 1,
                $originalslotids[5] => 1,
                $originalslotids[7] => 1,
                $originalslotids[8] => 2,
        ), $structure);

        // Slots move 2 > top. No page changes.
        $idmove = $structure->get_question_in_slot(2)->slotid;
        $structure->move_slot($idmove, 0, 1);

        // Having called move, we need to reload $structure.
        $structure = \mod_quiz\structure::create_for_quiz($quizobj);
        $this->assert_quiz_layout(array(
                $originalslotids[1] => 1,
                $originalslotids[3] => 1,
                $originalslotids[6] => 1,
                $originalslotids[2] => 1,
                $originalslotids[4] => 1,
                $originalslotids[5] => 1,
                $originalslotids[7] => 1,
                $originalslotids[8] => 2,
        ), $structure);
    }

    /**
     * Test removing slots from a quiz.
     */
||||||||||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_ASSIGN
        (AST_ARRAY
            (AST_ARRAY_ELEM
                (AST_VAR)
                (NULL))
            (AST_ARRAY_ELEM
                (AST_VAR)
                (NULL))
            (AST_ARRAY_ELEM
                (AST_VAR)
                (NULL)))
        (AST_METHOD_CALL
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_NEW
            (
                (AST_VAR)
                (AST_VAR)
                (AST_VAR))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL
            (
                (AST_VAR))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_ARRAY))
    (AST_FOREACH
        (AST_METHOD_CALL
            (AST_VAR))
        (AST_VAR)
        (NULL)
        (
            (AST_ASSIGN
                (AST_DIM
                    (AST_VAR)
                    (AST_PROP
                        (AST_VAR)))
                (AST_PROP
                    (AST_VAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL
            (
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR))))
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL
            (
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR))))
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL
            (
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR))))
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL
            (
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR))))
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL
            (
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR))))
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL
            (
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR))))
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_VAR)
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL
            (
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR))))
            (AST_VAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_PROP
            (AST_METHOD_CALL
                (AST_VAR)
                (
                    (SCALAR)))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (SCALAR)
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_STATIC_CALL
            (
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR)))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR))))
            (AST_VAR))))