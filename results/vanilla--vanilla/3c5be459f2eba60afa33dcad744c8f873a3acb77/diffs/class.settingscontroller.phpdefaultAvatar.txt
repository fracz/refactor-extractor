||||||||    public function defaultAvatar() {
        $this->permission('Garden.Community.Manage');
        $this->addSideMenu('dashboard/settings/avatars');
        $this->title(t('Default Avatar'));
        $thumbnailSize = c('Garden.Thumbnail.Size', 40);
        $this->addJsFile('avatars.js');
        $validation = new Gdn_Validation();
        $configurationModel = new Gdn_ConfigurationModel($validation);
        $this->Form->setModel($configurationModel);
        if ($avatar = c('Garden.DefaultAvatar')) {
            $upload = new Gdn_Upload();
            // Make sure we're dealing with an uploaded image. We won't manipulate and save externally-hosted images.
            if ($upload->parse($avatar)) {
                $source = $upload->copyLocal(basename(changeBasename($avatar, "p%s")));
                $crop = new CropImageModule($this, $this->Form, $thumbnailSize, $thumbnailSize, $source);

                // TODO: I hate these settings
                $crop->setCurrentCroppedImageUrl(changeBasename($avatar, "n%s"));
                $crop->setSourceImageUrl(changeBasename($avatar, "p%s"));

                // Set crop data for the view.
                $this->setData('crop', $crop);
            } else {
                $this->setData('avatar', c('Garden.DefaultAvatar'));
            }
        } else {
            $this->setData('avatar', 'applications/dashboard/design/images/defaulticon.png');
        }

        // If seeing the form for the first time...
        if (!$this->Form->authenticatedPostBack()) {
            // Apply the config settings to the form.
            $this->Form->setData($configurationModel->Data);
        } else {
            if ($this->Form->save() !== false) {
                $upload = new Gdn_UploadImage();
                $newAvatars = false;
                if ($tmpAvatar = $upload->validateUpload('DefaultAvatar', false)) {
                    // New upload
                    $thumbOptions = array('Crop' => true, 'SaveGif' => c('Garden.Thumbnail.SaveGif'));
                    $newAvatars = $this->saveDefaultAvatars($tmpAvatar, $upload, $thumbOptions);
                } else if ($avatar && $crop && $crop->isCropped()) {
                    // New thumbnail
                    $tmpAvatar = $source;
                    $thumbOptions = array('Crop' => true,
                        'SourceX' => $crop->getCropXValue(),
                        'SourceY' => $crop->getCropYValue(),
                        'SourceWidth' => $crop->getCropWidth(),
                        'SourceHeight' => $crop->getCropHeight());
                    $newAvatars = $this->saveDefaultAvatars($tmpAvatar, $upload, $thumbOptions);
                }
                // No errors, delete old avatars, update data and forms, and save the avatar to config.
                if ($this->Form->errorCount() == 0) {
                    // Delete any previously uploaded images.
                    if ($avatar && $newAvatars) {
                        $upload->delete(basename($avatar));
                        $upload->delete(basename(changeBasename($avatar, 'p%s')));
                        $upload->delete(basename(changeBasename($avatar, 'n%s')));
                    }

                    if (!$crop && $newAvatars) {
                        $crop = new CropImageModule($this, $this->Form, $thumbnailSize, $thumbnailSize, $source);
                        $this->setData('crop', $crop);
                    }

                    if ($crop) {
                        $avatar = c('Garden.DefaultAvatar');
                        $thumbnailSize = c('Garden.Thumbnail.Size', 40);
                        // Set view data.
                        if ($newAvatars) {
                            $source = $upload->copyLocal(basename(changeBasename($avatar, "p%s")));
                            $crop->setSource($source);
                        }
                        $crop->setSize($thumbnailSize, $thumbnailSize);
                        $crop->setCurrentCroppedImageUrl(changeBasename($avatar, "n%s"));
                        $crop->setSourceImageUrl(changeBasename($avatar, "p%s"));
                    }
                }
                $this->informMessage(t("Your settings have been saved."));
            }
        }
        $this->render();
    }

||||||||||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_CALL
                (
                    (SCALAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_CALL
            (
                (SCALAR)
                (SCALAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_NEW))
    (AST_ASSIGN
        (AST_VAR)
        (AST_NEW
            (
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_PROP
            (AST_VAR))
        (
            (AST_VAR)))
    (AST_IF
        (AST_IF_ELEM
            (AST_ASSIGN
                (AST_VAR)
                (AST_CALL
                    (
                        (SCALAR))))
            (
                (AST_ASSIGN
                    (AST_VAR)
                    (AST_NEW))
                (AST_IF
                    (AST_IF_ELEM
                        (AST_METHOD_CALL
                            (AST_VAR)
                            (
                                (AST_VAR)))
                        (
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_METHOD_CALL
                                    (AST_VAR)
                                    (
                                        (AST_CALL
                                            (
                                                (AST_CALL
                                                    (
                                                        (AST_VAR)
                                                        (SCALAR))))))))
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_NEW
                                    (
                                        (AST_VAR)
                                        (AST_PROP
                                            (AST_VAR))
                                        (AST_VAR)
                                        (AST_VAR)
                                        (AST_VAR))))
                            (AST_METHOD_CALL
                                (AST_VAR)
                                (
                                    (AST_CALL
                                        (
                                            (AST_VAR)
                                            (SCALAR)))))
                            (AST_METHOD_CALL
                                (AST_VAR)
                                (
                                    (AST_CALL
                                        (
                                            (AST_VAR)
                                            (SCALAR)))))
                            (AST_METHOD_CALL
                                (AST_VAR)
                                (
                                    (SCALAR)
                                    (AST_VAR)))))
                    (AST_IF_ELEM
                        (NULL)
                        (
                            (AST_METHOD_CALL
                                (AST_VAR)
                                (
                                    (SCALAR)
                                    (AST_CALL
                                        (
                                            (SCALAR))))))))))
        (AST_IF_ELEM
            (NULL)
            (
                (AST_METHOD_CALL
                    (AST_VAR)
                    (
                        (SCALAR)
                        (SCALAR))))))
    (AST_IF
        (AST_IF_ELEM
            (AST_UNARY_OP
                (AST_METHOD_CALL
                    (AST_PROP
                        (AST_VAR))))
            (
                (AST_METHOD_CALL
                    (AST_PROP
                        (AST_VAR))
                    (
                        (AST_PROP
                            (AST_VAR))))))
        (AST_IF_ELEM
            (NULL)
            (
                (AST_IF
                    (AST_IF_ELEM
                        (AST_BINARY_OP
                            (AST_METHOD_CALL
                                (AST_PROP
                                    (AST_VAR)))
                            (AST_CONST))
                        (
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_NEW))
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_CONST))
                            (AST_IF
                                (AST_IF_ELEM
                                    (AST_ASSIGN
                                        (AST_VAR)
                                        (AST_METHOD_CALL
                                            (AST_VAR)
                                            (
                                                (SCALAR)
                                                (AST_CONST))))
                                    (
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_ARRAY
                                                (AST_ARRAY_ELEM
                                                    (AST_CONST)
                                                    (SCALAR))
                                                (AST_ARRAY_ELEM
                                                    (AST_CALL
                                                        (
                                                            (SCALAR)))
                                                    (SCALAR))))
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_METHOD_CALL
                                                (AST_VAR)
                                                (
                                                    (AST_VAR)
                                                    (AST_VAR)
                                                    (AST_VAR))))))
                                (AST_IF_ELEM
                                    (NULL)
                                    (
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_BINARY_OP
                                                    (AST_BINARY_OP
                                                        (AST_VAR)
                                                        (AST_VAR))
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)))
                                                (
                                                    (AST_ASSIGN
                                                        (AST_VAR)
                                                        (AST_VAR))
                                                    (AST_ASSIGN
                                                        (AST_VAR)
                                                        (AST_ARRAY
                                                            (AST_ARRAY_ELEM
                                                                (AST_CONST)
                                                                (SCALAR))
                                                            (AST_ARRAY_ELEM
                                                                (AST_METHOD_CALL
                                                                    (AST_VAR))
                                                                (SCALAR))
                                                            (AST_ARRAY_ELEM
                                                                (AST_METHOD_CALL
                                                                    (AST_VAR))
                                                                (SCALAR))
                                                            (AST_ARRAY_ELEM
                                                                (AST_METHOD_CALL
                                                                    (AST_VAR))
                                                                (SCALAR))
                                                            (AST_ARRAY_ELEM
                                                                (AST_METHOD_CALL
                                                                    (AST_VAR))
                                                                (SCALAR))))
                                                    (AST_ASSIGN
                                                        (AST_VAR)
                                                        (AST_METHOD_CALL
                                                            (AST_VAR)
                                                            (
                                                                (AST_VAR)
                                                                (AST_VAR)
                                                                (AST_VAR))))))))))
                            (AST_IF
                                (AST_IF_ELEM
                                    (AST_BINARY_OP
                                        (AST_METHOD_CALL
                                            (AST_PROP
                                                (AST_VAR)))
                                        (SCALAR))
                                    (
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_BINARY_OP
                                                    (AST_VAR)
                                                    (AST_VAR))
                                                (
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (AST_CALL
                                                                (
                                                                    (AST_VAR)))))
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (AST_CALL
                                                                (
                                                                    (AST_CALL
                                                                        (
                                                                            (AST_VAR)
                                                                            (SCALAR)))))))
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (AST_CALL
                                                                (
                                                                    (AST_CALL
                                                                        (
                                                                            (AST_VAR)
                                                                            (SCALAR))))))))))
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_BINARY_OP
                                                    (AST_UNARY_OP
                                                        (AST_VAR))
                                                    (AST_VAR))
                                                (
                                                    (AST_ASSIGN
                                                        (AST_VAR)
                                                        (AST_NEW
                                                            (
                                                                (AST_VAR)
                                                                (AST_PROP
                                                                    (AST_VAR))
                                                                (AST_VAR)
                                                                (AST_VAR)
                                                                (AST_VAR))))
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (SCALAR)
                                                            (AST_VAR))))))
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_VAR)
                                                (
                                                    (AST_ASSIGN
                                                        (AST_VAR)
                                                        (AST_CALL
                                                            (
                                                                (SCALAR))))
                                                    (AST_ASSIGN
                                                        (AST_VAR)
                                                        (AST_CALL
                                                            (
                                                                (SCALAR)
                                                                (SCALAR))))
                                                    (AST_IF
                                                        (AST_IF_ELEM
                                                            (AST_VAR)
                                                            (
                                                                (AST_ASSIGN
                                                                    (AST_VAR)
                                                                    (AST_METHOD_CALL
                                                                        (AST_VAR)
                                                                        (
                                                                            (AST_CALL
                                                                                (
                                                                                    (AST_CALL
                                                                                        (
                                                                                            (AST_VAR)
                                                                                            (SCALAR))))))))
                                                                (AST_METHOD_CALL
                                                                    (AST_VAR)
                                                                    (
                                                                        (AST_VAR))))))
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (AST_VAR)
                                                            (AST_VAR)))
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (AST_CALL
                                                                (
                                                                    (AST_VAR)
                                                                    (SCALAR)))))
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (AST_CALL
                                                                (
                                                                    (AST_VAR)
                                                                    (SCALAR)))))))))))
                            (AST_METHOD_CALL
                                (AST_VAR)
                                (
                                    (AST_CALL
                                        (
                                            (SCALAR)))))))))))
    (AST_METHOD_CALL
        (AST_VAR)))