  public function testFilnameCanBeReadFromFileStream()
  {
    $file = new Swift_MockFileStream();
    $file->setReturnValue('getPath', '/path/to/some-image.jpg');
    $file->setReturnValueAt(0, 'read', '<image data>');
    $file->setReturnValueAt(1, 'read', false);

    $entity = $this->_createAttachment(array(), $this->_encoder, $this->_cache);
    $entity->setFile($file);
    $this->assertEqual('some-image.jpg', $entity->getFilename());
    $this->assertEqual('<image data>', $entity->getBodyAsString());
  }

||||||||  public function testFilnameCanBeReadFromFileStream()
  {
    $context = new Mockery();
    $file = $context->mock('Swift_FileStream');
    $context->checking(Expectations::create()
      -> atLeast(1)->of($file)->getPath() -> returns('/path/to/some-image.jpg')
      -> one($file)->read(optional()) -> returns('<image data>')
      -> one($file)->read(optional()) -> returns(false)
      -> ignoring($file)
      );

    $entity = $this->_createAttachment(
      array(), $this->_getEncoder($context), $this->_getCache($context)
      );
    $entity->setFile($file);
    $this->assertEqual('some-image.jpg', $entity->getFilename());
    $this->assertEqual('<image data>', $entity->getBodyAsString());

    $context->assertIsSatisfied();
  }

||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_NEW))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)
            (SCALAR)
            (SCALAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)
            (SCALAR)
            (AST_CONST)))
    (AST_ASSIGN
        (AST_VAR)
        (AST_METHOD_CALL
            (AST_VAR)
            (
                (AST_ARRAY)
                (AST_PROP
                    (AST_VAR))
                (AST_PROP
                    (AST_VAR)))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)
            (AST_METHOD_CALL
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)
            (AST_METHOD_CALL
                (AST_VAR)))))||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_NEW))
    (AST_ASSIGN
        (AST_VAR)
        (AST_METHOD_CALL
            (AST_VAR)
            (
                (SCALAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_METHOD_CALL
                (AST_METHOD_CALL
                    (AST_METHOD_CALL
                        (AST_METHOD_CALL
                            (AST_METHOD_CALL
                                (AST_METHOD_CALL
                                    (AST_METHOD_CALL
                                        (AST_METHOD_CALL
                                            (AST_METHOD_CALL
                                                (AST_METHOD_CALL
                                                    (AST_METHOD_CALL
                                                        (AST_STATIC_CALL)
                                                        (
                                                            (SCALAR)))
                                                    (
                                                        (AST_VAR))))
                                            (
                                                (SCALAR)))
                                        (
                                            (AST_VAR)))
                                    (
                                        (AST_CALL)))
                                (
                                    (SCALAR)))
                            (
                                (AST_VAR)))
                        (
                            (AST_CALL)))
                    (
                        (AST_CONST)))
                (
                    (AST_VAR)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_METHOD_CALL
            (AST_VAR)
            (
                (AST_ARRAY)
                (AST_METHOD_CALL
                    (AST_VAR)
                    (
                        (AST_VAR)))
                (AST_METHOD_CALL
                    (AST_VAR)
                    (
                        (AST_VAR))))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)
            (AST_METHOD_CALL
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR)
            (AST_METHOD_CALL
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)))