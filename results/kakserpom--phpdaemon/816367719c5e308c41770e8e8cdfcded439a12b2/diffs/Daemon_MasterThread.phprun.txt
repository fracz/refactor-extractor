	public function run() {

		Daemon::$process = $this;

		$this->prepareSystemEnv();
		class_exists('Timer'); // ensure loading this class
		gc_enable();

		$this->eventBase = event_base_new();
		$this->registerEventSignals();

		$this->workers = new ThreadCollection;
		$this->collections['workers'] = $this->workers;
		$this->ipcthreads = new ThreadCollection;
		$this->collections['ipcthreads'] = $this->ipcthreads;

		Daemon::$appResolver = require Daemon::$appResolverPath;
		Daemon::$appResolver->preload(true);

		$this->callbacks = new StackCallbacks;
		$this->spawnIPCThread();
		$this->spawnWorkers(min(
			Daemon::$config->startworkers->value,
			Daemon::$config->maxworkers->value
		));
		if (0) Timer::add(function($event) use (&$cbs) {
			$self = Daemon::$process;

			static $c = 0;

			++$c;

			if ($c > 0xFFFFF) {
				$c = 1;
			}

			if (($c % 10 == 0)) {
				$self->workers->removeTerminated(true);
				$self->ipcthreads->removeTerminated(true);
				gc_collect_cycles();
			} else {
				$self->workers->removeTerminated();
				$self->ipcthreads->removeTerminated();
			}

			if (
				isset(Daemon::$config->mpm->value)
				&& is_callable(Daemon::$config->mpm->value)
			) {
				call_user_func(Daemon::$config->mpm->value);
			} else {
				// default MPM
				$state = Daemon::getStateOfWorkers($self);

				if ($state) {
					$n = max(
						min(
							Daemon::$config->minspareworkers->value - $state['idle'],
							Daemon::$config->maxworkers->value - $state['alive']
						),
						Daemon::$config->minworkers->value - $state['alive']
					);

					if ($n > 0) {
						Daemon::log('Spawning ' . $n . ' worker(s).');
						$self->spawnWorkers($n);
						event_base_loopbreak($self->eventBase);
					}

					$n = min(
						$state['idle'] - Daemon::$config->maxspareworkers->value,
						$state['alive'] - Daemon::$config->minworkers->value
					);

					if ($n > 0) {
						Daemon::log('Stopping ' . $n . ' worker(s).');
						$self->stopWorkers($n);
					}
				}
			}


			$event->timeout();
		}, 1e6 * Daemon::$config->mpmdelay->value, 'MPM');

		while (!$this->breakMainLoop) {
			$this->callbacks->executeAll($this);
			event_base_loop($this->eventBase);
		}
	}

	/**
	 * Log something
	 * @param string - Message.
	 * @return void
	 */
||||||||	public function run() {

		Daemon::$process = $this;

		$this->prepareSystemEnv();
		class_exists('Timer'); // ensure loading this class
		gc_enable();

		$this->eventBase = event_base_new();
		$this->registerEventSignals();

		$this->workers = new ThreadCollection;
		$this->collections['workers'] = $this->workers;
		$this->ipcthreads = new ThreadCollection;
		$this->collections['ipcthreads'] = $this->ipcthreads;

		Daemon::$appResolver = require Daemon::$appResolverPath;
		Daemon::$appResolver->preload(true);

		$this->callbacks = new StackCallbacks;
		$this->spawnIPCThread();
		$this->spawnWorkers(min(
			Daemon::$config->startworkers->value,
			Daemon::$config->maxworkers->value
		));
		Timer::add(function($event) use (&$cbs) {
			$self = Daemon::$process;

			static $c = 0;

			++$c;

			if ($c > 0xFFFFF) {
				$c = 1;
			}

			if (($c % 10 == 0)) {
				$self->workers->removeTerminated(true);
				$self->ipcthreads->removeTerminated(true);
				gc_collect_cycles();
			} else {
				$self->workers->removeTerminated();
				$self->ipcthreads->removeTerminated();
			}

			if (
				isset(Daemon::$config->mpm->value)
				&& is_callable(Daemon::$config->mpm->value)
			) {
				call_user_func(Daemon::$config->mpm->value);
			} else {
				// default MPM
				$state = Daemon::getStateOfWorkers($self);

				if ($state) {
					$n = max(
						min(
							Daemon::$config->minspareworkers->value - $state['idle'],
							Daemon::$config->maxworkers->value - $state['alive']
						),
						Daemon::$config->minworkers->value - $state['alive']
					);

					if ($n > 0) {
						Daemon::log('Spawning ' . $n . ' worker(s).');
						$self->spawnWorkers($n);
						event_base_loopbreak($self->eventBase);
					}

					$n = min(
						$state['idle'] - Daemon::$config->maxspareworkers->value,
						$state['alive'] - Daemon::$config->minworkers->value
					);

					if ($n > 0) {
						Daemon::log('Stopping ' . $n . ' worker(s).');
						$self->stopWorkers($n);
					}
				}
			}


			$event->timeout();
		}, 1e6 * Daemon::$config->mpmdelay->value, 'MPM');

		while (!$this->breakMainLoop) {
			$this->callbacks->executeAll($this);
			event_base_loop($this->eventBase);
		}
	}

	/**
	 * Log something
	 * @param string - Message.
	 * @return void
	 */
||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_ASSIGN
        (AST_STATIC_PROP)
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_CALL
        (
            (SCALAR)))
    (AST_CALL)
    (AST_ASSIGN
        (AST_PROP
            (AST_VAR))
        (AST_CALL))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_ASSIGN
        (AST_PROP
            (AST_VAR))
        (AST_NEW))
    (AST_ASSIGN
        (AST_DIM
            (AST_PROP
                (AST_VAR))
            (SCALAR))
        (AST_PROP
            (AST_VAR)))
    (AST_ASSIGN
        (AST_PROP
            (AST_VAR))
        (AST_NEW))
    (AST_ASSIGN
        (AST_DIM
            (AST_PROP
                (AST_VAR))
            (SCALAR))
        (AST_PROP
            (AST_VAR)))
    (AST_ASSIGN
        (AST_STATIC_PROP)
        (AST_INCLUDE_OR_EVAL
            (AST_STATIC_PROP)))
    (AST_METHOD_CALL
        (AST_STATIC_PROP)
        (
            (AST_CONST)))
    (AST_ASSIGN
        (AST_PROP
            (AST_VAR))
        (AST_NEW))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_CALL
                (
                    (AST_PROP
                        (AST_PROP
                            (AST_STATIC_PROP)))
                    (AST_PROP
                        (AST_PROP
                            (AST_STATIC_PROP)))))))
    (AST_IF
        (AST_IF_ELEM
            (SCALAR)
            (
                (AST_STATIC_CALL
                    (
                        (AST_CLOSURE
                            (NO_PARAM_TYPENO_PARAM_DEFAULT)
                            (AST_CLOSURE_USES
                                (AST_CLOSURE_VAR))
                            (
                                (AST_ASSIGN
                                    (AST_VAR)
                                    (AST_STATIC_PROP))
                                (AST_STATIC
                                    (AST_VAR)
                                    (SCALAR))
                                (AST_PRE_INC
                                    (AST_VAR))
                                (AST_IF
                                    (AST_IF_ELEM
                                        (AST_BINARY_OP
                                            (AST_VAR)
                                            (SCALAR))
                                        (
                                            (AST_ASSIGN
                                                (AST_VAR)
                                                (SCALAR)))))
                                (AST_IF
                                    (AST_IF_ELEM
                                        (AST_BINARY_OP
                                            (AST_BINARY_OP
                                                (AST_VAR)
                                                (SCALAR))
                                            (SCALAR))
                                        (
                                            (AST_METHOD_CALL
                                                (AST_PROP
                                                    (AST_VAR))
                                                (
                                                    (AST_CONST)))
                                            (AST_METHOD_CALL
                                                (AST_PROP
                                                    (AST_VAR))
                                                (
                                                    (AST_CONST)))
                                            (AST_CALL)))
                                    (AST_IF_ELEM
                                        (NULL)
                                        (
                                            (AST_METHOD_CALL
                                                (AST_PROP
                                                    (AST_VAR)))
                                            (AST_METHOD_CALL
                                                (AST_PROP
                                                    (AST_VAR))))))
                                (AST_IF
                                    (AST_IF_ELEM
                                        (AST_BINARY_OP
                                            (AST_ISSET
                                                (AST_PROP
                                                    (AST_PROP
                                                        (AST_STATIC_PROP))))
                                            (AST_CALL
                                                (
                                                    (AST_PROP
                                                        (AST_PROP
                                                            (AST_STATIC_PROP))))))
                                        (
                                            (AST_CALL
                                                (
                                                    (AST_PROP
                                                        (AST_PROP
                                                            (AST_STATIC_PROP)))))))
                                    (AST_IF_ELEM
                                        (NULL)
                                        (
                                            (AST_ASSIGN
                                                (AST_VAR)
                                                (AST_STATIC_CALL
                                                    (
                                                        (AST_VAR))))
                                            (AST_IF
                                                (AST_IF_ELEM
                                                    (AST_VAR)
                                                    (
                                                        (AST_ASSIGN
                                                            (AST_VAR)
                                                            (AST_CALL
                                                                (
                                                                    (AST_CALL
                                                                        (
                                                                            (AST_BINARY_OP
                                                                                (AST_PROP
                                                                                    (AST_PROP
                                                                                        (AST_STATIC_PROP)))
                                                                                (AST_DIM
                                                                                    (AST_VAR)
                                                                                    (SCALAR)))
                                                                            (AST_BINARY_OP
                                                                                (AST_PROP
                                                                                    (AST_PROP
                                                                                        (AST_STATIC_PROP)))
                                                                                (AST_DIM
                                                                                    (AST_VAR)
                                                                                    (SCALAR)))))
                                                                    (AST_BINARY_OP
                                                                        (AST_PROP
                                                                            (AST_PROP
                                                                                (AST_STATIC_PROP)))
                                                                        (AST_DIM
                                                                            (AST_VAR)
                                                                            (SCALAR))))))
                                                        (AST_IF
                                                            (AST_IF_ELEM
                                                                (AST_BINARY_OP
                                                                    (AST_VAR)
                                                                    (SCALAR))
                                                                (
                                                                    (AST_STATIC_CALL
                                                                        (
                                                                            (AST_BINARY_OP
                                                                                (AST_BINARY_OP
                                                                                    (SCALAR)
                                                                                    (AST_VAR))
                                                                                (SCALAR))))
                                                                    (AST_METHOD_CALL
                                                                        (AST_VAR)
                                                                        (
                                                                            (AST_VAR)))
                                                                    (AST_CALL
                                                                        (
                                                                            (AST_PROP
                                                                                (AST_VAR)))))))
                                                        (AST_ASSIGN
                                                            (AST_VAR)
                                                            (AST_CALL
                                                                (
                                                                    (AST_BINARY_OP
                                                                        (AST_DIM
                                                                            (AST_VAR)
                                                                            (SCALAR))
                                                                        (AST_PROP
                                                                            (AST_PROP
                                                                                (AST_STATIC_PROP))))
                                                                    (AST_BINARY_OP
                                                                        (AST_DIM
                                                                            (AST_VAR)
                                                                            (SCALAR))
                                                                        (AST_PROP
                                                                            (AST_PROP
                                                                                (AST_STATIC_PROP)))))))
                                                        (AST_IF
                                                            (AST_IF_ELEM
                                                                (AST_BINARY_OP
                                                                    (AST_VAR)
                                                                    (SCALAR))
                                                                (
                                                                    (AST_STATIC_CALL
                                                                        (
                                                                            (AST_BINARY_OP
                                                                                (AST_BINARY_OP
                                                                                    (SCALAR)
                                                                                    (AST_VAR))
                                                                                (SCALAR))))
                                                                    (AST_METHOD_CALL
                                                                        (AST_VAR)
                                                                        (
                                                                            (AST_VAR))))))))))))
                                (AST_METHOD_CALL
                                    (AST_VAR))))
                        (AST_BINARY_OP
                            (SCALAR)
                            (AST_PROP
                                (AST_PROP
                                    (AST_STATIC_PROP))))
                        (SCALAR))))))
    (AST_WHILE
        (AST_UNARY_OP
            (AST_PROP
                (AST_VAR)))
        (
            (AST_METHOD_CALL
                (AST_PROP
                    (AST_VAR))
                (
                    (AST_VAR)))
            (AST_CALL
                (
                    (AST_PROP
                        (AST_VAR)))))))||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_ASSIGN
        (AST_STATIC_PROP)
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_CALL
        (
            (SCALAR)))
    (AST_CALL)
    (AST_ASSIGN
        (AST_PROP
            (AST_VAR))
        (AST_CALL))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_ASSIGN
        (AST_PROP
            (AST_VAR))
        (AST_NEW))
    (AST_ASSIGN
        (AST_DIM
            (AST_PROP
                (AST_VAR))
            (SCALAR))
        (AST_PROP
            (AST_VAR)))
    (AST_ASSIGN
        (AST_PROP
            (AST_VAR))
        (AST_NEW))
    (AST_ASSIGN
        (AST_DIM
            (AST_PROP
                (AST_VAR))
            (SCALAR))
        (AST_PROP
            (AST_VAR)))
    (AST_ASSIGN
        (AST_STATIC_PROP)
        (AST_INCLUDE_OR_EVAL
            (AST_STATIC_PROP)))
    (AST_METHOD_CALL
        (AST_STATIC_PROP)
        (
            (AST_CONST)))
    (AST_ASSIGN
        (AST_PROP
            (AST_VAR))
        (AST_NEW))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_CALL
                (
                    (AST_PROP
                        (AST_PROP
                            (AST_STATIC_PROP)))
                    (AST_PROP
                        (AST_PROP
                            (AST_STATIC_PROP)))))))
    (AST_STATIC_CALL
        (
            (AST_CLOSURE
                (NO_PARAM_TYPENO_PARAM_DEFAULT)
                (AST_CLOSURE_USES
                    (AST_CLOSURE_VAR))
                (
                    (AST_ASSIGN
                        (AST_VAR)
                        (AST_STATIC_PROP))
                    (AST_STATIC
                        (AST_VAR)
                        (SCALAR))
                    (AST_PRE_INC
                        (AST_VAR))
                    (AST_IF
                        (AST_IF_ELEM
                            (AST_BINARY_OP
                                (AST_VAR)
                                (SCALAR))
                            (
                                (AST_ASSIGN
                                    (AST_VAR)
                                    (SCALAR)))))
                    (AST_IF
                        (AST_IF_ELEM
                            (AST_BINARY_OP
                                (AST_BINARY_OP
                                    (AST_VAR)
                                    (SCALAR))
                                (SCALAR))
                            (
                                (AST_METHOD_CALL
                                    (AST_PROP
                                        (AST_VAR))
                                    (
                                        (AST_CONST)))
                                (AST_METHOD_CALL
                                    (AST_PROP
                                        (AST_VAR))
                                    (
                                        (AST_CONST)))
                                (AST_CALL)))
                        (AST_IF_ELEM
                            (NULL)
                            (
                                (AST_METHOD_CALL
                                    (AST_PROP
                                        (AST_VAR)))
                                (AST_METHOD_CALL
                                    (AST_PROP
                                        (AST_VAR))))))
                    (AST_IF
                        (AST_IF_ELEM
                            (AST_BINARY_OP
                                (AST_ISSET
                                    (AST_PROP
                                        (AST_PROP
                                            (AST_STATIC_PROP))))
                                (AST_CALL
                                    (
                                        (AST_PROP
                                            (AST_PROP
                                                (AST_STATIC_PROP))))))
                            (
                                (AST_CALL
                                    (
                                        (AST_PROP
                                            (AST_PROP
                                                (AST_STATIC_PROP)))))))
                        (AST_IF_ELEM
                            (NULL)
                            (
                                (AST_ASSIGN
                                    (AST_VAR)
                                    (AST_STATIC_CALL
                                        (
                                            (AST_VAR))))
                                (AST_IF
                                    (AST_IF_ELEM
                                        (AST_VAR)
                                        (
                                            (AST_ASSIGN
                                                (AST_VAR)
                                                (AST_CALL
                                                    (
                                                        (AST_CALL
                                                            (
                                                                (AST_BINARY_OP
                                                                    (AST_PROP
                                                                        (AST_PROP
                                                                            (AST_STATIC_PROP)))
                                                                    (AST_DIM
                                                                        (AST_VAR)
                                                                        (SCALAR)))
                                                                (AST_BINARY_OP
                                                                    (AST_PROP
                                                                        (AST_PROP
                                                                            (AST_STATIC_PROP)))
                                                                    (AST_DIM
                                                                        (AST_VAR)
                                                                        (SCALAR)))))
                                                        (AST_BINARY_OP
                                                            (AST_PROP
                                                                (AST_PROP
                                                                    (AST_STATIC_PROP)))
                                                            (AST_DIM
                                                                (AST_VAR)
                                                                (SCALAR))))))
                                            (AST_IF
                                                (AST_IF_ELEM
                                                    (AST_BINARY_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (
                                                        (AST_STATIC_CALL
                                                            (
                                                                (AST_BINARY_OP
                                                                    (AST_BINARY_OP
                                                                        (SCALAR)
                                                                        (AST_VAR))
                                                                    (SCALAR))))
                                                        (AST_METHOD_CALL
                                                            (AST_VAR)
                                                            (
                                                                (AST_VAR)))
                                                        (AST_CALL
                                                            (
                                                                (AST_PROP
                                                                    (AST_VAR)))))))
                                            (AST_ASSIGN
                                                (AST_VAR)
                                                (AST_CALL
                                                    (
                                                        (AST_BINARY_OP
                                                            (AST_DIM
                                                                (AST_VAR)
                                                                (SCALAR))
                                                            (AST_PROP
                                                                (AST_PROP
                                                                    (AST_STATIC_PROP))))
                                                        (AST_BINARY_OP
                                                            (AST_DIM
                                                                (AST_VAR)
                                                                (SCALAR))
                                                            (AST_PROP
                                                                (AST_PROP
                                                                    (AST_STATIC_PROP)))))))
                                            (AST_IF
                                                (AST_IF_ELEM
                                                    (AST_BINARY_OP
                                                        (AST_VAR)
                                                        (SCALAR))
                                                    (
                                                        (AST_STATIC_CALL
                                                            (
                                                                (AST_BINARY_OP
                                                                    (AST_BINARY_OP
                                                                        (SCALAR)
                                                                        (AST_VAR))
                                                                    (SCALAR))))
                                                        (AST_METHOD_CALL
                                                            (AST_VAR)
                                                            (
                                                                (AST_VAR))))))))))))
                    (AST_METHOD_CALL
                        (AST_VAR))))
            (AST_BINARY_OP
                (SCALAR)
                (AST_PROP
                    (AST_PROP
                        (AST_STATIC_PROP))))
            (SCALAR)))
    (AST_WHILE
        (AST_UNARY_OP
            (AST_PROP
                (AST_VAR)))
        (
            (AST_METHOD_CALL
                (AST_PROP
                    (AST_VAR))
                (
                    (AST_VAR)))
            (AST_CALL
                (
                    (AST_PROP
                        (AST_VAR)))))))