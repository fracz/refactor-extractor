||||||||    public function test_purgeInvalidatedArchivesFrom_PurgesCorrectInvalidatedArchives_AndMarksDatesAndSitesAsInvalidated()
    {
        $this->setUpInvalidatedReportsDistributedList($dates = array($this->february), $sites = array(1, 2, 3));

        $this->archivePurger->purgeInvalidatedArchivesFrom("2015_01", array(1,2));

        // check invalidated archives for idsite = 1, idsite = 2 are purged
        $expectedPurgedArchives = array(11, 13, 14);
        $this->assertArchivesDoNotExist($expectedPurgedArchives, $this->february);

        $expectedPresentArchives = array(12);
        $this->assertArchivesExist($expectedPresentArchives, $this->february);

        $this->assertJanuaryInvalidatedArchivesNotPurged();

        // assert invalidated reports distributed list has changed
        $invalidatedReports = new InvalidatedReports();
        $sitesByYearMonth = $invalidatedReports->getSitesByYearMonthArchiveToPurge();

        $this->assertEquals(array(
            '2015_02' => array(3)
        ), $sitesByYearMonth);
    }

||||||||||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ASSIGN
                (AST_VAR)
                (AST_ARRAY
                    (AST_ARRAY_ELEM
                        (AST_PROP
                            (AST_VAR))
                        (NULL))))
            (AST_ASSIGN
                (AST_VAR)
                (AST_ARRAY
                    (AST_ARRAY_ELEM
                        (SCALAR)
                        (NULL))
                    (AST_ARRAY_ELEM
                        (SCALAR)
                        (NULL))
                    (AST_ARRAY_ELEM
                        (SCALAR)
                        (NULL))))))
    (AST_METHOD_CALL
        (AST_PROP
            (AST_VAR))
        (
            (SCALAR)
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL))
                (AST_ARRAY_ELEM
                    (SCALAR)
                    (NULL)))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_ARRAY
            (AST_ARRAY_ELEM
                (SCALAR)
                (NULL))
            (AST_ARRAY_ELEM
                (SCALAR)
                (NULL))
            (AST_ARRAY_ELEM
                (SCALAR)
                (NULL))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_PROP
                (AST_VAR))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_ARRAY
            (AST_ARRAY_ELEM
                (SCALAR)
                (NULL))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_VAR)
            (AST_PROP
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR))
    (AST_ASSIGN
        (AST_VAR)
        (AST_NEW))
    (AST_ASSIGN
        (AST_VAR)
        (AST_METHOD_CALL
            (AST_VAR)))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (AST_ARRAY
                (AST_ARRAY_ELEM
                    (AST_ARRAY
                        (AST_ARRAY_ELEM
                            (SCALAR)
                            (NULL)))
                    (SCALAR)))
            (AST_VAR))))