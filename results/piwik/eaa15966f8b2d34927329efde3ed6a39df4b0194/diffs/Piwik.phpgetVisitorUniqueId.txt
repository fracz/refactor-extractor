||||||||	private function getVisitorUniqueId()
	{
		if($this->isVisitorKnown())
		{
			return -1;
		}
		else
		{
			return Piwik_Common::generateUniqId();
		}
	}

}

printDebug($_GET);

class Piwik_LogStats
{
	private $stateValid;

	private $urlToRedirect;

	private $db = null;

	const NOTHING_TO_NOTICE = 1;
	const TO_REDIRECT_URL = 2;
	const LOGGING_DISABLE = 10;
	const NO_GET_VARIABLE = 11;

	public function __construct()
	{
		$this->stateValid = self::NOTHING_TO_NOTICE;
	}

	// create the database object
	function connectDatabase()
	{
		$configDb = Piwik_LogStats_Config::getInstance()->database;
		$this->db = new Piwik_LogStats_Db( 	$configDb['host'],
										$configDb['username'],
										$configDb['password'],
										$configDb['dbname']
							);
		$this->db->connect();
	}

	private function initProcess()
	{
		$saveStats = Piwik_LogStats_Config::getInstance()->LogStats['record_statistics'];

		if($saveStats == 0)
		{
			$this->setState(self::LOGGING_DISABLE);
		}

		if( count($_GET) == 0)
		{
			$this->setState(self::NO_GET_VARIABLE);
		}

		$downloadVariableName = Piwik_LogStats_Config::getInstance()->LogStats['download_url_var_name'];
		$urlDownload = Piwik_Common::getRequestVar( $downloadVariableName, '', 'string');

		if( !empty($urlDownload) )
		{
			$this->setState( self::TO_REDIRECT_URL );
			$this->setUrlToRedirect ( $urlDownload);
		}

		$outlinkVariableName = Piwik_LogStats_Config::getInstance()->LogStats['outlink_url_var_name'];
		$urlOutlink = Piwik_Common::getRequestVar( $outlinkVariableName, '', 'string');

		if( !empty($urlOutlink) )
		{
			$this->setState( self::TO_REDIRECT_URL );
			$this->setUrlToRedirect ( $urlOutlink);
		}
	}

	private function processVisit()
	{
		return $this->stateValid !== self::LOGGING_DISABLE
				&&  $this->stateValid !== self::NO_GET_VARIABLE;
	}
	private function getState()
	{
		return $this->stateValid;
	}

	private function setUrlToRedirect( $url )
	{
		$this->urlToRedirect = $url;
	}
	private function getUrlToRedirect()
	{
		return $this->urlToRedirect;
	}
	private function setState( $value )
	{
		$this->stateValid = $value;
	}

	// main algorithm
	// => input : variables filtered
	// => action : read cookie, read database, database logging, cookie writing
	function main()
	{
		$this->initProcess();

		if( $this->processVisit() )
		{
			$this->connectDatabase();
			$visit = new Piwik_LogStats_Visit( $this->db );
			$visit->handle();
		}
		$this->endProcess();
	}

	// display the logo or pixel 1*1 GIF
	// or a marketing page if no parameters in the url
	// or redirect to a url (transmit the cookie as well)
	// or load a URL (rss feed) (transmit the cookie as well)
	private function endProcess()
	{
		switch($this->getState())
		{
			case self::LOGGING_DISABLE:
				printDebug("Logging disabled, display transparent logo");
			break;

			case self::NO_GET_VARIABLE:
				printDebug("No get variables => piwik page");
			break;


			case self::TO_REDIRECT_URL:
				header('Location: ' . $this->getUrlToRedirect());
			break;


			case self::NOTHING_TO_NOTICE:
			default:
				printDebug("Nothing to notice => default behaviour");
			break;
		}
		printDebug("End of the page.");
		exit;
	}
}

$process = new Piwik_LogStats;
$process->main();

// yet to do
// known visitor test 1h
// known visitor update 1h
// referer analysis 3h
// unit testing the module 7h
ob_end_flush();
?>||||||||||||||||NO_DOC_COMMENTNO_RETURN_TYPE
(
    (AST_IF
        (AST_IF_ELEM
            (AST_METHOD_CALL
                (AST_VAR))
            (
                (AST_RETURN
                    (AST_UNARY_OP
                        (SCALAR)))))
        (AST_IF_ELEM
            (NULL)
            (
                (AST_RETURN
                    (AST_STATIC_CALL))))))