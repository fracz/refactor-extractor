||||||||    public function callWidgetsCompareOutput(
        $testName, $actions, $requestParameters, $userTypes = null, $testingLevelOverride = null)
    {
        // deal with the testing level
        if (self::$widgetTestingLevel == self::NO_WIDGET_TESTING)
        {
            return;
        }

        if (is_null($testingLevelOverride))
        {
            $testingLevelOverride = self::$widgetTestingLevel;
        }

        // process $userTypes argument
        if (!$userTypes)
        {
            $userTypes = array('anonymous', 'view', 'admin', 'superuser');
        }
        else if (!is_array($userTypes))
        {
            $userTypes = array($userTypes);
        }

        $oldGet = $_GET;

        // get all testable controller actions if necessary
        $actionParams = array();
        if ($actions == 'all')
        {
            // Goals.addWidgets requires idSite to be set
            $_GET['idSite'] = isset($requestParameters['idSite']) ? $requestParameters['idSite'] : '0';

            list($actions, $actionParams) = $this->findAllWidgets();

            $_GET = $oldGet;
        }
        else if (!is_array($actions))
        {
            $actions = array($actions);
        }

        // run the tests
        foreach ($actions as $controllerAction)
        {
            $customParams = isset($actionParams[$controllerAction]) ? $actionParams[$controllerAction] : array();
            list($controllerName, $actionName) = explode('.', $controllerAction);

            foreach ($userTypes as $userType)
            {
                $this->setUserType($userType);

                try
                {
                    // set request parameters
                    $_GET = array();
                    foreach ($customParams as $key => $value)
                    {
                        $_GET[$key] = $value;
                    }
                    foreach ($requestParameters as $key => $value)
                    {
                        $_GET[$key] = $value;
                    }

                    $_GET['module'] = $controllerName;
                    $_GET['action'] = $actionName;

                    if ($testingLevelOverride == self::CHECK_WIDGET_ERRORS)
                    {
                        $this->errorsOccurredInTest = array();
                        set_error_handler(array($this, "customErrorHandler"));
                    }

                    // call controller action
                    $response = Piwik_FrontController::getInstance()->fetchDispatch();

                    list($processedFilePath, $expectedFilePath) = $this->getProcessedAndExpectedPaths(
                        $testName . '_' . $userType, $controllerAction, 'html');

                    if ($testingLevelOverride == self::CHECK_WIDGET_ERRORS)
                    {
                        restore_error_handler();

                        if (!empty($this->errorsOccurredInTest))
                        {
                            // write processed (only if there are errors)
                            file_put_contents($processedFilePath, $response);

                            $this->fail("PHP Errors occurred in calling controller action '$controllerAction':");
                            foreach ($this->errorsOccurredInTest as $error)
                            {
                                echo "&nbsp;   $error<br/>\n";
                            }
                        }
                    }
                    else // check against expected
                    {
                        // write raw processed response
                        file_put_contents($processedFilePath, $response);

                        // load expected
                        $expected = $this->loadExpectedFile($expectedFilePath);
                        if (!$expected)
                        {
                            continue;
                        }

                        // normalize eol delimeters
                        $expected = str_replace("\r\n", "\n", $expected);
                        $response = str_replace("\r\n", "\n", $response);

                        // check against expected
                        $passed = $this->assertEquals(trim($expected), trim($response),
                            "<br/>\nDifferences with expected in: $processedFilePath %s ");

                        if (!$passed)
                        {
                            var_dump('ERROR FOR ' . $controllerAction . ' -- FETCHED RESPONSE, then EXPECTED RESPONSE - ');
                            echo "<br/>\n";
                            var_dump(htmlspecialchars($response));
                            echo "<br/>\n";
                            var_dump(htmlspecialchars($expected));
                            echo "<br/>\n";
                        }
                    }
                }
                catch (Exception $e)
                {
                    $this->fail("EXCEPTION THROWN IN $controllerAction: ".$e->getTraceAsString());
                }
            }
        }

        // reset $_GET to old values
        $_GET = array();
        foreach ($oldGet as $key => $value)
        {
            $_GET[$key] = $value;
        }

        // set user type
        $this->setUserType('superuser');
    }

    /**
     * Sets the access privilegs of the current user to the specified user type.
     *
     * @param $userType string Can be 'superuser', 'admin', 'view' or 'anonymous'.
     */
||||||||||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(NO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPEPARAM_DEFAULTNO_PARAM_TYPEPARAM_DEFAULT)
(
    (AST_IF
        (AST_IF_ELEM
            (AST_BINARY_OP
                (AST_STATIC_PROP)
                (AST_CLASS_CONST
                    (SCALAR)))
            (
                (AST_RETURN
                    (NULL)))))
    (AST_IF
        (AST_IF_ELEM
            (AST_CALL
                (
                    (AST_VAR)))
            (
                (AST_ASSIGN
                    (AST_VAR)
                    (AST_STATIC_PROP)))))
    (AST_IF
        (AST_IF_ELEM
            (AST_UNARY_OP
                (AST_VAR))
            (
                (AST_ASSIGN
                    (AST_VAR)
                    (AST_ARRAY
                        (AST_ARRAY_ELEM
                            (SCALAR)
                            (NULL))
                        (AST_ARRAY_ELEM
                            (SCALAR)
                            (NULL))
                        (AST_ARRAY_ELEM
                            (SCALAR)
                            (NULL))
                        (AST_ARRAY_ELEM
                            (SCALAR)
                            (NULL))))))
        (AST_IF_ELEM
            (NULL)
            (
                (AST_IF
                    (AST_IF_ELEM
                        (AST_UNARY_OP
                            (AST_CALL
                                (
                                    (AST_VAR))))
                        (
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_ARRAY
                                    (AST_ARRAY_ELEM
                                        (AST_VAR)
                                        (NULL))))))))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_VAR))
    (AST_ASSIGN
        (AST_VAR)
        (AST_ARRAY))
    (AST_IF
        (AST_IF_ELEM
            (AST_BINARY_OP
                (AST_VAR)
                (SCALAR))
            (
                (AST_ASSIGN
                    (AST_DIM
                        (AST_VAR)
                        (SCALAR))
                    (AST_CONDITIONAL
                        (AST_ISSET
                            (AST_DIM
                                (AST_VAR)
                                (SCALAR)))
                        (AST_DIM
                            (AST_VAR)
                            (SCALAR))
                        (SCALAR)))
                (AST_ASSIGN
                    (AST_ARRAY
                        (AST_ARRAY_ELEM
                            (AST_VAR)
                            (NULL))
                        (AST_ARRAY_ELEM
                            (AST_VAR)
                            (NULL)))
                    (AST_METHOD_CALL
                        (AST_VAR)))
                (AST_ASSIGN
                    (AST_VAR)
                    (AST_VAR))))
        (AST_IF_ELEM
            (NULL)
            (
                (AST_IF
                    (AST_IF_ELEM
                        (AST_UNARY_OP
                            (AST_CALL
                                (
                                    (AST_VAR))))
                        (
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_ARRAY
                                    (AST_ARRAY_ELEM
                                        (AST_VAR)
                                        (NULL))))))))))
    (AST_FOREACH
        (AST_VAR)
        (AST_VAR)
        (NULL)
        (
            (AST_ASSIGN
                (AST_VAR)
                (AST_CONDITIONAL
                    (AST_ISSET
                        (AST_DIM
                            (AST_VAR)
                            (AST_VAR)))
                    (AST_DIM
                        (AST_VAR)
                        (AST_VAR))
                    (AST_ARRAY)))
            (AST_ASSIGN
                (AST_ARRAY
                    (AST_ARRAY_ELEM
                        (AST_VAR)
                        (NULL))
                    (AST_ARRAY_ELEM
                        (AST_VAR)
                        (NULL)))
                (AST_CALL
                    (
                        (SCALAR)
                        (AST_VAR))))
            (AST_FOREACH
                (AST_VAR)
                (AST_VAR)
                (NULL)
                (
                    (AST_METHOD_CALL
                        (AST_VAR)
                        (
                            (AST_VAR)))
                    (AST_TRY
                        (
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_ARRAY))
                            (AST_FOREACH
                                (AST_VAR)
                                (AST_VAR)
                                (AST_VAR)
                                (
                                    (AST_ASSIGN
                                        (AST_DIM
                                            (AST_VAR)
                                            (AST_VAR))
                                        (AST_VAR))))
                            (AST_FOREACH
                                (AST_VAR)
                                (AST_VAR)
                                (AST_VAR)
                                (
                                    (AST_ASSIGN
                                        (AST_DIM
                                            (AST_VAR)
                                            (AST_VAR))
                                        (AST_VAR))))
                            (AST_ASSIGN
                                (AST_DIM
                                    (AST_VAR)
                                    (SCALAR))
                                (AST_VAR))
                            (AST_ASSIGN
                                (AST_DIM
                                    (AST_VAR)
                                    (SCALAR))
                                (AST_VAR))
                            (AST_IF
                                (AST_IF_ELEM
                                    (AST_BINARY_OP
                                        (AST_VAR)
                                        (AST_CLASS_CONST
                                            (SCALAR)))
                                    (
                                        (AST_ASSIGN
                                            (AST_PROP
                                                (AST_VAR))
                                            (AST_ARRAY))
                                        (AST_CALL
                                            (
                                                (AST_ARRAY
                                                    (AST_ARRAY_ELEM
                                                        (AST_VAR)
                                                        (NULL))
                                                    (AST_ARRAY_ELEM
                                                        (SCALAR)
                                                        (NULL))))))))
                            (AST_ASSIGN
                                (AST_VAR)
                                (AST_METHOD_CALL
                                    (AST_STATIC_CALL)))
                            (AST_ASSIGN
                                (AST_ARRAY
                                    (AST_ARRAY_ELEM
                                        (AST_VAR)
                                        (NULL))
                                    (AST_ARRAY_ELEM
                                        (AST_VAR)
                                        (NULL)))
                                (AST_METHOD_CALL
                                    (AST_VAR)
                                    (
                                        (AST_BINARY_OP
                                            (AST_BINARY_OP
                                                (AST_VAR)
                                                (SCALAR))
                                            (AST_VAR))
                                        (AST_VAR)
                                        (SCALAR))))
                            (AST_IF
                                (AST_IF_ELEM
                                    (AST_BINARY_OP
                                        (AST_VAR)
                                        (AST_CLASS_CONST
                                            (SCALAR)))
                                    (
                                        (AST_CALL)
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_UNARY_OP
                                                    (AST_EMPTY
                                                        (AST_PROP
                                                            (AST_VAR))))
                                                (
                                                    (AST_CALL
                                                        (
                                                            (AST_VAR)
                                                            (AST_VAR)))
                                                    (AST_METHOD_CALL
                                                        (AST_VAR)
                                                        (
                                                            (AST_ENCAPS_LIST
                                                                (SCALAR)
                                                                (AST_VAR)
                                                                (SCALAR))))
                                                    (AST_FOREACH
                                                        (AST_PROP
                                                            (AST_VAR))
                                                        (AST_VAR)
                                                        (NULL)
                                                        (
                                                            (AST_ECHO
                                                                (AST_ENCAPS_LIST
                                                                    (SCALAR)
                                                                    (AST_VAR)
                                                                    (SCALAR))))))))))
                                (AST_IF_ELEM
                                    (NULL)
                                    (
                                        (AST_CALL
                                            (
                                                (AST_VAR)
                                                (AST_VAR)))
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_METHOD_CALL
                                                (AST_VAR)
                                                (
                                                    (AST_VAR))))
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_UNARY_OP
                                                    (AST_VAR))
                                                (
                                                    (AST_CONTINUE
                                                        (NULL)))))
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_CALL
                                                (
                                                    (SCALAR)
                                                    (SCALAR)
                                                    (AST_VAR))))
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_CALL
                                                (
                                                    (SCALAR)
                                                    (SCALAR)
                                                    (AST_VAR))))
                                        (AST_ASSIGN
                                            (AST_VAR)
                                            (AST_METHOD_CALL
                                                (AST_VAR)
                                                (
                                                    (AST_CALL
                                                        (
                                                            (AST_VAR)))
                                                    (AST_CALL
                                                        (
                                                            (AST_VAR)))
                                                    (AST_ENCAPS_LIST
                                                        (SCALAR)
                                                        (AST_VAR)
                                                        (SCALAR)))))
                                        (AST_IF
                                            (AST_IF_ELEM
                                                (AST_UNARY_OP
                                                    (AST_VAR))
                                                (
                                                    (AST_CALL
                                                        (
                                                            (AST_BINARY_OP
                                                                (AST_BINARY_OP
                                                                    (SCALAR)
                                                                    (AST_VAR))
                                                                (SCALAR))))
                                                    (AST_ECHO
                                                        (SCALAR))
                                                    (AST_CALL
                                                        (
                                                            (AST_CALL
                                                                (
                                                                    (AST_VAR)))))
                                                    (AST_ECHO
                                                        (SCALAR))
                                                    (AST_CALL
                                                        (
                                                            (AST_CALL
                                                                (
                                                                    (AST_VAR)))))
                                                    (AST_ECHO
                                                        (SCALAR)))))))))
                        (AST_CATCH_LIST
                            (AST_CATCH
                                (AST_NAME_LIST)
                                (AST_VAR)
                                (
                                    (AST_METHOD_CALL
                                        (AST_VAR)
                                        (
                                            (AST_BINARY_OP
                                                (AST_ENCAPS_LIST
                                                    (SCALAR)
                                                    (AST_VAR)
                                                    (SCALAR))
                                                (AST_METHOD_CALL
                                                    (AST_VAR))))))))
                        (NULL))))))
    (AST_ASSIGN
        (AST_VAR)
        (AST_ARRAY))
    (AST_FOREACH
        (AST_VAR)
        (AST_VAR)
        (AST_VAR)
        (
            (AST_ASSIGN
                (AST_DIM
                    (AST_VAR)
                    (AST_VAR))
                (AST_VAR))))
    (AST_METHOD_CALL
        (AST_VAR)
        (
            (SCALAR))))