    public static function build_sub_menu($context, $ignore_ul = false)
    {
        $search = array('{submenu_class}', '{url}', '{display}', '{child_class}', '{view}');
        $list   = '';
        foreach (self::$menu as $topic_name => $topic) {
            if (count($topic) <= 1) {
                foreach ($topic as $module => $vals) {
                    $list .= self::buildItem(
                        $module,
                        $vals['title'],
                        $vals['display_name'],
                        $context,
                        $vals['menu_view']
                    );
                }
            } else {
                // If there is more than one item in the topic, build out a menu
                // based on the multiple items.
                $subMenu = '';
                foreach ($topic as $module => $vals) {
                    if (empty($vals['menu_view'])) {
                        // If it has no sub-menu, add the item.
                        $subMenu .= self::buildItem(
                            $module,
                            $vals['title'],
                            $vals['display_name'],
                            $context,
                            $vals['menu_view']
                        );
                    } else {
                        // Otherwise, echo out the sub-menu only. To maintain backwards
                        // compatility, strip out any <ul> tags.
                        $subMenu .= str_ireplace(
                            array('<ul>', '</ul>'),
                            array('', ''),
                            self::$ci->load->view($vals['menu_view'], null, true)
                        );
                    }
                }

                // Handle localization of the topic name, if needed.
                if (strpos($topic_name, 'lang:') === 0) {
                    $topic_name = self::$ci->lang->line(str_replace('lang:', '', $topic_name));
                }

                $list .= str_replace(
                    $search,
                    array(
                        self::$submenu_class,
                        '#',
                        ucwords($topic_name),
                        self::$child_class,
                        $subMenu,
                    ),
                    self::$templateSubMenu
                );
            }
        }

        self::$menu = array();

        if ($ignore_ul) {
            return $list;
        }

        return str_replace(
            array('{class}', '{extra}', '{menu}'),
            array(self::$child_class, '', $list),
            self::$templateContextNav
        );
    }

    /**
     * Build an individual list item (with sub-menus) for the menu.
     *
     * @param string $module       The name of the module this link belongs to.
     * @param string $title        The title used on the link.
     * @param string $display_name The name to display in the menu.
     * @param string $context      The name of the context.
     * @param string $menu_view    The name of the view file that contains the sub-menu.
     *
     * @return string The HTML necessary for a single item and its sub-menus.
     */
||||||||||||||||HAS_DOC_COMMENTNO_RETURN_TYPE
(NO_PARAM_TYPENO_PARAM_DEFAULTNO_PARAM_TYPEPARAM_DEFAULT)
(
    (AST_ASSIGN
        (AST_VAR)
        (AST_ARRAY
            (AST_ARRAY_ELEM
                (SCALAR)
                (NULL))
            (AST_ARRAY_ELEM
                (SCALAR)
                (NULL))
            (AST_ARRAY_ELEM
                (SCALAR)
                (NULL))
            (AST_ARRAY_ELEM
                (SCALAR)
                (NULL))
            (AST_ARRAY_ELEM
                (SCALAR)
                (NULL))))
    (AST_ASSIGN
        (AST_VAR)
        (SCALAR))
    (AST_FOREACH
        (AST_STATIC_PROP)
        (AST_VAR)
        (AST_VAR)
        (
            (AST_IF
                (AST_IF_ELEM
                    (AST_BINARY_OP
                        (AST_CALL
                            (
                                (AST_VAR)))
                        (SCALAR))
                    (
                        (AST_FOREACH
                            (AST_VAR)
                            (AST_VAR)
                            (AST_VAR)
                            (
                                (AST_ASSIGN_OP
                                    (AST_VAR)
                                    (AST_STATIC_CALL
                                        (
                                            (AST_VAR)
                                            (AST_DIM
                                                (AST_VAR)
                                                (SCALAR))
                                            (AST_DIM
                                                (AST_VAR)
                                                (SCALAR))
                                            (AST_VAR)
                                            (AST_DIM
                                                (AST_VAR)
                                                (SCALAR)))))))))
                (AST_IF_ELEM
                    (NULL)
                    (
                        (AST_ASSIGN
                            (AST_VAR)
                            (SCALAR))
                        (AST_FOREACH
                            (AST_VAR)
                            (AST_VAR)
                            (AST_VAR)
                            (
                                (AST_IF
                                    (AST_IF_ELEM
                                        (AST_EMPTY
                                            (AST_DIM
                                                (AST_VAR)
                                                (SCALAR)))
                                        (
                                            (AST_ASSIGN_OP
                                                (AST_VAR)
                                                (AST_STATIC_CALL
                                                    (
                                                        (AST_VAR)
                                                        (AST_DIM
                                                            (AST_VAR)
                                                            (SCALAR))
                                                        (AST_DIM
                                                            (AST_VAR)
                                                            (SCALAR))
                                                        (AST_VAR)
                                                        (AST_DIM
                                                            (AST_VAR)
                                                            (SCALAR)))))))
                                    (AST_IF_ELEM
                                        (NULL)
                                        (
                                            (AST_ASSIGN_OP
                                                (AST_VAR)
                                                (AST_CALL
                                                    (
                                                        (AST_ARRAY
                                                            (AST_ARRAY_ELEM
                                                                (SCALAR)
                                                                (NULL))
                                                            (AST_ARRAY_ELEM
                                                                (SCALAR)
                                                                (NULL)))
                                                        (AST_ARRAY
                                                            (AST_ARRAY_ELEM
                                                                (SCALAR)
                                                                (NULL))
                                                            (AST_ARRAY_ELEM
                                                                (SCALAR)
                                                                (NULL)))
                                                        (AST_METHOD_CALL
                                                            (AST_PROP
                                                                (AST_STATIC_PROP))
                                                            (
                                                                (AST_DIM
                                                                    (AST_VAR)
                                                                    (SCALAR))
                                                                (AST_CONST)
                                                                (AST_CONST)))))))))))
                        (AST_IF
                            (AST_IF_ELEM
                                (AST_BINARY_OP
                                    (AST_CALL
                                        (
                                            (AST_VAR)
                                            (SCALAR)))
                                    (SCALAR))
                                (
                                    (AST_ASSIGN
                                        (AST_VAR)
                                        (AST_METHOD_CALL
                                            (AST_PROP
                                                (AST_STATIC_PROP))
                                            (
                                                (AST_CALL
                                                    (
                                                        (SCALAR)
                                                        (SCALAR)
                                                        (AST_VAR)))))))))
                        (AST_ASSIGN_OP
                            (AST_VAR)
                            (AST_CALL
                                (
                                    (AST_VAR)
                                    (AST_ARRAY
                                        (AST_ARRAY_ELEM
                                            (AST_STATIC_PROP)
                                            (NULL))
                                        (AST_ARRAY_ELEM
                                            (SCALAR)
                                            (NULL))
                                        (AST_ARRAY_ELEM
                                            (AST_CALL
                                                (
                                                    (AST_VAR)))
                                            (NULL))
                                        (AST_ARRAY_ELEM
                                            (AST_STATIC_PROP)
                                            (NULL))
                                        (AST_ARRAY_ELEM
                                            (AST_VAR)
                                            (NULL)))
                                    (AST_STATIC_PROP)))))))))
    (AST_ASSIGN
        (AST_STATIC_PROP)
        (AST_ARRAY))
    (AST_IF
        (AST_IF_ELEM
            (AST_VAR)
            (
                (AST_RETURN
                    (AST_VAR)))))
    (AST_RETURN
        (AST_CALL
            (
                (AST_ARRAY
                    (AST_ARRAY_ELEM
                        (SCALAR)
                        (NULL))
                    (AST_ARRAY_ELEM
                        (SCALAR)
                        (NULL))
                    (AST_ARRAY_ELEM
                        (SCALAR)
                        (NULL)))
                (AST_ARRAY
                    (AST_ARRAY_ELEM
                        (AST_STATIC_PROP)
                        (NULL))
                    (AST_ARRAY_ELEM
                        (SCALAR)
                        (NULL))
                    (AST_ARRAY_ELEM
                        (AST_VAR)
                        (NULL)))
                (AST_STATIC_PROP)))))||||||||